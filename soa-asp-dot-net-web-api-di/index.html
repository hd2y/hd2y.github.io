<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>SOA —— ASP.NET Web API 依赖注入 | 华灯</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="依赖注入（Dependency Injection，缩写DI）是将系统中各层对象解耦的一种方式，是实现控制反转（Inversion of Control，缩写IoC）的一种常用方式。 搭建框架首先我们搭建一个用于测试的基本框架，因为最近在了解 FreeSql，所以数据访问就使用 FreeSql，在这里推荐一下这个项目，叶老板真的很🐂🍺。 下图可以看出项目的简单架构：  实体实体层定义了实体的接">
<meta property="og:type" content="article">
<meta property="og:title" content="SOA —— ASP.NET Web API 依赖注入">
<meta property="og:url" content="http://example.com/soa-asp-dot-net-web-api-di/index.html">
<meta property="og:site_name" content="华灯">
<meta property="og:description" content="依赖注入（Dependency Injection，缩写DI）是将系统中各层对象解耦的一种方式，是实现控制反转（Inversion of Control，缩写IoC）的一种常用方式。 搭建框架首先我们搭建一个用于测试的基本框架，因为最近在了解 FreeSql，所以数据访问就使用 FreeSql，在这里推荐一下这个项目，叶老板真的很🐂🍺。 下图可以看出项目的简单架构：  实体实体层定义了实体的接">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://hd2y.oss-cn-beijing.aliyuncs.com/20191130104028_1575284957637.png">
<meta property="og:image" content="https://hd2y.oss-cn-beijing.aliyuncs.com/20191130101621_1575284957660.png">
<meta property="og:image" content="https://hd2y.oss-cn-beijing.aliyuncs.com/20191130101643_1575284957659.png">
<meta property="article:published_time" content="2019-12-02T11:15:37.000Z">
<meta property="article:modified_time" content="2019-12-25T10:38:55.000Z">
<meta property="article:author" content="hd2y">
<meta property="article:tag" content="SOA">
<meta property="article:tag" content="WebApi">
<meta property="article:tag" content="依赖注入">
<meta property="article:tag" content="Autofac">
<meta property="article:tag" content="Unity">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://hd2y.oss-cn-beijing.aliyuncs.com/20191130104028_1575284957637.png">
  
    <link rel="alternate" href="/atom.xml" title="华灯" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 5.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">华灯</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS 订阅"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="搜索"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-191202-soa-asp-dot-net-web-api-di" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/soa-asp-dot-net-web-api-di/" class="article-date">
  <time class="dt-published" datetime="2019-12-02T11:15:37.000Z" itemprop="datePublished">2019-12-02</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%BC%80%E5%8F%91/">开发</a>►<a class="article-category-link" href="/categories/%E5%BC%80%E5%8F%91/C/">C#</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      SOA —— ASP.NET Web API 依赖注入
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>依赖注入（Dependency Injection，缩写DI）是将系统中各层对象解耦的一种方式，是实现控制反转（Inversion of Control，缩写IoC）的一种常用方式。</p>
<h2 id="搭建框架"><a href="#搭建框架" class="headerlink" title="搭建框架"></a>搭建框架</h2><p>首先我们搭建一个用于测试的基本框架，因为最近在了解 <code>FreeSql</code>，所以数据访问就使用 <code>FreeSql</code>，在这里推荐一下这个项目，叶老板真的很🐂🍺。</p>
<p>下图可以看出项目的简单架构：</p>
<p><img src="https://hd2y.oss-cn-beijing.aliyuncs.com/20191130104028_1575284957637.png" alt="20191130104028"></p>
<h3 id="实体"><a href="#实体" class="headerlink" title="实体"></a>实体</h3><p>实体层定义了实体的接口 <code>IBaseEntity</code> ：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">IBaseEntity</span></span><br><span class="line">&#123;</span><br><span class="line">    [<span class="meta">Column(IsPrimary = true, IsIdentity = true)</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">long</span> Id &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> DateTime CreateTime &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125; = DateTime.Now;</span><br><span class="line">    <span class="keyword">public</span> DateTime UpdateTime &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125; = DateTime.Now;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>标本类 <code>Specimen</code>：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Specimen</span> : <span class="title">IBaseEntity</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> DateTime InspectionDate &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> Type &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> SpeicimenNo &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> State &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> Barcode &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> DateTime? ResultTime &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span>? ResultUserId &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> DateTime? CheckTime &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span>? CheckUserId &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> DateTime? ReportTime &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span>? ReportUserId &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="服务接口"><a href="#服务接口" class="headerlink" title="服务接口"></a>服务接口</h3><p>服务接口首先定义了服务常用的一些操作 <code>IBaseService</code>：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">IBaseService</span>&lt;<span class="title">T</span>&gt; <span class="keyword">where</span> <span class="title">T</span> : <span class="title">IBaseEntity</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function">T <span class="title">Insert</span>(<span class="params">T t</span>)</span>;</span><br><span class="line">    <span class="function">T <span class="title">Get</span>(<span class="params"><span class="built_in">int</span> id</span>)</span>;</span><br><span class="line">    <span class="function">T <span class="title">Update</span>(<span class="params">T t</span>)</span>;</span><br><span class="line">    <span class="function"><span class="built_in">bool</span> <span class="title">Delete</span>(<span class="params"><span class="built_in">int</span> id</span>)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后不同的业务实体，也有自己的业务逻辑 <code>ISpecimenService</code>：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">ISpecimenService</span> : <span class="title">IBaseService</span>&lt;<span class="title">Specimen</span>&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="function">Specimen <span class="title">CheckSpecimen</span>(<span class="params"><span class="built_in">int</span> specimenId, <span class="built_in">int</span> userId</span>)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="服务实现"><a href="#服务实现" class="headerlink" title="服务实现"></a>服务实现</h3><p>服务接口的实现，首先是 <code>IBaseService</code> 的实现 <code>BaseService</code>：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">BaseService</span>&lt;<span class="title">T</span>&gt; : <span class="title">IBaseService</span>&lt;<span class="title">T</span>&gt; <span class="keyword">where</span> <span class="title">T</span> : <span class="title">IBaseEntity</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">virtual</span> IFreeSql FreeSql &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BaseService</span>(<span class="params">IFreeSql freeSql</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        FreeSql = freeSql;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">virtual</span> <span class="built_in">bool</span> <span class="title">Delete</span>(<span class="params"><span class="built_in">int</span> id</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">return</span> FreeSql.Delete&lt;T&gt;(id).ExecuteAffrows() &gt; <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">virtual</span> T <span class="title">Get</span>(<span class="params"><span class="built_in">int</span> id</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">return</span> FreeSql.Select&lt;T&gt;(id).First();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">virtual</span> T <span class="title">Insert</span>(<span class="params">T t</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="built_in">int</span> id = (<span class="built_in">int</span>)FreeSql.Insert&lt;T&gt;().AppendData(t).ExecuteIdentity();</span><br><span class="line">        <span class="keyword">return</span> FreeSql.Select&lt;T&gt;(id).First();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">virtual</span> T <span class="title">Update</span>(<span class="params">T t</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        t.UpdateTime = DateTime.Now;</span><br><span class="line">        <span class="built_in">int</span> rows = FreeSql.Update&lt;T&gt;(t).ExecuteAffrows();</span><br><span class="line">        <span class="keyword">if</span> (rows == <span class="number">1</span>)</span><br><span class="line">            <span class="keyword">return</span> FreeSql.Select&lt;T&gt;(t.Id).First();</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>ISpecimenService</code> 的实现 <code>SpecimenService</code>：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">SpecimenService</span> : <span class="title">BaseService</span>&lt;<span class="title">Specimen</span>&gt;, <span class="title">ISpecimenService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SpecimenService</span>(<span class="params">IFreeSql freeSql</span>) : <span class="title">base</span>(<span class="params">freeSql</span>)</span> &#123; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Specimen <span class="title">CheckSpecimen</span>(<span class="params"><span class="built_in">int</span> specimenId, <span class="built_in">int</span> userId</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">return</span> FreeSql.Update&lt;Specimen&gt;().Set(s =&gt; <span class="keyword">new</span> &#123; CheckUserId = userId, CheckTime = DateTime.Now &#125;).ExecuteUpdated().First();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Web-站点"><a href="#Web-站点" class="headerlink" title="Web 站点"></a>Web 站点</h3><p>首先是需要创建用于初始化 <code>FreeSql</code> 的工厂 <code>FreeSqlFactory</code>：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">FreeSqlFactory</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> IFreeSql FreeSql &#123; <span class="keyword">get</span>; <span class="keyword">private</span> <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="title">FreeSqlFactory</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        FreeSql = <span class="keyword">new</span> FreeSql.FreeSqlBuilder()</span><br><span class="line">                  .UseConnectionString(global::FreeSql.DataType.Sqlite, &quot;Data Source=|DataDirectory|\\data.db;Pooling=true;Max Pool Size=10&quot;)</span><br><span class="line">                  .UseAutoSyncStructure(<span class="literal">true</span>)</span><br><span class="line">                  .Build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里主要是想让该项目简单一些，所以只考虑服务层 <code>JohnSun.SOA.WebAPI.Service</code> 的注入，所以直接将数据库访问层依赖细节，使用 <code>SQLite</code> 数据库，并使用 <code>FreeSql</code> 的 <code>CodeFirst</code> 模式。</p>
<p>然后就创建一个 <code>Web API</code> 控制器 <code>SpecimensController</code>：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">SpecimensController</span> : <span class="title">ApiController</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Specimen <span class="title">Get</span>(<span class="params"><span class="built_in">int</span> id</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        SpecimenService service = <span class="keyword">new</span> SpecimenService(FreeSqlFactory.FreeSql);</span><br><span class="line">        <span class="keyword">return</span> service.Get(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Specimen <span class="title">Post</span>(<span class="params">DateTime inspectionDate, <span class="built_in">string</span> speicimenNo, <span class="built_in">int</span> type, <span class="built_in">string</span> barcode = <span class="literal">null</span></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        SpecimenService service = <span class="keyword">new</span> SpecimenService(FreeSqlFactory.FreeSql);</span><br><span class="line">        <span class="keyword">return</span> service.Insert(<span class="keyword">new</span> Specimen &#123; InspectionDate = inspectionDate, SpeicimenNo = speicimenNo, Type = type, Barcode = barcode &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里只提供两个简单的方法，一个新增方法，一个通过Id查询数据。</p>
<h3 id="访问测试"><a href="#访问测试" class="headerlink" title="访问测试"></a>访问测试</h3><p>截止到目前，一个简单的测试项目创建完成，我们可以使用 <code>postman</code> 对项目进行简单的测试。</p>
<p>首先是调用 <code>POST</code> 方法，新增标本 <code>http://localhost:58683/api/specimens?inspectionDate=2019-11-30&amp;speicimenNo=1001&amp;type=0</code>：</p>
<p><img src="https://hd2y.oss-cn-beijing.aliyuncs.com/20191130101621_1575284957660.png" alt="20191130101621"></p>
<p>返回的是一个创建成功后的数据库实体，我们可以通过这个对象的 <code>id</code> 再使用 <code>GET</code> 方法进行查询 <code>http://localhost:58683/api/specimens/1</code>：</p>
<p><img src="https://hd2y.oss-cn-beijing.aliyuncs.com/20191130101643_1575284957659.png" alt="20191130101643"></p>
<h2 id="Unity-实现依赖注入"><a href="#Unity-实现依赖注入" class="headerlink" title="Unity 实现依赖注入"></a>Unity 实现依赖注入</h2><p>为了方便理解，我们将移除依赖具体实现的步骤罗列出来，方便对控制反转的实现有一个简单的了解。</p>
<h3 id="使用-Unity-创建对象"><a href="#使用-Unity-创建对象" class="headerlink" title="使用 Unity 创建对象"></a>使用 Unity 创建对象</h3><p>首先我们将对象的创建移交给 <code>Unity</code>，首先我们使用 <code>nuget</code> 为 <code>Web</code> 项目添加 <code>Unity</code> 的包引用：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Install-Package Unity -Version 5.11.1</span><br></pre></td></tr></table></figure>
<p>然后我们添加一个统一的依赖注入容器，将需要用到的类型注册到容器中：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">IUnityContainer container = <span class="keyword">new</span> UnityContainer();</span><br><span class="line"><span class="comment">// 注册单例 因为 ISpecimenService 的构造函数需要提供一个 IFreeSql 的参数</span></span><br><span class="line">container.RegisterInstance(FreeSqlFactory.FreeSql);</span><br><span class="line"><span class="comment">// 注册 SpecimenService 到 ISpecimenService</span></span><br><span class="line">container.RegisterType&lt;ISpecimenService, SpecimenService&gt;();</span><br></pre></td></tr></table></figure>
<p>这样我们创建 <code>ISpecimenService</code> 的实例对象就不需要再依赖细节 <code>SpecimenService</code>：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ISpecimenService service = container.Resolve&lt;ISpecimenService&gt;();</span><br></pre></td></tr></table></figure>
<h3 id="调整为工厂"><a href="#调整为工厂" class="headerlink" title="调整为工厂"></a>调整为工厂</h3><p>我们并不需要每次初始化 <code>ISpecimenService</code> 都创建一个依赖注入的容器，实际上这个容器只需要创建一次，所以我们增加一个 <code>ContainerFactory</code> 的类型：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ContainerFactory</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> IUnityContainer Container &#123; <span class="keyword">get</span>; <span class="keyword">private</span> <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="title">ContainerFactory</span>(<span class="params"></span>) </span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        Container = <span class="keyword">new</span> UnityContainer();</span><br><span class="line">        Container.RegisterInstance(FreeSqlFactory.FreeSql);</span><br><span class="line">        Container.RegisterType&lt;ISpecimenService, SpecimenService&gt;();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后调整我们的控制器 <code>SpecimensController</code>：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Specimen <span class="title">Get</span>(<span class="params"><span class="built_in">int</span> id</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ISpecimenService service = ContainerFactory.Container.Resolve&lt;ISpecimenService&gt;();</span><br><span class="line">    <span class="keyword">return</span> service.Get(id);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> Specimen <span class="title">Post</span>(<span class="params">DateTime inspectionDate, <span class="built_in">string</span> speicimenNo, <span class="built_in">int</span> type, <span class="built_in">string</span> barcode = <span class="literal">null</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ISpecimenService service = ContainerFactory.Container.Resolve&lt;ISpecimenService&gt;();</span><br><span class="line">    <span class="keyword">return</span> service.Insert(<span class="keyword">new</span> Specimen &#123; InspectionDate = inspectionDate, SpeicimenNo = speicimenNo, Type = type, Barcode = barcode &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="调整为使用配置文件"><a href="#调整为使用配置文件" class="headerlink" title="调整为使用配置文件"></a>调整为使用配置文件</h3><p>因为 <code>ContainerFactory</code> 工厂类注册时仍然存在 <code>SpecimenService</code>，所以我们要将改类型从上层中移除，否则我们仍然无法指定 <code>ISpecimenService</code>。</p>
<p>Unity 为我们提供了使用配置文件初始化依赖注入容器的方案，所以首先我们移除 <code>Web</code> 对于 <code>JohnSun.SOA.WebAPI.Service</code> 项目的引用，使服务不再强依赖于该项目，方便后期对产品的升级改造。</p>
<p>但是测试项目仍然需要一个实现，所以我们需要在移除依赖后，手动的将 <code>JohnSun.SOA.WebAPI.Service/bin</code> 目录下的文件拷贝到 <code>JohnSun.SOA.WebAPI.Server/bin</code> 下。</p>
<p>添加 <code>Unity.Configuration</code> 的引用：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Install-Package Unity.Configuration -Version 5.11.1</span><br></pre></td></tr></table></figure>
<p>在 <code>Web</code> 项目中添加配置文件 <code>ConfigFiles/Unity.config</code>：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">configSections</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">section</span> <span class="attr">name</span>=<span class="string">&quot;unity&quot;</span> <span class="attr">type</span>=<span class="string">&quot;Microsoft.Practices.Unity.Configuration.UnityConfigurationSection, Unity.Configuration&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">configSections</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">unity</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aliases</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">add</span> <span class="attr">alias</span>=<span class="string">&quot;ISpecimenService&quot;</span> <span class="attr">type</span>=<span class="string">&quot;JohnSun.SOA.WebAPI.Interface.ISpecimenService, JohnSun.SOA.WebAPI.Interface&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">add</span> <span class="attr">alias</span>=<span class="string">&quot;SpecimenService&quot;</span> <span class="attr">type</span>=<span class="string">&quot;JohnSun.SOA.WebAPI.Service.SpecimenService, JohnSun.SOA.WebAPI.Service&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">aliases</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">container</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">register</span> <span class="attr">type</span>=<span class="string">&quot;ISpecimenService&quot;</span> <span class="attr">mapTo</span>=<span class="string">&quot;SpecimenService&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">container</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">unity</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>调整 <code>ContainerFactory</code> 的静态构造函数代码：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Container = <span class="keyword">new</span> UnityContainer();</span><br><span class="line">Container.RegisterInstance(FreeSqlFactory.FreeSql);</span><br><span class="line"></span><br><span class="line"><span class="built_in">string</span> configPath = Path.Combine(AppDomain.CurrentDomain.BaseDirectory, <span class="string">@&quot;ConfigFiles\Unity.config&quot;</span>);</span><br><span class="line">ExeConfigurationFileMap map = <span class="keyword">new</span> ExeConfigurationFileMap &#123; ExeConfigFilename = configPath &#125;;</span><br><span class="line">Configuration configuration = ConfigurationManager.OpenMappedExeConfiguration(map, ConfigurationUserLevel.None);</span><br><span class="line">UnityConfigurationSection section = (UnityConfigurationSection)configuration.GetSection(UnityConfigurationSection.SectionName);</span><br><span class="line"></span><br><span class="line">section.Configure(Container);</span><br></pre></td></tr></table></figure>
<p>这时在 <code>Web</code> 项目中已经不需要依赖 <code>JohnSun.SOA.WebAPI.Service</code> 的任何细节，均可以通过配置文件实现。</p>
<blockquote>
<p>注意：<br><br>FreeSql 仍然依赖细节，前文已经提到为了测试项目的简单，所以就 <code>不要在意细节</code> 了。<br><br>后面写到这段代码的时候有考虑将 <code>FreeSqlFactory.FreeSql</code> 移交给配置文件，但是配置文件 <code>instance</code> 节点在 <code>Unity</code> 项目中给出的测试用例，无法指定 <code>value</code> 为一个程序中的字段或属性，<code>value</code> 只能设置一些常量值例如字符串或数字。<br><br>后面仔细想了一下，如果真的想移除依赖，可能需要增加一个类似 <code>IFreeSqlInfo</code> 的对象，将 <code>IFreeSql</code> 作为该类型的一个属性，这样我们还可以提供一个多个参数的构造函数，用来指定连接的数据库、数据库类型、连接字符串、是否启用数据库迁移等等。<br><br>当然，最终也要将 <code>SpecimenService</code> 构造函数中的 <code>IFreeSql</code> 调整成 <code>IFreeSqlInfo</code> 的实现才行。</p>
</blockquote>
<h3 id="控制器的注入"><a href="#控制器的注入" class="headerlink" title="控制器的注入"></a>控制器的注入</h3><p>虽然已经成功添加容器，移除了细节的依赖，但是控制器中我们仍然需要使用 <code>Resolve</code> 构造对象，所以下一步我们需要将 <code>Service</code> 对象的构造也注入进来。</p>
<p>首先我们需要修改控制器的结构，将 <code>SpecimensController</code> 控制器调整为以下代码：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">SpecimensController</span> : <span class="title">ApiController</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> ISpecimenService _specimenService;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SpecimensController</span>(<span class="params">ISpecimenService specimenService</span>) </span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        _specimenService = specimenService;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Specimen <span class="title">Get</span>(<span class="params"><span class="built_in">int</span> id</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">return</span> _specimenService.Get(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Specimen <span class="title">Post</span>(<span class="params">DateTime inspectionDate, <span class="built_in">string</span> speicimenNo, <span class="built_in">int</span> type, <span class="built_in">string</span> barcode = <span class="literal">null</span></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">return</span> _specimenService.Insert(<span class="keyword">new</span> Specimen &#123; InspectionDate = inspectionDate, SpeicimenNo = speicimenNo, Type = type, Barcode = barcode &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个时候如果直接运行项目肯定是不行的，因为控制器默认无参数的构造函数已经不存在了，会报错。</p>
<h4 id="传统方式注入"><a href="#传统方式注入" class="headerlink" title="传统方式注入"></a>传统方式注入</h4><p>根据 MSDN 上的文档，我们可以借助 Web API 定义用于解析依赖项的 <code>IDependencyResolver</code> 接口来实现控制器的注入。</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">IDependencyResolver</span> : <span class="title">IDependencyScope</span>, <span class="title">IDisposable</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function">IDependencyScope <span class="title">BeginScope</span>(<span class="params"></span>)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">IDependencyScope</span> : <span class="title">IDisposable</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="built_in">object</span> <span class="title">GetService</span>(<span class="params">Type serviceType</span>)</span>;</span><br><span class="line">    <span class="function">IEnumerable&lt;<span class="built_in">object</span>&gt; <span class="title">GetServices</span>(<span class="params">Type serviceType</span>)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>IDependencyScope</code> 接口有两种方法：</p>
<ul>
<li><code>GetService</code> 创建一个类型的实例。</li>
<li><code>GetServices</code> 创建指定类型的对象的集合。</li>
</ul>
<p><code>IDependencyResolver</code> 方法继承 <code>IDependencyScope</code> 并添加 <code>BeginScope</code> 方法。</p>
<p>当 Web API 创建控制器实例时，它将首先调用 <code>IDependencyResolver</code> 的 <code>GetService</code> 方法，并传入控制器类型。我们可以借助该特性，来构造任何控制器，如果 <code>GetService</code> 返回 <code>Null</code>，Web API 将在控制器类上查找无参数的构造函数。</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">UnityResolver</span> : <span class="title">IDependencyResolver</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">protected</span> IUnityContainer container;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">UnityResolver</span>(<span class="params">IUnityContainer container</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">if</span> (container == <span class="literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> ArgumentNullException(<span class="string">&quot;container&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">this</span>.container = container;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> IDependencyScope <span class="title">BeginScope</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> UnityResolver(container.CreateChildContainer());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Dispose</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        Dispose(<span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">Dispose</span>(<span class="params"><span class="built_in">bool</span> disposing</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        container.Dispose();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">object</span> <span class="title">GetService</span>(<span class="params">Type serviceType</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">try</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> ContainerFactory.Container.Resolve(serviceType);</span><br><span class="line">        &#125;</span><br><span class="line">        catch (ResolutionFailedException)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> IEnumerable&lt;<span class="built_in">object</span>&gt; <span class="title">GetServices</span>(<span class="params">Type serviceType</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">try</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> ContainerFactory.Container.ResolveAll(serviceType);</span><br><span class="line">        &#125;</span><br><span class="line">        catch (ResolutionFailedException)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> List&lt;<span class="built_in">object</span>&gt;();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>最后我们需要将 <code>HttpConfiguration</code> 中的 <code>DependencyResolver</code> 属性替换为我们实现的 <code>UnityResolver</code>。</p>
<p>修改 <code>WebApiConfig.Register</code> 方法，增加以下代码：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">config.DependencyResolver = <span class="keyword">new</span> UnityResolver(ContainerFactory.Container);</span><br></pre></td></tr></table></figure>
<h4 id="使用-Unity-WebAPI"><a href="#使用-Unity-WebAPI" class="headerlink" title="使用 Unity.WebAPI"></a>使用 Unity.WebAPI</h4><p>Unity 提供了一个包，方便我们控制器的注入，首先要通过 <code>nuget</code> 安装包：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Install-Package Unity.WebAPI -Version 5.4.0</span><br></pre></td></tr></table></figure>
<p>同之前一样，修改 <code>WebApiConfig.Register</code> 方法，增加以下代码：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">config.DependencyResolver = <span class="keyword">new</span> Unity.WebApi.UnityDependencyResolver(ContainerFactory.Container);</span><br></pre></td></tr></table></figure>
<p><code>UnityDependencyResolver</code> 类型是帮我们实现的 <code>IDependencyResolver</code> 接口，通过反编译代码可以了解和我们从 <code>MSDN</code> 的常规实现基本一致：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Unity.WebApi.UnityDependencyScope</span></span><br><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> System.Web.Http.Controllers;</span><br><span class="line"><span class="keyword">using</span> System.Web.Http.Dependencies;</span><br><span class="line"><span class="keyword">using</span> Unity;</span><br><span class="line"><span class="keyword">using</span> Unity.Resolution;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">UnityDependencyScope</span> : <span class="title">IDependencyScope</span>, <span class="title">IDisposable</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">protected</span> IUnityContainer Container</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">get</span>;</span><br><span class="line">		<span class="keyword">private</span> <span class="keyword">set</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">UnityDependencyScope</span>(<span class="params">IUnityContainer container</span>)</span></span><br><span class="line"><span class="function"></span>	&#123;</span><br><span class="line">		Container = container;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="built_in">object</span> <span class="title">GetService</span>(<span class="params">Type serviceType</span>)</span></span><br><span class="line"><span class="function"></span>	&#123;</span><br><span class="line">		<span class="keyword">if</span> (<span class="keyword">typeof</span>(IHttpController).IsAssignableFrom(serviceType))</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">return</span> UnityContainerExtensions.Resolve(Container, serviceType, (ResolverOverride[])(<span class="built_in">object</span>)<span class="keyword">new</span> ResolverOverride[<span class="number">0</span>]);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">try</span></span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">return</span> UnityContainerExtensions.Resolve(Container, serviceType, (ResolverOverride[])(<span class="built_in">object</span>)<span class="keyword">new</span> ResolverOverride[<span class="number">0</span>]);</span><br><span class="line">		&#125;</span><br><span class="line">		catch</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> IEnumerable&lt;<span class="built_in">object</span>&gt; <span class="title">GetServices</span>(<span class="params">Type serviceType</span>)</span></span><br><span class="line"><span class="function"></span>	&#123;</span><br><span class="line">		<span class="keyword">return</span> UnityContainerExtensions.ResolveAll(Container, serviceType, (ResolverOverride[])(<span class="built_in">object</span>)<span class="keyword">new</span> ResolverOverride[<span class="number">0</span>]);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Dispose</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>	&#123;</span><br><span class="line">		((IDisposable)Container).Dispose();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Unity.WebApi.UnityDependencyResolver</span></span><br><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Web.Http.Dependencies;</span><br><span class="line"><span class="keyword">using</span> Unity;</span><br><span class="line"><span class="keyword">using</span> Unity.WebApi;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">UnityDependencyResolver</span> : <span class="title">UnityDependencyScope</span>, <span class="title">IDependencyResolver</span>, <span class="title">IDependencyScope</span>, <span class="title">IDisposable</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">UnityDependencyResolver</span>(<span class="params">IUnityContainer container</span>)</span></span><br><span class="line"><span class="function">		: <span class="title">base</span>(<span class="params">container</span>)</span></span><br><span class="line"><span class="function"></span>	&#123;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> IDependencyScope <span class="title">BeginScope</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>	&#123;</span><br><span class="line">		<span class="keyword">return</span> (IDependencyScope)(<span class="built_in">object</span>)<span class="keyword">new</span> UnityDependencyScope(<span class="keyword">base</span>.Container.CreateChildContainer());</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Autofac-实现依赖注入"><a href="#Autofac-实现依赖注入" class="headerlink" title="Autofac 实现依赖注入"></a>Autofac 实现依赖注入</h2><p>相较于 <code>Unity</code>，其实 <code>Autofac</code> 使用更广泛，普遍认为后者的性能表现要优于前者，并且后者拥有中文文档，社区更活跃。</p>
<h3 id="代码中为容器注册类型"><a href="#代码中为容器注册类型" class="headerlink" title="代码中为容器注册类型"></a>代码中为容器注册类型</h3><p>本质上 Autofac 与前者差异不大，所以这里只是简单的介绍一下使用，更多的知识可以了解官方的文档。</p>
<p>这里添加一个 <code>AutofacContainerFactory</code> 的类型：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">AutofacContainerFactory</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> IContainer Container &#123; <span class="keyword">get</span>; <span class="keyword">private</span> <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="title">AutofacContainerFactory</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="comment">// Autofac 在程序中注册</span></span><br><span class="line">        <span class="keyword">var</span> builder = <span class="keyword">new</span> ContainerBuilder();</span><br><span class="line">        builder.RegisterInstance(FreeSqlFactory.FreeSql);</span><br><span class="line">        builder.RegisterType&lt;SpecimenService&gt;().As&lt;ISpecimenService&gt;();</span><br><span class="line">        Container = builder.Build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这时无法运行程序，甚至会报错，因为基于 <code>Unity</code> 的那套代码，<code>Service</code> 的项目依赖已经移除，这里会报错。所以这里知识代码演示。</p>
<h3 id="使用配置文件"><a href="#使用配置文件" class="headerlink" title="使用配置文件"></a>使用配置文件</h3><p>由于 <code>Autofac 4.0+</code> 配置依赖于 <code>Microsoft.Extensions.Configuration.Xml</code> 或 <code>Microsoft.Extensions.Configuration.Json</code>，并且这两个项目依赖于 <code>.NET Standard 2.0</code>，所以需要将项目都升级到 <code>.NET Framework 4.6.1+</code>。</p>
<p>另外为了能让项目成功运行起来，并且使用的是 <code>Autofac</code> 实现依赖注入，我们还需要引用几个 nuget 程序包：</p>
<ul>
<li><code>Autofac.Configuration</code>：为 <code>autofac</code> 提供配置功能。</li>
<li><code>Autofac.WebApi2</code>：ASP.NET Web API 控制器的依赖注入。</li>
<li><code>Microsoft.Extensions.Configuration.Json</code>：如果使用 json 文件配置 autofac 添加该引用。</li>
<li><code>Microsoft.Extensions.Configuration.Xml</code>：如果使用 xml 文件配置 autofac 添加该引用。</li>
</ul>
<p>调整 <code>AutofacContainerFactory</code> 静态构造函数中的代码：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">AutofacContainerFactory</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> IContainer Container &#123; <span class="keyword">get</span>; <span class="keyword">private</span> <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="title">AutofacContainerFactory</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="comment">// Autofac 在程序中注册</span></span><br><span class="line">        <span class="comment">//var builder = new ContainerBuilder();</span></span><br><span class="line">        <span class="comment">//builder.RegisterInstance(FreeSqlFactory.FreeSql);</span></span><br><span class="line">        <span class="comment">//builder.RegisterType&lt;Service.SpecimenService&gt;().As&lt;ISpecimenService&gt;();</span></span><br><span class="line">        <span class="comment">//builder.RegisterApiControllers(AppDomain.CurrentDomain.GetAssemblies());</span></span><br><span class="line">        <span class="comment">//Container = builder.Build();</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// Autofac 使用配置文件注册</span></span><br><span class="line">        <span class="keyword">var</span> builder = <span class="keyword">new</span> ContainerBuilder();</span><br><span class="line">        builder.RegisterInstance(FreeSqlFactory.FreeSql);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> config = <span class="keyword">new</span> ConfigurationBuilder();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Json 文件</span></span><br><span class="line">        <span class="comment">//string configPath = Path.Combine(AppDomain.CurrentDomain.BaseDirectory, @&quot;ConfigFiles\Autofac.json&quot;);</span></span><br><span class="line">        <span class="comment">//config.AddJsonFile(configPath);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// Xml 文件</span></span><br><span class="line">        <span class="built_in">string</span> configPath = Path.Combine(AppDomain.CurrentDomain.BaseDirectory, <span class="string">@&quot;ConfigFiles\Autofac.config&quot;</span>);</span><br><span class="line">        config.AddXmlFile(configPath);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> module = <span class="keyword">new</span> ConfigurationModule(config.Build());</span><br><span class="line">        builder.RegisterModule(module);</span><br><span class="line"></span><br><span class="line">        builder.RegisterApiControllers(AppDomain.CurrentDomain.GetAssemblies());</span><br><span class="line"></span><br><span class="line">        Container = builder.Build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>添加对应的配置文件到 <code>ConfigFiles</code> 文件夹，<code>Autofac.config</code> 文件：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">autofac</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">components</span> <span class="attr">name</span>=<span class="string">&quot;0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">type</span>&gt;</span>JohnSun.SOA.WebAPI.Service.SpecimenService, JohnSun.SOA.WebAPI.Service<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">services</span> <span class="attr">name</span>=<span class="string">&quot;0&quot;</span> <span class="attr">type</span>=<span class="string">&quot;JohnSun.SOA.WebAPI.Interface.ISpecimenService, JohnSun.SOA.WebAPI.Interface&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">components</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">autofac</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>Autofac.json</code> 文件：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;components&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;type&quot;</span>: <span class="string">&quot;JohnSun.SOA.WebAPI.Service.SpecimenService, JohnSun.SOA.WebAPI.Service&quot;</span>,</span><br><span class="line">      <span class="string">&quot;services&quot;</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span>: <span class="string">&quot;JohnSun.SOA.WebAPI.Interface.ISpecimenService, JohnSun.SOA.WebAPI.Interface&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>最终修改我们的 <code>WebApiConfig.Register</code> 方法，将 <code>config.DependencyResolver</code> 修改为<code>AutofacWebApiDependencyResolver</code>，注意这个类型是在 <code>Autofac.WebApi2</code> 中的类型：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">config.DependencyResolver = <span class="keyword">new</span> Autofac.Integration.WebApi.AutofacWebApiDependencyResolver(AutofacContainerFactory.Container);</span><br></pre></td></tr></table></figure>
<p>这时，如果没有配置错误，就可以正常访问我们的控制器获取数据，需要注意的是：</p>
<ul>
<li>ConfigFiles 文件夹下的配置文件属性“复制到输出目录”应该修改为：“如果较新则复制”。</li>
<li>工厂类 <code>AutofacContainerFactory</code> 构建容器时一定要调用 <code>builder.RegisterApiControllers()</code> 方法，不同于 Unity 的原因可以参看后文 <code>AutofacWebApiDependencyResolver</code> 类型的反编译代码。</li>
</ul>
<h3 id="AutofacWebApiDependencyResolver-类型"><a href="#AutofacWebApiDependencyResolver-类型" class="headerlink" title="AutofacWebApiDependencyResolver 类型"></a>AutofacWebApiDependencyResolver 类型</h3><p>反编译 <code>nuget</code> 包 <code>Autofac.WebApi2.nupkg</code> 中的 <code>Autofac.Integration.WebApi.dll</code> 文件可以找到该类型：</p>
<p><code>Autofac.Integration.WebApi.AutofacWebApiDependencyScope</code>：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> Autofac;</span><br><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> System.Linq;</span><br><span class="line"><span class="keyword">using</span> System.Web.Http.Dependencies;</span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> Autofac implementation of the <span class="doctag">&lt;see cref=&quot;T:System.Web.Http.Dependencies.IDependencyScope&quot; /&gt;</span> interface.</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">AutofacWebApiDependencyScope</span> : <span class="title">IDependencyScope</span>, <span class="title">IDisposable</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="built_in">bool</span> _disposed;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">readonly</span> ILifetimeScope _lifetimeScope;</span><br><span class="line"></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> Gets the lifetime scope for the current dependency scope.</span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">	<span class="keyword">public</span> ILifetimeScope LifetimeScope =&gt; _lifetimeScope;</span><br><span class="line"></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> Initializes a new instance of the <span class="doctag">&lt;see cref=&quot;T:Autofac.Integration.WebApi.AutofacWebApiDependencyScope&quot; /&gt;</span> class.</span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;lifetimeScope&quot;&gt;</span>The lifetime scope to resolve services from.<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">AutofacWebApiDependencyScope</span>(<span class="params">ILifetimeScope lifetimeScope</span>)</span></span><br><span class="line"><span class="function"></span>	&#123;</span><br><span class="line">		<span class="keyword">if</span> (lifetimeScope == <span class="literal">null</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> ArgumentNullException(<span class="string">&quot;lifetimeScope&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		_lifetimeScope = lifetimeScope;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> Finalizes an instance of the <span class="doctag">&lt;see cref=&quot;T:Autofac.Integration.WebApi.AutofacWebApiDependencyScope&quot; /&gt;</span> class.</span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">	~AutofacWebApiDependencyScope()</span><br><span class="line">	&#123;</span><br><span class="line">		Dispose(disposing: <span class="literal">false</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> Try to get a service of the given type.</span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;serviceType&quot;&gt;</span>ControllerType of service to request.<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>An instance of the service, or null if the service is not found.<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="built_in">object</span> <span class="title">GetService</span>(<span class="params">Type serviceType</span>)</span></span><br><span class="line"><span class="function"></span>	&#123;</span><br><span class="line">		<span class="keyword">return</span> ResolutionExtensions.ResolveOptional((IComponentContext)(<span class="built_in">object</span>)_lifetimeScope, serviceType);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> Try to get a list of services of the given type.</span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;serviceType&quot;&gt;</span>ControllerType of services to request.<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>An enumeration (possibly empty) of the service.<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> IEnumerable&lt;<span class="built_in">object</span>&gt; <span class="title">GetServices</span>(<span class="params">Type serviceType</span>)</span></span><br><span class="line"><span class="function"></span>	&#123;</span><br><span class="line">		<span class="keyword">if</span> (!ResolutionExtensions.IsRegistered((IComponentContext)(<span class="built_in">object</span>)_lifetimeScope, serviceType))</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">return</span> Enumerable.Empty&lt;<span class="built_in">object</span>&gt;();</span><br><span class="line">		&#125;</span><br><span class="line">		Type enumerableServiceType = <span class="keyword">typeof</span>(IEnumerable&lt;&gt;).MakeGenericType(serviceType);</span><br><span class="line">		<span class="keyword">return</span> (IEnumerable&lt;<span class="built_in">object</span>&gt;)ResolutionExtensions.Resolve((IComponentContext)(<span class="built_in">object</span>)_lifetimeScope, enumerableServiceType);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> Performs application-defined tasks associated with freeing, releasing, or resetting unmanaged resources.</span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Dispose</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>	&#123;</span><br><span class="line">		Dispose(disposing: <span class="literal">true</span>);</span><br><span class="line">		GC.SuppressFinalize(<span class="keyword">this</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> Releases unmanaged and - optionally - managed resources.</span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;disposing&quot;&gt;</span></span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;see langword=&quot;true&quot; /&gt;</span> to release both managed and unmanaged resources;</span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;see langword=&quot;false&quot; /&gt;</span> to release only unmanaged resources.</span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">Dispose</span>(<span class="params"><span class="built_in">bool</span> disposing</span>)</span></span><br><span class="line"><span class="function"></span>	&#123;</span><br><span class="line">		<span class="keyword">if</span> (!_disposed)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span> (disposing &amp;&amp; _lifetimeScope != <span class="literal">null</span>)</span><br><span class="line">			&#123;</span><br><span class="line">				((IDisposable)_lifetimeScope).Dispose();</span><br><span class="line">			&#125;</span><br><span class="line">			_disposed = <span class="literal">true</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>Autofac.Integration.WebApi.AutofacWebApiDependencyResolver</code>：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> Autofac;</span><br><span class="line"><span class="keyword">using</span> Autofac.Core.Lifetime;</span><br><span class="line"><span class="keyword">using</span> Autofac.Integration.WebApi;</span><br><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> System.Web.Http.Dependencies;</span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> Autofac implementation of the <span class="doctag">&lt;see cref=&quot;T:System.Web.Http.Dependencies.IDependencyResolver&quot; /&gt;</span> interface.</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">AutofacWebApiDependencyResolver</span> : <span class="title">IDependencyResolver</span>, <span class="title">IDependencyScope</span>, <span class="title">IDisposable</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="built_in">bool</span> _disposed;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">readonly</span> ILifetimeScope _container;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">readonly</span> IDependencyScope _rootDependencyScope;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">readonly</span> Action&lt;ContainerBuilder&gt; _configurationAction;</span><br><span class="line"></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> Gets the root container provided to the dependency resolver.</span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">	<span class="keyword">public</span> ILifetimeScope Container =&gt; _container;</span><br><span class="line"></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> Initializes a new instance of the <span class="doctag">&lt;see cref=&quot;T:Autofac.Integration.WebApi.AutofacWebApiDependencyResolver&quot; /&gt;</span> class.</span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;container&quot;&gt;</span>The container that nested lifetime scopes will be create from.<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;configurationAction&quot;&gt;</span>A configuration action that will execute during lifetime scope creation.<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">AutofacWebApiDependencyResolver</span>(<span class="params">ILifetimeScope container, Action&lt;ContainerBuilder&gt; configurationAction</span>)</span></span><br><span class="line"><span class="function">		: <span class="title">this</span>(<span class="params">container</span>)</span></span><br><span class="line"><span class="function"></span>	&#123;</span><br><span class="line">		<span class="keyword">if</span> (configurationAction == <span class="literal">null</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> ArgumentNullException(<span class="string">&quot;configurationAction&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		_configurationAction = configurationAction;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> Initializes a new instance of the <span class="doctag">&lt;see cref=&quot;T:Autofac.Integration.WebApi.AutofacWebApiDependencyResolver&quot; /&gt;</span> class.</span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;container&quot;&gt;</span>The container that nested lifetime scopes will be create from.<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">AutofacWebApiDependencyResolver</span>(<span class="params">ILifetimeScope container</span>)</span></span><br><span class="line"><span class="function"></span>	&#123;</span><br><span class="line">		<span class="keyword">if</span> (container == <span class="literal">null</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> ArgumentNullException(<span class="string">&quot;container&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		_container = container;</span><br><span class="line">		_rootDependencyScope = (IDependencyScope)(<span class="built_in">object</span>)<span class="keyword">new</span> AutofacWebApiDependencyScope(container);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> Finalizes an instance of the <span class="doctag">&lt;see cref=&quot;T:Autofac.Integration.WebApi.AutofacWebApiDependencyResolver&quot; /&gt;</span> class.</span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">	~AutofacWebApiDependencyResolver()</span><br><span class="line">	&#123;</span><br><span class="line">		Dispose(disposing: <span class="literal">false</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> Try to get a service of the given type.</span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;serviceType&quot;&gt;</span>Type of service to request.<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>An instance of the service, or null if the service is not found.<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">virtual</span> <span class="built_in">object</span> <span class="title">GetService</span>(<span class="params">Type serviceType</span>)</span></span><br><span class="line"><span class="function"></span>	&#123;</span><br><span class="line">		<span class="keyword">return</span> _rootDependencyScope.GetService(serviceType);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> Try to get a list of services of the given type.</span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;serviceType&quot;&gt;</span>ControllerType of services to request.<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>An enumeration (possibly empty) of the service.<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">virtual</span> IEnumerable&lt;<span class="built_in">object</span>&gt; <span class="title">GetServices</span>(<span class="params">Type serviceType</span>)</span></span><br><span class="line"><span class="function"></span>	&#123;</span><br><span class="line">		<span class="keyword">return</span> _rootDependencyScope.GetServices(serviceType);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> Starts a resolution scope. Objects which are resolved in the given scope will belong to</span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> that scope, and when the scope is disposed, those objects are returned to the container.</span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span></span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> The dependency scope.</span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> IDependencyScope <span class="title">BeginScope</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>	&#123;</span><br><span class="line">		<span class="keyword">return</span> (IDependencyScope)(<span class="built_in">object</span>)<span class="keyword">new</span> AutofacWebApiDependencyScope((_configurationAction == <span class="literal">null</span>) ? _container.BeginLifetimeScope(MatchingScopeLifetimeTags.RequestLifetimeScopeTag) : _container.BeginLifetimeScope(MatchingScopeLifetimeTags.RequestLifetimeScopeTag, _configurationAction));</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> Performs application-defined tasks associated with freeing, releasing, or resetting unmanaged resources.</span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Dispose</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>	&#123;</span><br><span class="line">		Dispose(disposing: <span class="literal">true</span>);</span><br><span class="line">		GC.SuppressFinalize(<span class="keyword">this</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> Releases unmanaged and - optionally - managed resources.</span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;disposing&quot;&gt;</span></span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;see langword=&quot;true&quot; /&gt;</span> to release both managed and unmanaged resources;</span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;see langword=&quot;false&quot; /&gt;</span> to release only unmanaged resources.</span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">Dispose</span>(<span class="params"><span class="built_in">bool</span> disposing</span>)</span></span><br><span class="line"><span class="function"></span>	&#123;</span><br><span class="line">		<span class="keyword">if</span> (!_disposed)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span> (disposing &amp;&amp; _rootDependencyScope != <span class="literal">null</span>)</span><br><span class="line">			&#123;</span><br><span class="line">				((IDisposable)_rootDependencyScope).Dispose();</span><br><span class="line">			&#125;</span><br><span class="line">			_disposed = <span class="literal">true</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>参考：<br></p>
<ul>
<li>GitHub - FreeSql：<a target="_blank" rel="noopener" href="https://github.com/2881099/FreeSql">2881099/FreeSql</a><br></li>
<li>GitHub - Unity: <a target="_blank" rel="noopener" href="https://github.com/unitycontainer/unity">unitycontainer/unity</a><br></li>
<li>GitHub - Autofac: <a target="_blank" rel="noopener" href="https://github.com/autofac/Autofac">autofac/Autofac</a><br></li>
<li>MSDN - ASP.NET Web API: <a target="_blank" rel="noopener" href="https://docs.microsoft.com/zh-cn/aspnet/web-api/">ASP.NET Web API</a><br></li>
<li>Autofac 中文文档: <a target="_blank" rel="noopener" href="https://autofaccn.readthedocs.io/zh/latest/index.html">欢迎来到 Autofac 中文文档!</a></li>
</ul>
</blockquote>
<blockquote>
<p>源码下载：<br></p>
<ul>
<li>Gitea：<a target="_blank" rel="noopener" href="https://git.hd2y.net/hd2y/JohnSun.SOA.WebAPI">JohnSun.SOA.WebAPI</a><br></li>
<li>百度网盘：<a target="_blank" rel="noopener" href="https://pan.baidu.com/s/17Nel1LWA8NFFRGD4iNiS-w">链接</a>  提取码：60u5</li>
</ul>
</blockquote>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/soa-asp-dot-net-web-api-di/" data-id="cklc09aoe00bj1cnihjyfdmvx" data-title="SOA —— ASP.NET Web API 依赖注入" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Autofac/" rel="tag">Autofac</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SOA/" rel="tag">SOA</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Unity/" rel="tag">Unity</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/WebApi/" rel="tag">WebApi</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5/" rel="tag">依赖注入</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/picture-drawing-of-beckman-dxh800-blood-cell-instrument/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">前一篇</strong>
      <div class="article-nav-title">
        
          贝克曼 DxH800 血球仪图片绘制问题
        
      </div>
    </a>
  
  
    <a href="/macos-use-dbeaver-to-connect-to-oracle-databases/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">后一篇</strong>
      <div class="article-nav-title">MacOS 使用 DBeaver 连接 Oracle 数据库</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">分类</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%BC%80%E5%8F%91/">开发</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%BC%80%E5%8F%91/C/">C#</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%BC%80%E5%8F%91/C/ASP-NET-Core/">ASP.NET Core</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%BC%80%E5%8F%91/C/WPF/">WPF</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%BC%80%E5%8F%91/%E4%B8%9A%E5%8A%A1/">业务</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%BC%80%E5%8F%91/%E5%89%8D%E7%AB%AF/">前端</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%BC%80%E5%8F%91/%E5%9F%BA%E7%A1%80/">基础</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%BC%80%E5%8F%91/%E5%B7%A5%E5%85%B7/">工具</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%BC%80%E5%8F%91/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%BC%80%E5%8F%91/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL/">MySQL</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%BC%80%E5%8F%91/%E6%95%B0%E6%8D%AE%E5%BA%93/Oracle/">Oracle</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%BC%80%E5%8F%91/%E6%95%B0%E6%8D%AE%E5%BA%93/PostgreSQL/">PostgreSQL</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%BC%80%E5%8F%91/%E6%95%B0%E6%8D%AE%E5%BA%93/SQLite/">SQLite</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%BC%80%E5%8F%91/%E6%9D%82%E8%B0%88/">杂谈</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/">操作系统</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/MacOS/">MacOS</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E5%B7%A5%E5%85%B7/">工具</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E8%BD%AF%E4%BB%B6/">软件</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%97%A5%E5%BF%97/">日志</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%97%A5%E5%BF%97/%E5%85%AC%E5%91%8A/">公告</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%97%A5%E5%BF%97/%E5%BC%80%E7%AE%B1/">开箱</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%97%A5%E5%BF%97/%E6%9D%82%E8%B0%88/">杂谈</a></li></ul></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/NET-Standard/" rel="tag">.NET Standard</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/AOP/" rel="tag">AOP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ASCII/" rel="tag">ASCII</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ActiveX/" rel="tag">ActiveX</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Attribute/" rel="tag">Attribute</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Autofac/" rel="tag">Autofac</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/BFG/" rel="tag">BFG</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CCProxy/" rel="tag">CCProxy</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Chrome/" rel="tag">Chrome</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DBeaver/" rel="tag">DBeaver</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Expression/" rel="tag">Expression</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Fody/" rel="tag">Fody</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GDI/" rel="tag">GDI</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Git/" rel="tag">Git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GitHub/" rel="tag">GitHub</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Gitea/" rel="tag">Gitea</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HIS/" rel="tag">HIS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HongYang/" rel="tag">HongYang</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/IDE/" rel="tag">IDE</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/IE/" rel="tag">IE</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JavaScript/" rel="tag">JavaScript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Jint/" rel="tag">Jint</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Json/" rel="tag">Json</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Kindle/" rel="tag">Kindle</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/LIS/" rel="tag">LIS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/LODOP/" rel="tag">LODOP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MVC/" rel="tag">MVC</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MacOS/" rel="tag">MacOS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Math/" rel="tag">Math</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NHibernate/" rel="tag">NHibernate</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Nexus3/" rel="tag">Nexus3</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Note/" rel="tag">Note</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NuGet/" rel="tag">NuGet</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/OOP/" rel="tag">OOP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Oracle/" rel="tag">Oracle</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SOA/" rel="tag">SOA</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SSH/" rel="tag">SSH</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Shell/" rel="tag">Shell</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TCP/" rel="tag">TCP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Telegram/" rel="tag">Telegram</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TreeView/" rel="tag">TreeView</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Tuple/" rel="tag">Tuple</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/UI/" rel="tag">UI</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/UML/" rel="tag">UML</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Unity/" rel="tag">Unity</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/VS/" rel="tag">VS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/VSCode/" rel="tag">VSCode</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ValueTuple/" rel="tag">ValueTuple</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/WCF/" rel="tag">WCF</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/WPF/" rel="tag">WPF</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/WebApi/" rel="tag">WebApi</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/WebService/" rel="tag">WebService</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/WinForm/" rel="tag">WinForm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Windows/" rel="tag">Windows</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Windows-XP/" rel="tag">Windows XP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Xml/" rel="tag">Xml</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/decimal/" rel="tag">decimal</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/frp/" rel="tag">frp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jdbc/" rel="tag">jdbc</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mstsc/" rel="tag">mstsc</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%B8%B2%E5%8F%A3/" rel="tag">串口</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BB%A3%E7%90%86/" rel="tag">代理</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5/" rel="tag">依赖注入</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%85%83%E7%BB%84/" rel="tag">元组</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8A%A0%E5%AF%86/" rel="tag">加密</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8A%A8%E6%80%81%E9%93%BE%E6%8E%A5%E5%BA%93/" rel="tag">动态链接库</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8F%8D%E5%B0%84/" rel="tag">反射</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/" rel="tag">多线程</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%A7%94%E6%89%98/" rel="tag">委托</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B7%A5%E5%85%B7/" rel="tag">工具</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B9%B4%E9%BE%84/" rel="tag">年龄</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%BA%8F%E5%88%97%E5%8C%96/" rel="tag">序列化</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%BC%83%E5%85%83/" rel="tag">弃元</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%89%93%E5%8D%B0/" rel="tag">打印</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%97%A5%E5%BF%97/" rel="tag">日志</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0/" rel="tag">构造函数</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%9E%90%E6%9E%84%E5%87%BD%E6%95%B0/" rel="tag">析构函数</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%9E%9A%E4%B8%BE/" rel="tag">枚举</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%AD%A3%E5%88%99/" rel="tag">正则</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%B3%9B%E5%9E%8B/" rel="tag">泛型</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%88%AC%E8%99%AB/" rel="tag">爬虫</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%91%9E%E7%BE%8E/" rel="tag">瑞美</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%99%9A%E6%8B%9F%E6%9C%BA/" rel="tag">虚拟机</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%A1%80%E7%90%83%E4%BB%AA/" rel="tag">血球仪</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%A7%A3%E6%9E%84%E5%87%BD%E6%95%B0/" rel="tag">解构函数</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" rel="tag">设计模式</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%B0%83%E8%AF%95/" rel="tag">调试</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%B4%9D%E5%85%8B%E6%9B%BC/" rel="tag">贝克曼</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%BA%AB%E4%BB%BD%E8%AF%81%E8%AF%BB%E5%8D%A1/" rel="tag">身份证读卡</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%BD%AF%E4%BB%B6/" rel="tag">软件</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%BF%9C%E7%A8%8B/" rel="tag">远程</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%97%AA%E9%80%80/" rel="tag">闪退</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%A1%B9%E7%9B%AE/" rel="tag">项目</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/NET-Standard/" style="font-size: 10px;">.NET Standard</a> <a href="/tags/AOP/" style="font-size: 10px;">AOP</a> <a href="/tags/ASCII/" style="font-size: 10px;">ASCII</a> <a href="/tags/ActiveX/" style="font-size: 10px;">ActiveX</a> <a href="/tags/Attribute/" style="font-size: 10px;">Attribute</a> <a href="/tags/Autofac/" style="font-size: 10px;">Autofac</a> <a href="/tags/BFG/" style="font-size: 10px;">BFG</a> <a href="/tags/CCProxy/" style="font-size: 10px;">CCProxy</a> <a href="/tags/Chrome/" style="font-size: 10px;">Chrome</a> <a href="/tags/DBeaver/" style="font-size: 12.5px;">DBeaver</a> <a href="/tags/Expression/" style="font-size: 10px;">Expression</a> <a href="/tags/Fody/" style="font-size: 10px;">Fody</a> <a href="/tags/GDI/" style="font-size: 10px;">GDI</a> <a href="/tags/Git/" style="font-size: 12.5px;">Git</a> <a href="/tags/GitHub/" style="font-size: 12.5px;">GitHub</a> <a href="/tags/Gitea/" style="font-size: 10px;">Gitea</a> <a href="/tags/HIS/" style="font-size: 12.5px;">HIS</a> <a href="/tags/HongYang/" style="font-size: 10px;">HongYang</a> <a href="/tags/IDE/" style="font-size: 10px;">IDE</a> <a href="/tags/IE/" style="font-size: 10px;">IE</a> <a href="/tags/JavaScript/" style="font-size: 12.5px;">JavaScript</a> <a href="/tags/Jint/" style="font-size: 12.5px;">Jint</a> <a href="/tags/Json/" style="font-size: 10px;">Json</a> <a href="/tags/Kindle/" style="font-size: 10px;">Kindle</a> <a href="/tags/LIS/" style="font-size: 15px;">LIS</a> <a href="/tags/LODOP/" style="font-size: 10px;">LODOP</a> <a href="/tags/MVC/" style="font-size: 10px;">MVC</a> <a href="/tags/MacOS/" style="font-size: 10px;">MacOS</a> <a href="/tags/Math/" style="font-size: 10px;">Math</a> <a href="/tags/NHibernate/" style="font-size: 10px;">NHibernate</a> <a href="/tags/Nexus3/" style="font-size: 10px;">Nexus3</a> <a href="/tags/Note/" style="font-size: 10px;">Note</a> <a href="/tags/NuGet/" style="font-size: 10px;">NuGet</a> <a href="/tags/OOP/" style="font-size: 10px;">OOP</a> <a href="/tags/Oracle/" style="font-size: 10px;">Oracle</a> <a href="/tags/SOA/" style="font-size: 17.5px;">SOA</a> <a href="/tags/SSH/" style="font-size: 10px;">SSH</a> <a href="/tags/Shell/" style="font-size: 10px;">Shell</a> <a href="/tags/TCP/" style="font-size: 10px;">TCP</a> <a href="/tags/Telegram/" style="font-size: 10px;">Telegram</a> <a href="/tags/TreeView/" style="font-size: 10px;">TreeView</a> <a href="/tags/Tuple/" style="font-size: 10px;">Tuple</a> <a href="/tags/UI/" style="font-size: 10px;">UI</a> <a href="/tags/UML/" style="font-size: 10px;">UML</a> <a href="/tags/Unity/" style="font-size: 10px;">Unity</a> <a href="/tags/VS/" style="font-size: 10px;">VS</a> <a href="/tags/VSCode/" style="font-size: 10px;">VSCode</a> <a href="/tags/ValueTuple/" style="font-size: 10px;">ValueTuple</a> <a href="/tags/WCF/" style="font-size: 12.5px;">WCF</a> <a href="/tags/WPF/" style="font-size: 10px;">WPF</a> <a href="/tags/WebApi/" style="font-size: 15px;">WebApi</a> <a href="/tags/WebService/" style="font-size: 15px;">WebService</a> <a href="/tags/WinForm/" style="font-size: 10px;">WinForm</a> <a href="/tags/Windows/" style="font-size: 10px;">Windows</a> <a href="/tags/Windows-XP/" style="font-size: 12.5px;">Windows XP</a> <a href="/tags/Xml/" style="font-size: 10px;">Xml</a> <a href="/tags/decimal/" style="font-size: 10px;">decimal</a> <a href="/tags/frp/" style="font-size: 10px;">frp</a> <a href="/tags/jdbc/" style="font-size: 10px;">jdbc</a> <a href="/tags/mstsc/" style="font-size: 10px;">mstsc</a> <a href="/tags/%E4%B8%B2%E5%8F%A3/" style="font-size: 10px;">串口</a> <a href="/tags/%E4%BB%A3%E7%90%86/" style="font-size: 12.5px;">代理</a> <a href="/tags/%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5/" style="font-size: 10px;">依赖注入</a> <a href="/tags/%E5%85%83%E7%BB%84/" style="font-size: 12.5px;">元组</a> <a href="/tags/%E5%8A%A0%E5%AF%86/" style="font-size: 10px;">加密</a> <a href="/tags/%E5%8A%A8%E6%80%81%E9%93%BE%E6%8E%A5%E5%BA%93/" style="font-size: 10px;">动态链接库</a> <a href="/tags/%E5%8F%8D%E5%B0%84/" style="font-size: 10px;">反射</a> <a href="/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/" style="font-size: 20px;">多线程</a> <a href="/tags/%E5%A7%94%E6%89%98/" style="font-size: 10px;">委托</a> <a href="/tags/%E5%B7%A5%E5%85%B7/" style="font-size: 10px;">工具</a> <a href="/tags/%E5%B9%B4%E9%BE%84/" style="font-size: 10px;">年龄</a> <a href="/tags/%E5%BA%8F%E5%88%97%E5%8C%96/" style="font-size: 10px;">序列化</a> <a href="/tags/%E5%BC%83%E5%85%83/" style="font-size: 10px;">弃元</a> <a href="/tags/%E6%89%93%E5%8D%B0/" style="font-size: 10px;">打印</a> <a href="/tags/%E6%97%A5%E5%BF%97/" style="font-size: 10px;">日志</a> <a href="/tags/%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0/" style="font-size: 10px;">构造函数</a> <a href="/tags/%E6%9E%90%E6%9E%84%E5%87%BD%E6%95%B0/" style="font-size: 10px;">析构函数</a> <a href="/tags/%E6%9E%9A%E4%B8%BE/" style="font-size: 10px;">枚举</a> <a href="/tags/%E6%AD%A3%E5%88%99/" style="font-size: 15px;">正则</a> <a href="/tags/%E6%B3%9B%E5%9E%8B/" style="font-size: 12.5px;">泛型</a> <a href="/tags/%E7%88%AC%E8%99%AB/" style="font-size: 10px;">爬虫</a> <a href="/tags/%E7%91%9E%E7%BE%8E/" style="font-size: 10px;">瑞美</a> <a href="/tags/%E8%99%9A%E6%8B%9F%E6%9C%BA/" style="font-size: 12.5px;">虚拟机</a> <a href="/tags/%E8%A1%80%E7%90%83%E4%BB%AA/" style="font-size: 10px;">血球仪</a> <a href="/tags/%E8%A7%A3%E6%9E%84%E5%87%BD%E6%95%B0/" style="font-size: 10px;">解构函数</a> <a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" style="font-size: 12.5px;">设计模式</a> <a href="/tags/%E8%B0%83%E8%AF%95/" style="font-size: 10px;">调试</a> <a href="/tags/%E8%B4%9D%E5%85%8B%E6%9B%BC/" style="font-size: 10px;">贝克曼</a> <a href="/tags/%E8%BA%AB%E4%BB%BD%E8%AF%81%E8%AF%BB%E5%8D%A1/" style="font-size: 10px;">身份证读卡</a> <a href="/tags/%E8%BD%AF%E4%BB%B6/" style="font-size: 10px;">软件</a> <a href="/tags/%E8%BF%9C%E7%A8%8B/" style="font-size: 10px;">远程</a> <a href="/tags/%E9%97%AA%E9%80%80/" style="font-size: 10px;">闪退</a> <a href="/tags/%E9%A1%B9%E7%9B%AE/" style="font-size: 10px;">项目</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">十二月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">十一月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">九月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">五月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">四月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">三月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">二月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">一月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">十二月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">十一月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">十月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">九月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">八月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">七月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">五月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">四月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">三月 2019</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/csharp-expression-script-evaluation-problems/">C# 中表达式计算问题</a>
          </li>
        
          <li>
            <a href="/aspnet-core-001-source-code-compilation-and-debugging/">ASP.NET Core - 001 源码编译与调试</a>
          </li>
        
          <li>
            <a href="/aspnet-core-000-development-environment-configuration/">ASP.NET Core - 000 开发环境配置</a>
          </li>
        
          <li>
            <a href="/dotnet-core-migration-web-service/">迁移 Web Service 项目到 .NET Core</a>
          </li>
        
          <li>
            <a href="/his-development-environment/">环境部署</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2021 hd2y<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>