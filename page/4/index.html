<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>åç¯</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="ç›ˆæœˆèˆæ¸…é£ï¼Œåç¯è‡ªæ‘‡æ›³ã€‚">
<meta property="og:type" content="website">
<meta property="og:title" content="åç¯">
<meta property="og:url" content="https://hd2y.github.io/page/4/index.html">
<meta property="og:site_name" content="åç¯">
<meta property="og:description" content="ç›ˆæœˆèˆæ¸…é£ï¼Œåç¯è‡ªæ‘‡æ›³ã€‚">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="hd2y">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="åç¯" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 5.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">åç¯</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS è®¢é˜…"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="æœç´¢"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="æœç´¢"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://hd2y.github.io"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-191202-soa-asp-dot-net-web-api-di" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/soa-asp-dot-net-web-api-di/" class="article-date">
  <time class="dt-published" datetime="2019-12-02T11:15:37.000Z" itemprop="datePublished">2019-12-02</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%BC%80%E5%8F%91/">å¼€å‘</a>â–º<a class="article-category-link" href="/categories/%E5%BC%80%E5%8F%91/C/">C#</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/soa-asp-dot-net-web-api-di/">SOA â€”â€” ASP.NET Web API ä¾èµ–æ³¨å…¥</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>ä¾èµ–æ³¨å…¥ï¼ˆDependency Injectionï¼Œç¼©å†™DIï¼‰æ˜¯å°†ç³»ç»Ÿä¸­å„å±‚å¯¹è±¡è§£è€¦çš„ä¸€ç§æ–¹å¼ï¼Œæ˜¯å®ç°æ§åˆ¶åè½¬ï¼ˆInversion of Controlï¼Œç¼©å†™IoCï¼‰çš„ä¸€ç§å¸¸ç”¨æ–¹å¼ã€‚</p>
<h2 id="æ­å»ºæ¡†æ¶"><a href="#æ­å»ºæ¡†æ¶" class="headerlink" title="æ­å»ºæ¡†æ¶"></a>æ­å»ºæ¡†æ¶</h2><p>é¦–å…ˆæˆ‘ä»¬æ­å»ºä¸€ä¸ªç”¨äºæµ‹è¯•çš„åŸºæœ¬æ¡†æ¶ï¼Œå› ä¸ºæœ€è¿‘åœ¨äº†è§£ <code>FreeSql</code>ï¼Œæ‰€ä»¥æ•°æ®è®¿é—®å°±ä½¿ç”¨ <code>FreeSql</code>ï¼Œåœ¨è¿™é‡Œæ¨èä¸€ä¸‹è¿™ä¸ªé¡¹ç›®ï¼Œå¶è€æ¿çœŸçš„å¾ˆğŸ‚ğŸºã€‚</p>
<p>ä¸‹å›¾å¯ä»¥çœ‹å‡ºé¡¹ç›®çš„ç®€å•æ¶æ„ï¼š</p>
<p><img src="https://hd2y.oss-cn-beijing.aliyuncs.com/20191130104028_1575284957637.png" alt="20191130104028"></p>
<h3 id="å®ä½“"><a href="#å®ä½“" class="headerlink" title="å®ä½“"></a>å®ä½“</h3><p>å®ä½“å±‚å®šä¹‰äº†å®ä½“çš„æ¥å£ <code>IBaseEntity</code> ï¼š</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">IBaseEntity</span></span><br><span class="line">&#123;</span><br><span class="line">    [<span class="meta">Column(IsPrimary = true, IsIdentity = true)</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">long</span> Id &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> DateTime CreateTime &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125; = DateTime.Now;</span><br><span class="line">    <span class="keyword">public</span> DateTime UpdateTime &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125; = DateTime.Now;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ ‡æœ¬ç±» <code>Specimen</code>ï¼š</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Specimen</span> : <span class="title">IBaseEntity</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> DateTime InspectionDate &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> Type &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> SpeicimenNo &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> State &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> Barcode &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> DateTime? ResultTime &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span>? ResultUserId &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> DateTime? CheckTime &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span>? CheckUserId &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> DateTime? ReportTime &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span>? ReportUserId &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="æœåŠ¡æ¥å£"><a href="#æœåŠ¡æ¥å£" class="headerlink" title="æœåŠ¡æ¥å£"></a>æœåŠ¡æ¥å£</h3><p>æœåŠ¡æ¥å£é¦–å…ˆå®šä¹‰äº†æœåŠ¡å¸¸ç”¨çš„ä¸€äº›æ“ä½œ <code>IBaseService</code>ï¼š</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">IBaseService</span>&lt;<span class="title">T</span>&gt; <span class="keyword">where</span> <span class="title">T</span> : <span class="title">IBaseEntity</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function">T <span class="title">Insert</span>(<span class="params">T t</span>)</span>;</span><br><span class="line">    <span class="function">T <span class="title">Get</span>(<span class="params"><span class="built_in">int</span> id</span>)</span>;</span><br><span class="line">    <span class="function">T <span class="title">Update</span>(<span class="params">T t</span>)</span>;</span><br><span class="line">    <span class="function"><span class="built_in">bool</span> <span class="title">Delete</span>(<span class="params"><span class="built_in">int</span> id</span>)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç„¶åä¸åŒçš„ä¸šåŠ¡å®ä½“ï¼Œä¹Ÿæœ‰è‡ªå·±çš„ä¸šåŠ¡é€»è¾‘ <code>ISpecimenService</code>ï¼š</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">ISpecimenService</span> : <span class="title">IBaseService</span>&lt;<span class="title">Specimen</span>&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="function">Specimen <span class="title">CheckSpecimen</span>(<span class="params"><span class="built_in">int</span> specimenId, <span class="built_in">int</span> userId</span>)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="æœåŠ¡å®ç°"><a href="#æœåŠ¡å®ç°" class="headerlink" title="æœåŠ¡å®ç°"></a>æœåŠ¡å®ç°</h3><p>æœåŠ¡æ¥å£çš„å®ç°ï¼Œé¦–å…ˆæ˜¯ <code>IBaseService</code> çš„å®ç° <code>BaseService</code>ï¼š</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">BaseService</span>&lt;<span class="title">T</span>&gt; : <span class="title">IBaseService</span>&lt;<span class="title">T</span>&gt; <span class="keyword">where</span> <span class="title">T</span> : <span class="title">IBaseEntity</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">virtual</span> IFreeSql FreeSql &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BaseService</span>(<span class="params">IFreeSql freeSql</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        FreeSql = freeSql;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">virtual</span> <span class="built_in">bool</span> <span class="title">Delete</span>(<span class="params"><span class="built_in">int</span> id</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">return</span> FreeSql.Delete&lt;T&gt;(id).ExecuteAffrows() &gt; <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">virtual</span> T <span class="title">Get</span>(<span class="params"><span class="built_in">int</span> id</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">return</span> FreeSql.Select&lt;T&gt;(id).First();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">virtual</span> T <span class="title">Insert</span>(<span class="params">T t</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="built_in">int</span> id = (<span class="built_in">int</span>)FreeSql.Insert&lt;T&gt;().AppendData(t).ExecuteIdentity();</span><br><span class="line">        <span class="keyword">return</span> FreeSql.Select&lt;T&gt;(id).First();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">virtual</span> T <span class="title">Update</span>(<span class="params">T t</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        t.UpdateTime = DateTime.Now;</span><br><span class="line">        <span class="built_in">int</span> rows = FreeSql.Update&lt;T&gt;(t).ExecuteAffrows();</span><br><span class="line">        <span class="keyword">if</span> (rows == <span class="number">1</span>)</span><br><span class="line">            <span class="keyword">return</span> FreeSql.Select&lt;T&gt;(t.Id).First();</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>ISpecimenService</code> çš„å®ç° <code>SpecimenService</code>ï¼š</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">SpecimenService</span> : <span class="title">BaseService</span>&lt;<span class="title">Specimen</span>&gt;, <span class="title">ISpecimenService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SpecimenService</span>(<span class="params">IFreeSql freeSql</span>) : <span class="title">base</span>(<span class="params">freeSql</span>)</span> &#123; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Specimen <span class="title">CheckSpecimen</span>(<span class="params"><span class="built_in">int</span> specimenId, <span class="built_in">int</span> userId</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">return</span> FreeSql.Update&lt;Specimen&gt;().Set(s =&gt; <span class="keyword">new</span> &#123; CheckUserId = userId, CheckTime = DateTime.Now &#125;).ExecuteUpdated().First();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Web-ç«™ç‚¹"><a href="#Web-ç«™ç‚¹" class="headerlink" title="Web ç«™ç‚¹"></a>Web ç«™ç‚¹</h3><p>é¦–å…ˆæ˜¯éœ€è¦åˆ›å»ºç”¨äºåˆå§‹åŒ– <code>FreeSql</code> çš„å·¥å‚ <code>FreeSqlFactory</code>ï¼š</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">FreeSqlFactory</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> IFreeSql FreeSql &#123; <span class="keyword">get</span>; <span class="keyword">private</span> <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="title">FreeSqlFactory</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        FreeSql = <span class="keyword">new</span> FreeSql.FreeSqlBuilder()</span><br><span class="line">                  .UseConnectionString(global::FreeSql.DataType.Sqlite, &quot;Data Source=|DataDirectory|\\data.db;Pooling=true;Max Pool Size=10&quot;)</span><br><span class="line">                  .UseAutoSyncStructure(<span class="literal">true</span>)</span><br><span class="line">                  .Build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œä¸»è¦æ˜¯æƒ³è®©è¯¥é¡¹ç›®ç®€å•ä¸€äº›ï¼Œæ‰€ä»¥åªè€ƒè™‘æœåŠ¡å±‚ <code>JohnSun.SOA.WebAPI.Service</code> çš„æ³¨å…¥ï¼Œæ‰€ä»¥ç›´æ¥å°†æ•°æ®åº“è®¿é—®å±‚ä¾èµ–ç»†èŠ‚ï¼Œä½¿ç”¨ <code>SQLite</code> æ•°æ®åº“ï¼Œå¹¶ä½¿ç”¨ <code>FreeSql</code> çš„ <code>CodeFirst</code> æ¨¡å¼ã€‚</p>
<p>ç„¶åå°±åˆ›å»ºä¸€ä¸ª <code>Web API</code> æ§åˆ¶å™¨ <code>SpecimensController</code>ï¼š</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">SpecimensController</span> : <span class="title">ApiController</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Specimen <span class="title">Get</span>(<span class="params"><span class="built_in">int</span> id</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        SpecimenService service = <span class="keyword">new</span> SpecimenService(FreeSqlFactory.FreeSql);</span><br><span class="line">        <span class="keyword">return</span> service.Get(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Specimen <span class="title">Post</span>(<span class="params">DateTime inspectionDate, <span class="built_in">string</span> speicimenNo, <span class="built_in">int</span> type, <span class="built_in">string</span> barcode = <span class="literal">null</span></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        SpecimenService service = <span class="keyword">new</span> SpecimenService(FreeSqlFactory.FreeSql);</span><br><span class="line">        <span class="keyword">return</span> service.Insert(<span class="keyword">new</span> Specimen &#123; InspectionDate = inspectionDate, SpeicimenNo = speicimenNo, Type = type, Barcode = barcode &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œåªæä¾›ä¸¤ä¸ªç®€å•çš„æ–¹æ³•ï¼Œä¸€ä¸ªæ–°å¢æ–¹æ³•ï¼Œä¸€ä¸ªé€šè¿‡IdæŸ¥è¯¢æ•°æ®ã€‚</p>
<h3 id="è®¿é—®æµ‹è¯•"><a href="#è®¿é—®æµ‹è¯•" class="headerlink" title="è®¿é—®æµ‹è¯•"></a>è®¿é—®æµ‹è¯•</h3><p>æˆªæ­¢åˆ°ç›®å‰ï¼Œä¸€ä¸ªç®€å•çš„æµ‹è¯•é¡¹ç›®åˆ›å»ºå®Œæˆï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>postman</code> å¯¹é¡¹ç›®è¿›è¡Œç®€å•çš„æµ‹è¯•ã€‚</p>
<p>é¦–å…ˆæ˜¯è°ƒç”¨ <code>POST</code> æ–¹æ³•ï¼Œæ–°å¢æ ‡æœ¬ <code>http://localhost:58683/api/specimens?inspectionDate=2019-11-30&amp;speicimenNo=1001&amp;type=0</code>ï¼š</p>
<p><img src="https://hd2y.oss-cn-beijing.aliyuncs.com/20191130101621_1575284957660.png" alt="20191130101621"></p>
<p>è¿”å›çš„æ˜¯ä¸€ä¸ªåˆ›å»ºæˆåŠŸåçš„æ•°æ®åº“å®ä½“ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ä¸ªå¯¹è±¡çš„ <code>id</code> å†ä½¿ç”¨ <code>GET</code> æ–¹æ³•è¿›è¡ŒæŸ¥è¯¢ <code>http://localhost:58683/api/specimens/1</code>ï¼š</p>
<p><img src="https://hd2y.oss-cn-beijing.aliyuncs.com/20191130101643_1575284957659.png" alt="20191130101643"></p>
<h2 id="Unity-å®ç°ä¾èµ–æ³¨å…¥"><a href="#Unity-å®ç°ä¾èµ–æ³¨å…¥" class="headerlink" title="Unity å®ç°ä¾èµ–æ³¨å…¥"></a>Unity å®ç°ä¾èµ–æ³¨å…¥</h2><p>ä¸ºäº†æ–¹ä¾¿ç†è§£ï¼Œæˆ‘ä»¬å°†ç§»é™¤ä¾èµ–å…·ä½“å®ç°çš„æ­¥éª¤ç½—åˆ—å‡ºæ¥ï¼Œæ–¹ä¾¿å¯¹æ§åˆ¶åè½¬çš„å®ç°æœ‰ä¸€ä¸ªç®€å•çš„äº†è§£ã€‚</p>
<h3 id="ä½¿ç”¨-Unity-åˆ›å»ºå¯¹è±¡"><a href="#ä½¿ç”¨-Unity-åˆ›å»ºå¯¹è±¡" class="headerlink" title="ä½¿ç”¨ Unity åˆ›å»ºå¯¹è±¡"></a>ä½¿ç”¨ Unity åˆ›å»ºå¯¹è±¡</h3><p>é¦–å…ˆæˆ‘ä»¬å°†å¯¹è±¡çš„åˆ›å»ºç§»äº¤ç»™ <code>Unity</code>ï¼Œé¦–å…ˆæˆ‘ä»¬ä½¿ç”¨ <code>nuget</code> ä¸º <code>Web</code> é¡¹ç›®æ·»åŠ  <code>Unity</code> çš„åŒ…å¼•ç”¨ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Install-Package Unity -Version 5.11.1</span><br></pre></td></tr></table></figure>
<p>ç„¶åæˆ‘ä»¬æ·»åŠ ä¸€ä¸ªç»Ÿä¸€çš„ä¾èµ–æ³¨å…¥å®¹å™¨ï¼Œå°†éœ€è¦ç”¨åˆ°çš„ç±»å‹æ³¨å†Œåˆ°å®¹å™¨ä¸­ï¼š</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">IUnityContainer container = <span class="keyword">new</span> UnityContainer();</span><br><span class="line"><span class="comment">// æ³¨å†Œå•ä¾‹ å› ä¸º ISpecimenService çš„æ„é€ å‡½æ•°éœ€è¦æä¾›ä¸€ä¸ª IFreeSql çš„å‚æ•°</span></span><br><span class="line">container.RegisterInstance(FreeSqlFactory.FreeSql);</span><br><span class="line"><span class="comment">// æ³¨å†Œ SpecimenService åˆ° ISpecimenService</span></span><br><span class="line">container.RegisterType&lt;ISpecimenService, SpecimenService&gt;();</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·æˆ‘ä»¬åˆ›å»º <code>ISpecimenService</code> çš„å®ä¾‹å¯¹è±¡å°±ä¸éœ€è¦å†ä¾èµ–ç»†èŠ‚ <code>SpecimenService</code>ï¼š</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ISpecimenService service = container.Resolve&lt;ISpecimenService&gt;();</span><br></pre></td></tr></table></figure>
<h3 id="è°ƒæ•´ä¸ºå·¥å‚"><a href="#è°ƒæ•´ä¸ºå·¥å‚" class="headerlink" title="è°ƒæ•´ä¸ºå·¥å‚"></a>è°ƒæ•´ä¸ºå·¥å‚</h3><p>æˆ‘ä»¬å¹¶ä¸éœ€è¦æ¯æ¬¡åˆå§‹åŒ– <code>ISpecimenService</code> éƒ½åˆ›å»ºä¸€ä¸ªä¾èµ–æ³¨å…¥çš„å®¹å™¨ï¼Œå®é™…ä¸Šè¿™ä¸ªå®¹å™¨åªéœ€è¦åˆ›å»ºä¸€æ¬¡ï¼Œæ‰€ä»¥æˆ‘ä»¬å¢åŠ ä¸€ä¸ª <code>ContainerFactory</code> çš„ç±»å‹ï¼š</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ContainerFactory</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> IUnityContainer Container &#123; <span class="keyword">get</span>; <span class="keyword">private</span> <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="title">ContainerFactory</span>(<span class="params"></span>) </span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        Container = <span class="keyword">new</span> UnityContainer();</span><br><span class="line">        Container.RegisterInstance(FreeSqlFactory.FreeSql);</span><br><span class="line">        Container.RegisterType&lt;ISpecimenService, SpecimenService&gt;();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç„¶åè°ƒæ•´æˆ‘ä»¬çš„æ§åˆ¶å™¨ <code>SpecimensController</code>ï¼š</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Specimen <span class="title">Get</span>(<span class="params"><span class="built_in">int</span> id</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ISpecimenService service = ContainerFactory.Container.Resolve&lt;ISpecimenService&gt;();</span><br><span class="line">    <span class="keyword">return</span> service.Get(id);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> Specimen <span class="title">Post</span>(<span class="params">DateTime inspectionDate, <span class="built_in">string</span> speicimenNo, <span class="built_in">int</span> type, <span class="built_in">string</span> barcode = <span class="literal">null</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ISpecimenService service = ContainerFactory.Container.Resolve&lt;ISpecimenService&gt;();</span><br><span class="line">    <span class="keyword">return</span> service.Insert(<span class="keyword">new</span> Specimen &#123; InspectionDate = inspectionDate, SpeicimenNo = speicimenNo, Type = type, Barcode = barcode &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="è°ƒæ•´ä¸ºä½¿ç”¨é…ç½®æ–‡ä»¶"><a href="#è°ƒæ•´ä¸ºä½¿ç”¨é…ç½®æ–‡ä»¶" class="headerlink" title="è°ƒæ•´ä¸ºä½¿ç”¨é…ç½®æ–‡ä»¶"></a>è°ƒæ•´ä¸ºä½¿ç”¨é…ç½®æ–‡ä»¶</h3><p>å› ä¸º <code>ContainerFactory</code> å·¥å‚ç±»æ³¨å†Œæ—¶ä»ç„¶å­˜åœ¨ <code>SpecimenService</code>ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦å°†æ”¹ç±»å‹ä»ä¸Šå±‚ä¸­ç§»é™¤ï¼Œå¦åˆ™æˆ‘ä»¬ä»ç„¶æ— æ³•æŒ‡å®š <code>ISpecimenService</code>ã€‚</p>
<p>Unity ä¸ºæˆ‘ä»¬æä¾›äº†ä½¿ç”¨é…ç½®æ–‡ä»¶åˆå§‹åŒ–ä¾èµ–æ³¨å…¥å®¹å™¨çš„æ–¹æ¡ˆï¼Œæ‰€ä»¥é¦–å…ˆæˆ‘ä»¬ç§»é™¤ <code>Web</code> å¯¹äº <code>JohnSun.SOA.WebAPI.Service</code> é¡¹ç›®çš„å¼•ç”¨ï¼Œä½¿æœåŠ¡ä¸å†å¼ºä¾èµ–äºè¯¥é¡¹ç›®ï¼Œæ–¹ä¾¿åæœŸå¯¹äº§å“çš„å‡çº§æ”¹é€ ã€‚</p>
<p>ä½†æ˜¯æµ‹è¯•é¡¹ç›®ä»ç„¶éœ€è¦ä¸€ä¸ªå®ç°ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨ç§»é™¤ä¾èµ–åï¼Œæ‰‹åŠ¨çš„å°† <code>JohnSun.SOA.WebAPI.Service/bin</code> ç›®å½•ä¸‹çš„æ–‡ä»¶æ‹·è´åˆ° <code>JohnSun.SOA.WebAPI.Server/bin</code> ä¸‹ã€‚</p>
<p>æ·»åŠ  <code>Unity.Configuration</code> çš„å¼•ç”¨ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Install-Package Unity.Configuration -Version 5.11.1</span><br></pre></td></tr></table></figure>
<p>åœ¨ <code>Web</code> é¡¹ç›®ä¸­æ·»åŠ é…ç½®æ–‡ä»¶ <code>ConfigFiles/Unity.config</code>ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">configSections</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">section</span> <span class="attr">name</span>=<span class="string">&quot;unity&quot;</span> <span class="attr">type</span>=<span class="string">&quot;Microsoft.Practices.Unity.Configuration.UnityConfigurationSection, Unity.Configuration&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">configSections</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">unity</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aliases</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">add</span> <span class="attr">alias</span>=<span class="string">&quot;ISpecimenService&quot;</span> <span class="attr">type</span>=<span class="string">&quot;JohnSun.SOA.WebAPI.Interface.ISpecimenService, JohnSun.SOA.WebAPI.Interface&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">add</span> <span class="attr">alias</span>=<span class="string">&quot;SpecimenService&quot;</span> <span class="attr">type</span>=<span class="string">&quot;JohnSun.SOA.WebAPI.Service.SpecimenService, JohnSun.SOA.WebAPI.Service&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">aliases</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">container</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">register</span> <span class="attr">type</span>=<span class="string">&quot;ISpecimenService&quot;</span> <span class="attr">mapTo</span>=<span class="string">&quot;SpecimenService&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">container</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">unity</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>è°ƒæ•´ <code>ContainerFactory</code> çš„é™æ€æ„é€ å‡½æ•°ä»£ç ï¼š</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Container = <span class="keyword">new</span> UnityContainer();</span><br><span class="line">Container.RegisterInstance(FreeSqlFactory.FreeSql);</span><br><span class="line"></span><br><span class="line"><span class="built_in">string</span> configPath = Path.Combine(AppDomain.CurrentDomain.BaseDirectory, <span class="string">@&quot;ConfigFiles\Unity.config&quot;</span>);</span><br><span class="line">ExeConfigurationFileMap map = <span class="keyword">new</span> ExeConfigurationFileMap &#123; ExeConfigFilename = configPath &#125;;</span><br><span class="line">Configuration configuration = ConfigurationManager.OpenMappedExeConfiguration(map, ConfigurationUserLevel.None);</span><br><span class="line">UnityConfigurationSection section = (UnityConfigurationSection)configuration.GetSection(UnityConfigurationSection.SectionName);</span><br><span class="line"></span><br><span class="line">section.Configure(Container);</span><br></pre></td></tr></table></figure>
<p>è¿™æ—¶åœ¨ <code>Web</code> é¡¹ç›®ä¸­å·²ç»ä¸éœ€è¦ä¾èµ– <code>JohnSun.SOA.WebAPI.Service</code> çš„ä»»ä½•ç»†èŠ‚ï¼Œå‡å¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶å®ç°ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼š<br><br>FreeSql ä»ç„¶ä¾èµ–ç»†èŠ‚ï¼Œå‰æ–‡å·²ç»æåˆ°ä¸ºäº†æµ‹è¯•é¡¹ç›®çš„ç®€å•ï¼Œæ‰€ä»¥å°± <code>ä¸è¦åœ¨æ„ç»†èŠ‚</code> äº†ã€‚<br><br>åé¢å†™åˆ°è¿™æ®µä»£ç çš„æ—¶å€™æœ‰è€ƒè™‘å°† <code>FreeSqlFactory.FreeSql</code> ç§»äº¤ç»™é…ç½®æ–‡ä»¶ï¼Œä½†æ˜¯é…ç½®æ–‡ä»¶ <code>instance</code> èŠ‚ç‚¹åœ¨ <code>Unity</code> é¡¹ç›®ä¸­ç»™å‡ºçš„æµ‹è¯•ç”¨ä¾‹ï¼Œæ— æ³•æŒ‡å®š <code>value</code> ä¸ºä¸€ä¸ªç¨‹åºä¸­çš„å­—æ®µæˆ–å±æ€§ï¼Œ<code>value</code> åªèƒ½è®¾ç½®ä¸€äº›å¸¸é‡å€¼ä¾‹å¦‚å­—ç¬¦ä¸²æˆ–æ•°å­—ã€‚<br><br>åé¢ä»”ç»†æƒ³äº†ä¸€ä¸‹ï¼Œå¦‚æœçœŸçš„æƒ³ç§»é™¤ä¾èµ–ï¼Œå¯èƒ½éœ€è¦å¢åŠ ä¸€ä¸ªç±»ä¼¼ <code>IFreeSqlInfo</code> çš„å¯¹è±¡ï¼Œå°† <code>IFreeSql</code> ä½œä¸ºè¯¥ç±»å‹çš„ä¸€ä¸ªå±æ€§ï¼Œè¿™æ ·æˆ‘ä»¬è¿˜å¯ä»¥æä¾›ä¸€ä¸ªå¤šä¸ªå‚æ•°çš„æ„é€ å‡½æ•°ï¼Œç”¨æ¥æŒ‡å®šè¿æ¥çš„æ•°æ®åº“ã€æ•°æ®åº“ç±»å‹ã€è¿æ¥å­—ç¬¦ä¸²ã€æ˜¯å¦å¯ç”¨æ•°æ®åº“è¿ç§»ç­‰ç­‰ã€‚<br><br>å½“ç„¶ï¼Œæœ€ç»ˆä¹Ÿè¦å°† <code>SpecimenService</code> æ„é€ å‡½æ•°ä¸­çš„ <code>IFreeSql</code> è°ƒæ•´æˆ <code>IFreeSqlInfo</code> çš„å®ç°æ‰è¡Œã€‚</p>
</blockquote>
<h3 id="æ§åˆ¶å™¨çš„æ³¨å…¥"><a href="#æ§åˆ¶å™¨çš„æ³¨å…¥" class="headerlink" title="æ§åˆ¶å™¨çš„æ³¨å…¥"></a>æ§åˆ¶å™¨çš„æ³¨å…¥</h3><p>è™½ç„¶å·²ç»æˆåŠŸæ·»åŠ å®¹å™¨ï¼Œç§»é™¤äº†ç»†èŠ‚çš„ä¾èµ–ï¼Œä½†æ˜¯æ§åˆ¶å™¨ä¸­æˆ‘ä»¬ä»ç„¶éœ€è¦ä½¿ç”¨ <code>Resolve</code> æ„é€ å¯¹è±¡ï¼Œæ‰€ä»¥ä¸‹ä¸€æ­¥æˆ‘ä»¬éœ€è¦å°† <code>Service</code> å¯¹è±¡çš„æ„é€ ä¹Ÿæ³¨å…¥è¿›æ¥ã€‚</p>
<p>é¦–å…ˆæˆ‘ä»¬éœ€è¦ä¿®æ”¹æ§åˆ¶å™¨çš„ç»“æ„ï¼Œå°† <code>SpecimensController</code> æ§åˆ¶å™¨è°ƒæ•´ä¸ºä»¥ä¸‹ä»£ç ï¼š</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">SpecimensController</span> : <span class="title">ApiController</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> ISpecimenService _specimenService;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SpecimensController</span>(<span class="params">ISpecimenService specimenService</span>) </span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        _specimenService = specimenService;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Specimen <span class="title">Get</span>(<span class="params"><span class="built_in">int</span> id</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">return</span> _specimenService.Get(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Specimen <span class="title">Post</span>(<span class="params">DateTime inspectionDate, <span class="built_in">string</span> speicimenNo, <span class="built_in">int</span> type, <span class="built_in">string</span> barcode = <span class="literal">null</span></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">return</span> _specimenService.Insert(<span class="keyword">new</span> Specimen &#123; InspectionDate = inspectionDate, SpeicimenNo = speicimenNo, Type = type, Barcode = barcode &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªæ—¶å€™å¦‚æœç›´æ¥è¿è¡Œé¡¹ç›®è‚¯å®šæ˜¯ä¸è¡Œçš„ï¼Œå› ä¸ºæ§åˆ¶å™¨é»˜è®¤æ— å‚æ•°çš„æ„é€ å‡½æ•°å·²ç»ä¸å­˜åœ¨äº†ï¼Œä¼šæŠ¥é”™ã€‚</p>
<h4 id="ä¼ ç»Ÿæ–¹å¼æ³¨å…¥"><a href="#ä¼ ç»Ÿæ–¹å¼æ³¨å…¥" class="headerlink" title="ä¼ ç»Ÿæ–¹å¼æ³¨å…¥"></a>ä¼ ç»Ÿæ–¹å¼æ³¨å…¥</h4><p>æ ¹æ® MSDN ä¸Šçš„æ–‡æ¡£ï¼Œæˆ‘ä»¬å¯ä»¥å€ŸåŠ© Web API å®šä¹‰ç”¨äºè§£æä¾èµ–é¡¹çš„ <code>IDependencyResolver</code> æ¥å£æ¥å®ç°æ§åˆ¶å™¨çš„æ³¨å…¥ã€‚</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">IDependencyResolver</span> : <span class="title">IDependencyScope</span>, <span class="title">IDisposable</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function">IDependencyScope <span class="title">BeginScope</span>(<span class="params"></span>)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">IDependencyScope</span> : <span class="title">IDisposable</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="built_in">object</span> <span class="title">GetService</span>(<span class="params">Type serviceType</span>)</span>;</span><br><span class="line">    <span class="function">IEnumerable&lt;<span class="built_in">object</span>&gt; <span class="title">GetServices</span>(<span class="params">Type serviceType</span>)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>IDependencyScope</code> æ¥å£æœ‰ä¸¤ç§æ–¹æ³•ï¼š</p>
<ul>
<li><code>GetService</code> åˆ›å»ºä¸€ä¸ªç±»å‹çš„å®ä¾‹ã€‚</li>
<li><code>GetServices</code> åˆ›å»ºæŒ‡å®šç±»å‹çš„å¯¹è±¡çš„é›†åˆã€‚</li>
</ul>
<p><code>IDependencyResolver</code> æ–¹æ³•ç»§æ‰¿ <code>IDependencyScope</code> å¹¶æ·»åŠ  <code>BeginScope</code> æ–¹æ³•ã€‚</p>
<p>å½“ Web API åˆ›å»ºæ§åˆ¶å™¨å®ä¾‹æ—¶ï¼Œå®ƒå°†é¦–å…ˆè°ƒç”¨ <code>IDependencyResolver</code> çš„ <code>GetService</code> æ–¹æ³•ï¼Œå¹¶ä¼ å…¥æ§åˆ¶å™¨ç±»å‹ã€‚æˆ‘ä»¬å¯ä»¥å€ŸåŠ©è¯¥ç‰¹æ€§ï¼Œæ¥æ„é€ ä»»ä½•æ§åˆ¶å™¨ï¼Œå¦‚æœ <code>GetService</code> è¿”å› <code>Null</code>ï¼ŒWeb API å°†åœ¨æ§åˆ¶å™¨ç±»ä¸ŠæŸ¥æ‰¾æ— å‚æ•°çš„æ„é€ å‡½æ•°ã€‚</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">UnityResolver</span> : <span class="title">IDependencyResolver</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">protected</span> IUnityContainer container;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">UnityResolver</span>(<span class="params">IUnityContainer container</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">if</span> (container == <span class="literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> ArgumentNullException(<span class="string">&quot;container&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">this</span>.container = container;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> IDependencyScope <span class="title">BeginScope</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> UnityResolver(container.CreateChildContainer());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Dispose</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        Dispose(<span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">Dispose</span>(<span class="params"><span class="built_in">bool</span> disposing</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        container.Dispose();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">object</span> <span class="title">GetService</span>(<span class="params">Type serviceType</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">try</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> ContainerFactory.Container.Resolve(serviceType);</span><br><span class="line">        &#125;</span><br><span class="line">        catch (ResolutionFailedException)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> IEnumerable&lt;<span class="built_in">object</span>&gt; <span class="title">GetServices</span>(<span class="params">Type serviceType</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">try</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> ContainerFactory.Container.ResolveAll(serviceType);</span><br><span class="line">        &#125;</span><br><span class="line">        catch (ResolutionFailedException)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> List&lt;<span class="built_in">object</span>&gt;();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æœ€åæˆ‘ä»¬éœ€è¦å°† <code>HttpConfiguration</code> ä¸­çš„ <code>DependencyResolver</code> å±æ€§æ›¿æ¢ä¸ºæˆ‘ä»¬å®ç°çš„ <code>UnityResolver</code>ã€‚</p>
<p>ä¿®æ”¹ <code>WebApiConfig.Register</code> æ–¹æ³•ï¼Œå¢åŠ ä»¥ä¸‹ä»£ç ï¼š</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">config.DependencyResolver = <span class="keyword">new</span> UnityResolver(ContainerFactory.Container);</span><br></pre></td></tr></table></figure>
<h4 id="ä½¿ç”¨-Unity-WebAPI"><a href="#ä½¿ç”¨-Unity-WebAPI" class="headerlink" title="ä½¿ç”¨ Unity.WebAPI"></a>ä½¿ç”¨ Unity.WebAPI</h4><p>Unity æä¾›äº†ä¸€ä¸ªåŒ…ï¼Œæ–¹ä¾¿æˆ‘ä»¬æ§åˆ¶å™¨çš„æ³¨å…¥ï¼Œé¦–å…ˆè¦é€šè¿‡ <code>nuget</code> å®‰è£…åŒ…ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Install-Package Unity.WebAPI -Version 5.4.0</span><br></pre></td></tr></table></figure>
<p>åŒä¹‹å‰ä¸€æ ·ï¼Œä¿®æ”¹ <code>WebApiConfig.Register</code> æ–¹æ³•ï¼Œå¢åŠ ä»¥ä¸‹ä»£ç ï¼š</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">config.DependencyResolver = <span class="keyword">new</span> Unity.WebApi.UnityDependencyResolver(ContainerFactory.Container);</span><br></pre></td></tr></table></figure>
<p><code>UnityDependencyResolver</code> ç±»å‹æ˜¯å¸®æˆ‘ä»¬å®ç°çš„ <code>IDependencyResolver</code> æ¥å£ï¼Œé€šè¿‡åç¼–è¯‘ä»£ç å¯ä»¥äº†è§£å’Œæˆ‘ä»¬ä» <code>MSDN</code> çš„å¸¸è§„å®ç°åŸºæœ¬ä¸€è‡´ï¼š</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Unity.WebApi.UnityDependencyScope</span></span><br><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> System.Web.Http.Controllers;</span><br><span class="line"><span class="keyword">using</span> System.Web.Http.Dependencies;</span><br><span class="line"><span class="keyword">using</span> Unity;</span><br><span class="line"><span class="keyword">using</span> Unity.Resolution;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">UnityDependencyScope</span> : <span class="title">IDependencyScope</span>, <span class="title">IDisposable</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">protected</span> IUnityContainer Container</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">get</span>;</span><br><span class="line">		<span class="keyword">private</span> <span class="keyword">set</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">UnityDependencyScope</span>(<span class="params">IUnityContainer container</span>)</span></span><br><span class="line"><span class="function"></span>	&#123;</span><br><span class="line">		Container = container;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="built_in">object</span> <span class="title">GetService</span>(<span class="params">Type serviceType</span>)</span></span><br><span class="line"><span class="function"></span>	&#123;</span><br><span class="line">		<span class="keyword">if</span> (<span class="keyword">typeof</span>(IHttpController).IsAssignableFrom(serviceType))</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">return</span> UnityContainerExtensions.Resolve(Container, serviceType, (ResolverOverride[])(<span class="built_in">object</span>)<span class="keyword">new</span> ResolverOverride[<span class="number">0</span>]);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">try</span></span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">return</span> UnityContainerExtensions.Resolve(Container, serviceType, (ResolverOverride[])(<span class="built_in">object</span>)<span class="keyword">new</span> ResolverOverride[<span class="number">0</span>]);</span><br><span class="line">		&#125;</span><br><span class="line">		catch</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> IEnumerable&lt;<span class="built_in">object</span>&gt; <span class="title">GetServices</span>(<span class="params">Type serviceType</span>)</span></span><br><span class="line"><span class="function"></span>	&#123;</span><br><span class="line">		<span class="keyword">return</span> UnityContainerExtensions.ResolveAll(Container, serviceType, (ResolverOverride[])(<span class="built_in">object</span>)<span class="keyword">new</span> ResolverOverride[<span class="number">0</span>]);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Dispose</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>	&#123;</span><br><span class="line">		((IDisposable)Container).Dispose();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Unity.WebApi.UnityDependencyResolver</span></span><br><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Web.Http.Dependencies;</span><br><span class="line"><span class="keyword">using</span> Unity;</span><br><span class="line"><span class="keyword">using</span> Unity.WebApi;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">UnityDependencyResolver</span> : <span class="title">UnityDependencyScope</span>, <span class="title">IDependencyResolver</span>, <span class="title">IDependencyScope</span>, <span class="title">IDisposable</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">UnityDependencyResolver</span>(<span class="params">IUnityContainer container</span>)</span></span><br><span class="line"><span class="function">		: <span class="title">base</span>(<span class="params">container</span>)</span></span><br><span class="line"><span class="function"></span>	&#123;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> IDependencyScope <span class="title">BeginScope</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>	&#123;</span><br><span class="line">		<span class="keyword">return</span> (IDependencyScope)(<span class="built_in">object</span>)<span class="keyword">new</span> UnityDependencyScope(<span class="keyword">base</span>.Container.CreateChildContainer());</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Autofac-å®ç°ä¾èµ–æ³¨å…¥"><a href="#Autofac-å®ç°ä¾èµ–æ³¨å…¥" class="headerlink" title="Autofac å®ç°ä¾èµ–æ³¨å…¥"></a>Autofac å®ç°ä¾èµ–æ³¨å…¥</h2><p>ç›¸è¾ƒäº <code>Unity</code>ï¼Œå…¶å® <code>Autofac</code> ä½¿ç”¨æ›´å¹¿æ³›ï¼Œæ™®éè®¤ä¸ºåè€…çš„æ€§èƒ½è¡¨ç°è¦ä¼˜äºå‰è€…ï¼Œå¹¶ä¸”åè€…æ‹¥æœ‰ä¸­æ–‡æ–‡æ¡£ï¼Œç¤¾åŒºæ›´æ´»è·ƒã€‚</p>
<h3 id="ä»£ç ä¸­ä¸ºå®¹å™¨æ³¨å†Œç±»å‹"><a href="#ä»£ç ä¸­ä¸ºå®¹å™¨æ³¨å†Œç±»å‹" class="headerlink" title="ä»£ç ä¸­ä¸ºå®¹å™¨æ³¨å†Œç±»å‹"></a>ä»£ç ä¸­ä¸ºå®¹å™¨æ³¨å†Œç±»å‹</h3><p>æœ¬è´¨ä¸Š Autofac ä¸å‰è€…å·®å¼‚ä¸å¤§ï¼Œæ‰€ä»¥è¿™é‡Œåªæ˜¯ç®€å•çš„ä»‹ç»ä¸€ä¸‹ä½¿ç”¨ï¼Œæ›´å¤šçš„çŸ¥è¯†å¯ä»¥äº†è§£å®˜æ–¹çš„æ–‡æ¡£ã€‚</p>
<p>è¿™é‡Œæ·»åŠ ä¸€ä¸ª <code>AutofacContainerFactory</code> çš„ç±»å‹ï¼š</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">AutofacContainerFactory</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> IContainer Container &#123; <span class="keyword">get</span>; <span class="keyword">private</span> <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="title">AutofacContainerFactory</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="comment">// Autofac åœ¨ç¨‹åºä¸­æ³¨å†Œ</span></span><br><span class="line">        <span class="keyword">var</span> builder = <span class="keyword">new</span> ContainerBuilder();</span><br><span class="line">        builder.RegisterInstance(FreeSqlFactory.FreeSql);</span><br><span class="line">        builder.RegisterType&lt;SpecimenService&gt;().As&lt;ISpecimenService&gt;();</span><br><span class="line">        Container = builder.Build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™æ—¶æ— æ³•è¿è¡Œç¨‹åºï¼Œç”šè‡³ä¼šæŠ¥é”™ï¼Œå› ä¸ºåŸºäº <code>Unity</code> çš„é‚£å¥—ä»£ç ï¼Œ<code>Service</code> çš„é¡¹ç›®ä¾èµ–å·²ç»ç§»é™¤ï¼Œè¿™é‡Œä¼šæŠ¥é”™ã€‚æ‰€ä»¥è¿™é‡ŒçŸ¥è¯†ä»£ç æ¼”ç¤ºã€‚</p>
<h3 id="ä½¿ç”¨é…ç½®æ–‡ä»¶"><a href="#ä½¿ç”¨é…ç½®æ–‡ä»¶" class="headerlink" title="ä½¿ç”¨é…ç½®æ–‡ä»¶"></a>ä½¿ç”¨é…ç½®æ–‡ä»¶</h3><p>ç”±äº <code>Autofac 4.0+</code> é…ç½®ä¾èµ–äº <code>Microsoft.Extensions.Configuration.Xml</code> æˆ– <code>Microsoft.Extensions.Configuration.Json</code>ï¼Œå¹¶ä¸”è¿™ä¸¤ä¸ªé¡¹ç›®ä¾èµ–äº <code>.NET Standard 2.0</code>ï¼Œæ‰€ä»¥éœ€è¦å°†é¡¹ç›®éƒ½å‡çº§åˆ° <code>.NET Framework 4.6.1+</code>ã€‚</p>
<p>å¦å¤–ä¸ºäº†èƒ½è®©é¡¹ç›®æˆåŠŸè¿è¡Œèµ·æ¥ï¼Œå¹¶ä¸”ä½¿ç”¨çš„æ˜¯ <code>Autofac</code> å®ç°ä¾èµ–æ³¨å…¥ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å¼•ç”¨å‡ ä¸ª nuget ç¨‹åºåŒ…ï¼š</p>
<ul>
<li><code>Autofac.Configuration</code>ï¼šä¸º <code>autofac</code> æä¾›é…ç½®åŠŸèƒ½ã€‚</li>
<li><code>Autofac.WebApi2</code>ï¼šASP.NET Web API æ§åˆ¶å™¨çš„ä¾èµ–æ³¨å…¥ã€‚</li>
<li><code>Microsoft.Extensions.Configuration.Json</code>ï¼šå¦‚æœä½¿ç”¨ json æ–‡ä»¶é…ç½® autofac æ·»åŠ è¯¥å¼•ç”¨ã€‚</li>
<li><code>Microsoft.Extensions.Configuration.Xml</code>ï¼šå¦‚æœä½¿ç”¨ xml æ–‡ä»¶é…ç½® autofac æ·»åŠ è¯¥å¼•ç”¨ã€‚</li>
</ul>
<p>è°ƒæ•´ <code>AutofacContainerFactory</code> é™æ€æ„é€ å‡½æ•°ä¸­çš„ä»£ç ï¼š</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">AutofacContainerFactory</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> IContainer Container &#123; <span class="keyword">get</span>; <span class="keyword">private</span> <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="title">AutofacContainerFactory</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="comment">// Autofac åœ¨ç¨‹åºä¸­æ³¨å†Œ</span></span><br><span class="line">        <span class="comment">//var builder = new ContainerBuilder();</span></span><br><span class="line">        <span class="comment">//builder.RegisterInstance(FreeSqlFactory.FreeSql);</span></span><br><span class="line">        <span class="comment">//builder.RegisterType&lt;Service.SpecimenService&gt;().As&lt;ISpecimenService&gt;();</span></span><br><span class="line">        <span class="comment">//builder.RegisterApiControllers(AppDomain.CurrentDomain.GetAssemblies());</span></span><br><span class="line">        <span class="comment">//Container = builder.Build();</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// Autofac ä½¿ç”¨é…ç½®æ–‡ä»¶æ³¨å†Œ</span></span><br><span class="line">        <span class="keyword">var</span> builder = <span class="keyword">new</span> ContainerBuilder();</span><br><span class="line">        builder.RegisterInstance(FreeSqlFactory.FreeSql);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> config = <span class="keyword">new</span> ConfigurationBuilder();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Json æ–‡ä»¶</span></span><br><span class="line">        <span class="comment">//string configPath = Path.Combine(AppDomain.CurrentDomain.BaseDirectory, @&quot;ConfigFiles\Autofac.json&quot;);</span></span><br><span class="line">        <span class="comment">//config.AddJsonFile(configPath);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// Xml æ–‡ä»¶</span></span><br><span class="line">        <span class="built_in">string</span> configPath = Path.Combine(AppDomain.CurrentDomain.BaseDirectory, <span class="string">@&quot;ConfigFiles\Autofac.config&quot;</span>);</span><br><span class="line">        config.AddXmlFile(configPath);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> module = <span class="keyword">new</span> ConfigurationModule(config.Build());</span><br><span class="line">        builder.RegisterModule(module);</span><br><span class="line"></span><br><span class="line">        builder.RegisterApiControllers(AppDomain.CurrentDomain.GetAssemblies());</span><br><span class="line"></span><br><span class="line">        Container = builder.Build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ·»åŠ å¯¹åº”çš„é…ç½®æ–‡ä»¶åˆ° <code>ConfigFiles</code> æ–‡ä»¶å¤¹ï¼Œ<code>Autofac.config</code> æ–‡ä»¶ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">autofac</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">components</span> <span class="attr">name</span>=<span class="string">&quot;0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">type</span>&gt;</span>JohnSun.SOA.WebAPI.Service.SpecimenService, JohnSun.SOA.WebAPI.Service<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">services</span> <span class="attr">name</span>=<span class="string">&quot;0&quot;</span> <span class="attr">type</span>=<span class="string">&quot;JohnSun.SOA.WebAPI.Interface.ISpecimenService, JohnSun.SOA.WebAPI.Interface&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">components</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">autofac</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>Autofac.json</code> æ–‡ä»¶ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;components&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;type&quot;</span>: <span class="string">&quot;JohnSun.SOA.WebAPI.Service.SpecimenService, JohnSun.SOA.WebAPI.Service&quot;</span>,</span><br><span class="line">      <span class="string">&quot;services&quot;</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span>: <span class="string">&quot;JohnSun.SOA.WebAPI.Interface.ISpecimenService, JohnSun.SOA.WebAPI.Interface&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æœ€ç»ˆä¿®æ”¹æˆ‘ä»¬çš„ <code>WebApiConfig.Register</code> æ–¹æ³•ï¼Œå°† <code>config.DependencyResolver</code> ä¿®æ”¹ä¸º<code>AutofacWebApiDependencyResolver</code>ï¼Œæ³¨æ„è¿™ä¸ªç±»å‹æ˜¯åœ¨ <code>Autofac.WebApi2</code> ä¸­çš„ç±»å‹ï¼š</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">config.DependencyResolver = <span class="keyword">new</span> Autofac.Integration.WebApi.AutofacWebApiDependencyResolver(AutofacContainerFactory.Container);</span><br></pre></td></tr></table></figure>
<p>è¿™æ—¶ï¼Œå¦‚æœæ²¡æœ‰é…ç½®é”™è¯¯ï¼Œå°±å¯ä»¥æ­£å¸¸è®¿é—®æˆ‘ä»¬çš„æ§åˆ¶å™¨è·å–æ•°æ®ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼š</p>
<ul>
<li>ConfigFiles æ–‡ä»¶å¤¹ä¸‹çš„é…ç½®æ–‡ä»¶å±æ€§â€œå¤åˆ¶åˆ°è¾“å‡ºç›®å½•â€åº”è¯¥ä¿®æ”¹ä¸ºï¼šâ€œå¦‚æœè¾ƒæ–°åˆ™å¤åˆ¶â€ã€‚</li>
<li>å·¥å‚ç±» <code>AutofacContainerFactory</code> æ„å»ºå®¹å™¨æ—¶ä¸€å®šè¦è°ƒç”¨ <code>builder.RegisterApiControllers()</code> æ–¹æ³•ï¼Œä¸åŒäº Unity çš„åŸå› å¯ä»¥å‚çœ‹åæ–‡ <code>AutofacWebApiDependencyResolver</code> ç±»å‹çš„åç¼–è¯‘ä»£ç ã€‚</li>
</ul>
<h3 id="AutofacWebApiDependencyResolver-ç±»å‹"><a href="#AutofacWebApiDependencyResolver-ç±»å‹" class="headerlink" title="AutofacWebApiDependencyResolver ç±»å‹"></a>AutofacWebApiDependencyResolver ç±»å‹</h3><p>åç¼–è¯‘ <code>nuget</code> åŒ… <code>Autofac.WebApi2.nupkg</code> ä¸­çš„ <code>Autofac.Integration.WebApi.dll</code> æ–‡ä»¶å¯ä»¥æ‰¾åˆ°è¯¥ç±»å‹ï¼š</p>
<p><code>Autofac.Integration.WebApi.AutofacWebApiDependencyScope</code>ï¼š</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> Autofac;</span><br><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> System.Linq;</span><br><span class="line"><span class="keyword">using</span> System.Web.Http.Dependencies;</span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> Autofac implementation of the <span class="doctag">&lt;see cref=&quot;T:System.Web.Http.Dependencies.IDependencyScope&quot; /&gt;</span> interface.</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">AutofacWebApiDependencyScope</span> : <span class="title">IDependencyScope</span>, <span class="title">IDisposable</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="built_in">bool</span> _disposed;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">readonly</span> ILifetimeScope _lifetimeScope;</span><br><span class="line"></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> Gets the lifetime scope for the current dependency scope.</span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">	<span class="keyword">public</span> ILifetimeScope LifetimeScope =&gt; _lifetimeScope;</span><br><span class="line"></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> Initializes a new instance of the <span class="doctag">&lt;see cref=&quot;T:Autofac.Integration.WebApi.AutofacWebApiDependencyScope&quot; /&gt;</span> class.</span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;lifetimeScope&quot;&gt;</span>The lifetime scope to resolve services from.<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">AutofacWebApiDependencyScope</span>(<span class="params">ILifetimeScope lifetimeScope</span>)</span></span><br><span class="line"><span class="function"></span>	&#123;</span><br><span class="line">		<span class="keyword">if</span> (lifetimeScope == <span class="literal">null</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> ArgumentNullException(<span class="string">&quot;lifetimeScope&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		_lifetimeScope = lifetimeScope;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> Finalizes an instance of the <span class="doctag">&lt;see cref=&quot;T:Autofac.Integration.WebApi.AutofacWebApiDependencyScope&quot; /&gt;</span> class.</span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">	~AutofacWebApiDependencyScope()</span><br><span class="line">	&#123;</span><br><span class="line">		Dispose(disposing: <span class="literal">false</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> Try to get a service of the given type.</span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;serviceType&quot;&gt;</span>ControllerType of service to request.<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>An instance of the service, or null if the service is not found.<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="built_in">object</span> <span class="title">GetService</span>(<span class="params">Type serviceType</span>)</span></span><br><span class="line"><span class="function"></span>	&#123;</span><br><span class="line">		<span class="keyword">return</span> ResolutionExtensions.ResolveOptional((IComponentContext)(<span class="built_in">object</span>)_lifetimeScope, serviceType);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> Try to get a list of services of the given type.</span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;serviceType&quot;&gt;</span>ControllerType of services to request.<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>An enumeration (possibly empty) of the service.<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> IEnumerable&lt;<span class="built_in">object</span>&gt; <span class="title">GetServices</span>(<span class="params">Type serviceType</span>)</span></span><br><span class="line"><span class="function"></span>	&#123;</span><br><span class="line">		<span class="keyword">if</span> (!ResolutionExtensions.IsRegistered((IComponentContext)(<span class="built_in">object</span>)_lifetimeScope, serviceType))</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">return</span> Enumerable.Empty&lt;<span class="built_in">object</span>&gt;();</span><br><span class="line">		&#125;</span><br><span class="line">		Type enumerableServiceType = <span class="keyword">typeof</span>(IEnumerable&lt;&gt;).MakeGenericType(serviceType);</span><br><span class="line">		<span class="keyword">return</span> (IEnumerable&lt;<span class="built_in">object</span>&gt;)ResolutionExtensions.Resolve((IComponentContext)(<span class="built_in">object</span>)_lifetimeScope, enumerableServiceType);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> Performs application-defined tasks associated with freeing, releasing, or resetting unmanaged resources.</span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Dispose</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>	&#123;</span><br><span class="line">		Dispose(disposing: <span class="literal">true</span>);</span><br><span class="line">		GC.SuppressFinalize(<span class="keyword">this</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> Releases unmanaged and - optionally - managed resources.</span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;disposing&quot;&gt;</span></span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;see langword=&quot;true&quot; /&gt;</span> to release both managed and unmanaged resources;</span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;see langword=&quot;false&quot; /&gt;</span> to release only unmanaged resources.</span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">Dispose</span>(<span class="params"><span class="built_in">bool</span> disposing</span>)</span></span><br><span class="line"><span class="function"></span>	&#123;</span><br><span class="line">		<span class="keyword">if</span> (!_disposed)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span> (disposing &amp;&amp; _lifetimeScope != <span class="literal">null</span>)</span><br><span class="line">			&#123;</span><br><span class="line">				((IDisposable)_lifetimeScope).Dispose();</span><br><span class="line">			&#125;</span><br><span class="line">			_disposed = <span class="literal">true</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>Autofac.Integration.WebApi.AutofacWebApiDependencyResolver</code>ï¼š</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> Autofac;</span><br><span class="line"><span class="keyword">using</span> Autofac.Core.Lifetime;</span><br><span class="line"><span class="keyword">using</span> Autofac.Integration.WebApi;</span><br><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> System.Web.Http.Dependencies;</span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> Autofac implementation of the <span class="doctag">&lt;see cref=&quot;T:System.Web.Http.Dependencies.IDependencyResolver&quot; /&gt;</span> interface.</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">AutofacWebApiDependencyResolver</span> : <span class="title">IDependencyResolver</span>, <span class="title">IDependencyScope</span>, <span class="title">IDisposable</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="built_in">bool</span> _disposed;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">readonly</span> ILifetimeScope _container;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">readonly</span> IDependencyScope _rootDependencyScope;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">readonly</span> Action&lt;ContainerBuilder&gt; _configurationAction;</span><br><span class="line"></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> Gets the root container provided to the dependency resolver.</span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">	<span class="keyword">public</span> ILifetimeScope Container =&gt; _container;</span><br><span class="line"></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> Initializes a new instance of the <span class="doctag">&lt;see cref=&quot;T:Autofac.Integration.WebApi.AutofacWebApiDependencyResolver&quot; /&gt;</span> class.</span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;container&quot;&gt;</span>The container that nested lifetime scopes will be create from.<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;configurationAction&quot;&gt;</span>A configuration action that will execute during lifetime scope creation.<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">AutofacWebApiDependencyResolver</span>(<span class="params">ILifetimeScope container, Action&lt;ContainerBuilder&gt; configurationAction</span>)</span></span><br><span class="line"><span class="function">		: <span class="title">this</span>(<span class="params">container</span>)</span></span><br><span class="line"><span class="function"></span>	&#123;</span><br><span class="line">		<span class="keyword">if</span> (configurationAction == <span class="literal">null</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> ArgumentNullException(<span class="string">&quot;configurationAction&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		_configurationAction = configurationAction;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> Initializes a new instance of the <span class="doctag">&lt;see cref=&quot;T:Autofac.Integration.WebApi.AutofacWebApiDependencyResolver&quot; /&gt;</span> class.</span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;container&quot;&gt;</span>The container that nested lifetime scopes will be create from.<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">AutofacWebApiDependencyResolver</span>(<span class="params">ILifetimeScope container</span>)</span></span><br><span class="line"><span class="function"></span>	&#123;</span><br><span class="line">		<span class="keyword">if</span> (container == <span class="literal">null</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> ArgumentNullException(<span class="string">&quot;container&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		_container = container;</span><br><span class="line">		_rootDependencyScope = (IDependencyScope)(<span class="built_in">object</span>)<span class="keyword">new</span> AutofacWebApiDependencyScope(container);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> Finalizes an instance of the <span class="doctag">&lt;see cref=&quot;T:Autofac.Integration.WebApi.AutofacWebApiDependencyResolver&quot; /&gt;</span> class.</span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">	~AutofacWebApiDependencyResolver()</span><br><span class="line">	&#123;</span><br><span class="line">		Dispose(disposing: <span class="literal">false</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> Try to get a service of the given type.</span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;serviceType&quot;&gt;</span>Type of service to request.<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>An instance of the service, or null if the service is not found.<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">virtual</span> <span class="built_in">object</span> <span class="title">GetService</span>(<span class="params">Type serviceType</span>)</span></span><br><span class="line"><span class="function"></span>	&#123;</span><br><span class="line">		<span class="keyword">return</span> _rootDependencyScope.GetService(serviceType);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> Try to get a list of services of the given type.</span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;serviceType&quot;&gt;</span>ControllerType of services to request.<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>An enumeration (possibly empty) of the service.<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">virtual</span> IEnumerable&lt;<span class="built_in">object</span>&gt; <span class="title">GetServices</span>(<span class="params">Type serviceType</span>)</span></span><br><span class="line"><span class="function"></span>	&#123;</span><br><span class="line">		<span class="keyword">return</span> _rootDependencyScope.GetServices(serviceType);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> Starts a resolution scope. Objects which are resolved in the given scope will belong to</span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> that scope, and when the scope is disposed, those objects are returned to the container.</span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span></span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> The dependency scope.</span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> IDependencyScope <span class="title">BeginScope</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>	&#123;</span><br><span class="line">		<span class="keyword">return</span> (IDependencyScope)(<span class="built_in">object</span>)<span class="keyword">new</span> AutofacWebApiDependencyScope((_configurationAction == <span class="literal">null</span>) ? _container.BeginLifetimeScope(MatchingScopeLifetimeTags.RequestLifetimeScopeTag) : _container.BeginLifetimeScope(MatchingScopeLifetimeTags.RequestLifetimeScopeTag, _configurationAction));</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> Performs application-defined tasks associated with freeing, releasing, or resetting unmanaged resources.</span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Dispose</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>	&#123;</span><br><span class="line">		Dispose(disposing: <span class="literal">true</span>);</span><br><span class="line">		GC.SuppressFinalize(<span class="keyword">this</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> Releases unmanaged and - optionally - managed resources.</span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;disposing&quot;&gt;</span></span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;see langword=&quot;true&quot; /&gt;</span> to release both managed and unmanaged resources;</span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;see langword=&quot;false&quot; /&gt;</span> to release only unmanaged resources.</span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">Dispose</span>(<span class="params"><span class="built_in">bool</span> disposing</span>)</span></span><br><span class="line"><span class="function"></span>	&#123;</span><br><span class="line">		<span class="keyword">if</span> (!_disposed)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span> (disposing &amp;&amp; _rootDependencyScope != <span class="literal">null</span>)</span><br><span class="line">			&#123;</span><br><span class="line">				((IDisposable)_rootDependencyScope).Dispose();</span><br><span class="line">			&#125;</span><br><span class="line">			_disposed = <span class="literal">true</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>å‚è€ƒï¼š<br></p>
<ul>
<li>GitHub - FreeSqlï¼š<a target="_blank" rel="noopener" href="https://github.com/2881099/FreeSql">2881099/FreeSql</a><br></li>
<li>GitHub - Unity: <a target="_blank" rel="noopener" href="https://github.com/unitycontainer/unity">unitycontainer/unity</a><br></li>
<li>GitHub - Autofac: <a target="_blank" rel="noopener" href="https://github.com/autofac/Autofac">autofac/Autofac</a><br></li>
<li>MSDN - ASP.NET Web API: <a target="_blank" rel="noopener" href="https://docs.microsoft.com/zh-cn/aspnet/web-api/">ASP.NET Web API</a><br></li>
<li>Autofac ä¸­æ–‡æ–‡æ¡£: <a target="_blank" rel="noopener" href="https://autofaccn.readthedocs.io/zh/latest/index.html">æ¬¢è¿æ¥åˆ° Autofac ä¸­æ–‡æ–‡æ¡£!</a></li>
</ul>
</blockquote>
<blockquote>
<p>æºç ä¸‹è½½ï¼š<br></p>
<ul>
<li>Giteaï¼š<a target="_blank" rel="noopener" href="https://git.hd2y.net/hd2y/JohnSun.SOA.WebAPI">JohnSun.SOA.WebAPI</a><br></li>
<li>ç™¾åº¦ç½‘ç›˜ï¼š<a target="_blank" rel="noopener" href="https://pan.baidu.com/s/17Nel1LWA8NFFRGD4iNiS-w">é“¾æ¥</a>  æå–ç ï¼š60u5</li>
</ul>
</blockquote>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://hd2y.github.io/soa-asp-dot-net-web-api-di/" data-id="cklsrxrx100eq04pifd7ibbhp" data-title="SOA â€”â€” ASP.NET Web API ä¾èµ–æ³¨å…¥" class="article-share-link">åˆ†äº«</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Autofac/" rel="tag">Autofac</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SOA/" rel="tag">SOA</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Unity/" rel="tag">Unity</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/WebApi/" rel="tag">WebApi</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5/" rel="tag">ä¾èµ–æ³¨å…¥</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-191202-macos-use-dbeaver-to-connect-to-oracle-databases" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/macos-use-dbeaver-to-connect-to-oracle-databases/" class="article-date">
  <time class="dt-published" datetime="2019-12-02T02:58:25.000Z" itemprop="datePublished">2019-12-02</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%BC%80%E5%8F%91/">å¼€å‘</a>â–º<a class="article-category-link" href="/categories/%E5%BC%80%E5%8F%91/%E6%95%B0%E6%8D%AE%E5%BA%93/">æ•°æ®åº“</a>â–º<a class="article-category-link" href="/categories/%E5%BC%80%E5%8F%91/%E6%95%B0%E6%8D%AE%E5%BA%93/Oracle/">Oracle</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/macos-use-dbeaver-to-connect-to-oracle-databases/">MacOS ä½¿ç”¨ DBeaver è¿æ¥ Oracle æ•°æ®åº“</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>ä½œä¸ºâ€œä¸“ä¸šâ€çš„å•†ä¸šæ•°æ®åº“ï¼ŒOracle ä¸å…è®¸ç¬¬ä¸‰æ–¹å…¬å¸ç§è‡ªé›†æˆ Oracle æ•°æ®åº“çš„ jdbc è¿æ¥é©±åŠ¨ï¼Œæ‰€ä»¥ DBeaver ä¸èƒ½åƒå…¶ä»–æ•°æ®åº“é‚£æ ·ï¼Œè‡ªåŠ¨çš„ä¸ºæˆ‘ä»¬ä¸‹è½½é©±åŠ¨æ–‡ä»¶ã€‚</p>
<h2 id="DBeaver-æ·»åŠ è¿æ¥"><a href="#DBeaver-æ·»åŠ è¿æ¥" class="headerlink" title="DBeaver æ·»åŠ è¿æ¥"></a>DBeaver æ·»åŠ è¿æ¥</h2><p>æ·»åŠ  Oracle è¿æ¥ä¼šå‡ºç°å¦‚ä¸‹é…ç½®ï¼š</p>
<p><img src="https://hd2y.oss-cn-beijing.aliyuncs.com/20191202100912_1575253218349.jpg" alt="20191202100912"></p>
<p>å¦‚ä¸Šå›¾ï¼Œç‚¹å‡»â€œæµ‹è¯•è¿æ¥â€ä¼šæç¤ºè®©æˆ‘ä»¬é…ç½®è¿æ¥é©±åŠ¨ï¼š</p>
<p><img src="https://hd2y.oss-cn-beijing.aliyuncs.com/20191202100940_1575253216106.jpg" alt="20191202100940"></p>
<h2 id="ä¸‹è½½-jar-åŒ…"><a href="#ä¸‹è½½-jar-åŒ…" class="headerlink" title="ä¸‹è½½ jar åŒ…"></a>ä¸‹è½½ jar åŒ…</h2><p>å¦‚æœæ•°æ®åº“æœåŠ¡å™¨æ˜¯ <code>11g</code> æˆ– <code>12c</code>ï¼Œæ ¹æ®æ•°æ®åº“ç‰ˆæœ¬é€‰æ‹©æ¡†ä¸‹çš„è¿æ¥ï¼Œåˆ° Oracle å®˜ç½‘ç™»å½•ä¸‹è½½å³å¯ã€‚</p>
<p>è¿™é‡Œæˆ‘å®‰è£…çš„æ˜¯ <code>19c</code>ï¼Œç›´æ¥åˆ°æ ¹æ®æŒ‡å¼•ä¸‹è½½æœ€æ–°çš„ jar åŒ…ï¼š<a target="_blank" rel="noopener" href="https://www.oracle.com/database/technologies/appdev/jdbc-ucp-183-downloads.html">18.3 JDBC and UCP Downloads page</a></p>
<p>å…¶ä»–çš„ä¸€äº›æŒ‡å¼•ä¿¡æ¯å¯ä»¥å‚è€ƒï¼š<a target="_blank" rel="noopener" href="https://www.oracle.com/cn/database/technologies/develop-java-apps-using-jdbc.html">Quick Start with JDBC</a></p>
<h2 id="é…ç½®é©±åŠ¨"><a href="#é…ç½®é©±åŠ¨" class="headerlink" title="é…ç½®é©±åŠ¨"></a>é…ç½®é©±åŠ¨</h2><p>ç‚¹å‡»å¼¹å‡ºç¼ºå°‘é©±åŠ¨æ–‡ä»¶çª—ä½“ä¸­çš„ <code>æ·»åŠ  jar åŒ…</code> æˆ–ç‚¹å‡» Oracle è¿æ¥è®¾ç½®ç•Œé¢çš„ <code>ç¼–è¾‘é©±åŠ¨è®¾ç½®</code> å¯ä»¥è¿›å…¥ä»¥ä¸‹é¡µé¢ï¼š</p>
<p><img src="https://hd2y.oss-cn-beijing.aliyuncs.com/20191202101244_1575253216132.jpg" alt="20191202101244"></p>
<p>æŒ‰å¦‚å›¾æ‰€ç¤ºï¼Œå°†æˆ‘ä»¬ä¸‹è½½çš„æ–‡ä»¶è§£å‹åˆ°ä¸€ä¸ªåˆé€‚çš„ä½ç½®ï¼Œç‚¹å‡» <code>æ·»åŠ æ–‡ä»¶</code> å°†å¦‚å›¾æ‰€ç¤ºçš„ä¸‰ä¸ªæ–‡ä»¶æ·»åŠ è¿›åˆ—è¡¨å³å¯ã€‚</p>
<p>å®Œæˆåç‚¹å‡»ç¡®å®šå¯èƒ½ä¼šæŠ¥é”™ï¼Œå¯ä»¥å¿½ç•¥æŠ¥é”™ä¿¡æ¯ï¼Œç›´æ¥ä»è¿æ¥é…ç½®ç•Œé¢ï¼Œé‡æ–°ç‚¹å‡» <code>æµ‹è¯•è¿æ¥</code> å³å¯ç¡®è®¤é©±åŠ¨æ˜¯å¦æ­£å¸¸ã€‚</p>
<p>å½“ç„¶è¿˜å¯èƒ½ä¼šä»ç„¶æ— æ³•è¿æ¥ï¼Œä½†æ˜¯éœ€è¦ç¡®è®¤çš„æ˜¯é©±åŠ¨æ˜¯å¦æ­£å¸¸ï¼Œä¾‹å¦‚æç¤ºç½‘ç»œé”™è¯¯æˆ–ç™»å½•ç”¨æˆ·å¯†ç é”™è¯¯ç­‰ä¿¡æ¯ï¼Œå°±æ˜¯å¦å¤–ä¸€ä¸ªé—®é¢˜äº†ï¼Œè§£å†³å³å¯ã€‚</p>
<p><img src="https://hd2y.oss-cn-beijing.aliyuncs.com/491E0BFC-E982-46AF-9E64-3857658E55E2_1575255351192.png" alt="491E0BFC-E982-46AF-9E64-3857658E55E2"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://hd2y.github.io/macos-use-dbeaver-to-connect-to-oracle-databases/" data-id="cklsrxru4003n04pi6i8wa1kw" data-title="MacOS ä½¿ç”¨ DBeaver è¿æ¥ Oracle æ•°æ®åº“" class="article-share-link">åˆ†äº«</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/DBeaver/" rel="tag">DBeaver</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MacOS/" rel="tag">MacOS</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Oracle/" rel="tag">Oracle</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/jdbc/" rel="tag">jdbc</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-191128-soa-asp-dot-net-web-api-knowledge-points" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/soa-asp-dot-net-web-api-knowledge-points/" class="article-date">
  <time class="dt-published" datetime="2019-11-28T07:46:22.000Z" itemprop="datePublished">2019-11-28</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%BC%80%E5%8F%91/">å¼€å‘</a>â–º<a class="article-category-link" href="/categories/%E5%BC%80%E5%8F%91/C/">C#</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/soa-asp-dot-net-web-api-knowledge-points/">SOA â€”â€” ASP.NET Web API çŸ¥è¯†ç‚¹å°ç»“</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p><code>ASP.NET Web API</code> æ˜¯ä¸€ä¸ªæ¡†æ¶ï¼Œå¯ä»¥è½»æ¾åœ°æ„å»ºåŒ…å«æµè§ˆå™¨å’Œç§»åŠ¨è®¾å¤‡åœ¨å†…çš„å¹¿æ³›å®¢æˆ·ç«¯çš„ <code>HTTP</code> æœåŠ¡ã€‚</p>
<p><code>ASP.NET Web API</code> æ˜¯åœ¨ <code>.NET Framework</code> æ¡†æ¶ä¸Šæ„å»º <code>REST</code> é£æ ¼åº”ç”¨ç¨‹åºçš„ç†æƒ³å¹³å°ã€‚</p>
<h2 id="ä»€ä¹ˆæ˜¯-RESTful"><a href="#ä»€ä¹ˆæ˜¯-RESTful" class="headerlink" title="ä»€ä¹ˆæ˜¯ RESTful"></a>ä»€ä¹ˆæ˜¯ RESTful</h2><p>è¡¨ç°å±‚çŠ¶æ€è½¬æ¢ï¼ˆè‹±è¯­ï¼š Representational State Transfer ï¼Œç¼©å†™ï¼š REST ï¼‰æ˜¯ä¸€ç§æ¶æ„é£æ ¼ï¼Œæ–¹ä¾¿ä¸åŒè½¯ä»¶æˆ–ç¨‹åºåœ¨ç½‘ç»œä¸­äº’ç›¸ä¼ é€’æ¶ˆæ¯ã€‚è¡¨ç°å±‚çŠ¶æ€è½¬æ¢æ˜¯åŸºäº HTTP ä¹‹ä¸Šè€Œç¡®å®šçš„ä¸€ç»„çº¦å®šå’Œå±æ€§ï¼Œæ˜¯ä¸€ç§è®¾è®¡æä¾›å…¨çƒèµ„è®¯ç½‘ç»œæœåŠ¡çš„è½¯ä»¶æ„å»ºé£æ ¼ã€‚</p>
<p>ç¬¦åˆæˆ–å…¼å®¹è¿™ç§æ¶æ„é£æ ¼ï¼ˆç®€ç§°ä¸º REST æˆ– RESTful ï¼‰çš„ç½‘ç»œæœåŠ¡ï¼Œç›®å‰ä¸»æµçš„ Web æœåŠ¡å®ç°æ–¹æ¡ˆä¸­ï¼Œå› ä¸º REST æ¨¡å¼ä¸å¤æ‚çš„ SOAP å’Œ XML-RPC ç›¸æ¯”æ›´åŠ ç®€æ´ï¼Œæ‰€ä»¥è¶Šæ¥è¶Šå¤šçš„æœåŠ¡å¼€å§‹é‡‡ç”¨ REST é£æ ¼è®¾è®¡å’Œå®ç°ã€‚</p>
<h3 id="REST-æ¶æ„çš„è¦ç‚¹"><a href="#REST-æ¶æ„çš„è¦ç‚¹" class="headerlink" title="REST æ¶æ„çš„è¦ç‚¹"></a>REST æ¶æ„çš„è¦ç‚¹</h3><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ REST æ˜¯è®¾è®¡é£æ ¼è€Œä¸æ˜¯æ ‡å‡†ã€‚ REST é€šå¸¸åŸºäºä½¿ç”¨ HTTP ï¼Œ URI ï¼Œå’Œ XML ä»¥åŠ HTML è¿™äº›ç°æœ‰çš„å¹¿æ³›æµè¡Œçš„åè®®å’Œæ ‡å‡†ã€‚</p>
<ul>
<li>èµ„æºæ˜¯ç”±URIæ¥æŒ‡å®šã€‚</li>
<li>å¯¹èµ„æºçš„æ“ä½œåŒ…æ‹¬è·å–ã€åˆ›å»ºã€ä¿®æ”¹å’Œåˆ é™¤èµ„æºï¼Œè¿™äº›æ“ä½œæ­£å¥½å¯¹åº” HTTP åè®®æä¾›çš„ GET ã€ POST ã€ PUT å’Œ DELETE æ–¹æ³•ã€‚</li>
<li>é€šè¿‡æ“ä½œèµ„æºçš„è¡¨ç°å½¢å¼æ¥æ“ä½œèµ„æºã€‚</li>
<li>èµ„æºçš„è¡¨ç°å½¢å¼åˆ™æ˜¯ XML æˆ–è€… HTML ï¼Œå–å†³äºè¯»è€…æ˜¯æœºå™¨è¿˜æ˜¯äººï¼Œæ˜¯æ¶ˆè´¹ web æœåŠ¡çš„å®¢æˆ·è½¯ä»¶è¿˜æ˜¯ web æµè§ˆå™¨ã€‚å½“ç„¶ä¹Ÿå¯ä»¥æ˜¯ä»»ä½•å…¶ä»–çš„æ ¼å¼ï¼Œä¾‹å¦‚ JSON ã€‚</li>
</ul>
<h3 id="REST-æ¶æ„çš„çº¦æŸæ¡ä»¶"><a href="#REST-æ¶æ„çš„çº¦æŸæ¡ä»¶" class="headerlink" title="REST æ¶æ„çš„çº¦æŸæ¡ä»¶"></a>REST æ¶æ„çš„çº¦æŸæ¡ä»¶</h3><p>REST æ¶æ„é£æ ¼æœ€é‡è¦çš„æ¶æ„çº¦æŸæœ‰ 6 ä¸ªï¼š</p>
<ul>
<li>å®¢æˆ·ç«¯-æœåŠ¡å™¨ï¼ˆClient-Serverï¼‰</li>
<li>æ— çŠ¶æ€ï¼ˆStatelessï¼‰</li>
<li>ç¼“å­˜ï¼ˆCacheabilityï¼‰</li>
<li>ç»Ÿä¸€æ¥å£ï¼ˆUniform Interfaceï¼‰</li>
<li>åˆ†å±‚ç³»ç»Ÿï¼ˆLayered Systemï¼‰</li>
<li>æŒ‰éœ€ä»£ç ï¼ˆCode-On-Demandï¼Œå¯é€‰ï¼‰</li>
</ul>
<h3 id="åº”ç”¨äº-Web-æœåŠ¡"><a href="#åº”ç”¨äº-Web-æœåŠ¡" class="headerlink" title="åº”ç”¨äº Web æœåŠ¡"></a>åº”ç”¨äº Web æœåŠ¡</h3><p>ç¬¦åˆ REST è®¾è®¡é£æ ¼çš„ Web API ç§°ä¸º RESTful API ã€‚å®ƒä»ä»¥ä¸‹ä¸‰ä¸ªæ–¹é¢èµ„æºè¿›è¡Œå®šä¹‰ï¼š</p>
<ul>
<li>ç›´è§‚ç®€çŸ­çš„èµ„æºåœ°å€ï¼šURIï¼Œæ¯”å¦‚ï¼š<code>http://example.com/resources</code>ã€‚</li>
<li>ä¼ è¾“çš„èµ„æºï¼šWeb æœåŠ¡æ¥å—ä¸è¿”å›çš„äº’è”ç½‘åª’ä½“ç±»å‹ï¼Œæ¯”å¦‚ï¼šJSONï¼ŒXMLï¼ŒYAMLç­‰ã€‚</li>
<li>å¯¹èµ„æºçš„æ“ä½œï¼šWebæœåŠ¡åœ¨è¯¥èµ„æºä¸Šæ‰€æ”¯æŒçš„ä¸€ç³»åˆ—è¯·æ±‚æ–¹æ³•ï¼ˆæ¯”å¦‚ï¼šPOSTï¼ŒGETï¼ŒPUTæˆ–DELETEï¼‰ã€‚</li>
</ul>
<p>ä¸‹è¡¨åˆ—å‡ºäº†å®ç° RESTful API æ—¶ HTTP è¯·æ±‚æ–¹æ³•çš„å…¸å‹ç”¨é€”ã€‚</p>
<table>
<thead>
<tr>
<th align="left">èµ„æº</th>
<th align="left">ä¸€ç»„èµ„æºçš„URIï¼Œæ¯”å¦‚<code>https://example.com/resources</code></th>
<th align="left">å•ä¸ªèµ„æºçš„URIï¼Œæ¯”å¦‚<code>https://example.com/resources/142</code></th>
</tr>
</thead>
<tbody><tr>
<td align="left">GET</td>
<td align="left"><strong>åˆ—å‡º</strong>URIï¼Œä»¥åŠè¯¥èµ„æºç»„ä¸­æ¯ä¸ªèµ„æºçš„è¯¦ç»†ä¿¡æ¯ï¼ˆåè€…å¯é€‰ï¼‰ã€‚</td>
<td align="left"><strong>è·å–</strong>æŒ‡å®šçš„èµ„æºçš„è¯¦ç»†ä¿¡æ¯ï¼Œæ ¼å¼å¯ä»¥è‡ªé€‰ä¸€ä¸ªåˆé€‚çš„ç½‘ç»œåª’ä½“ç±»å‹ï¼ˆæ¯”å¦‚ï¼šXMLã€JSONç­‰ï¼‰</td>
</tr>
<tr>
<td align="left">PUT</td>
<td align="left">ä½¿ç”¨ç»™å®šçš„ä¸€ç»„èµ„æº<strong>æ›¿æ¢</strong>å½“å‰æ•´ç»„èµ„æºã€‚</td>
<td align="left"><strong>æ›¿æ¢/åˆ›å»º</strong>æŒ‡å®šçš„èµ„æºã€‚å¹¶å°†å…¶è¿½åŠ åˆ°ç›¸åº”çš„èµ„æºç»„ä¸­ã€‚</td>
</tr>
<tr>
<td align="left">POST</td>
<td align="left">åœ¨æœ¬ç»„èµ„æºä¸­<strong>åˆ›å»º/è¿½åŠ </strong>ä¸€ä¸ªæ–°çš„èµ„æºã€‚è¯¥æ“ä½œå¾€å¾€è¿”å›æ–°èµ„æºçš„URLã€‚</td>
<td align="left">æŠŠæŒ‡å®šçš„èµ„æºå½“åšä¸€ä¸ªèµ„æºç»„ï¼Œå¹¶åœ¨å…¶ä¸‹<strong>åˆ›å»º/è¿½åŠ </strong>ä¸€ä¸ªæ–°çš„å…ƒç´ ï¼Œä½¿å…¶éš¶å±äºå½“å‰èµ„æºã€‚</td>
</tr>
<tr>
<td align="left">DELETE</td>
<td align="left"><strong>åˆ é™¤</strong>æ•´ç»„èµ„æºã€‚</td>
<td align="left"><strong>åˆ é™¤</strong>æŒ‡å®šçš„å…ƒç´ ã€‚</td>
</tr>
</tbody></table>
<h2 id="åˆ›å»º-ASP-NET-Web-API"><a href="#åˆ›å»º-ASP-NET-Web-API" class="headerlink" title="åˆ›å»º ASP.NET Web API"></a>åˆ›å»º ASP.NET Web API</h2><p>ä½¿ç”¨ Visual Studio å¯ä»¥ç›´æ¥åˆ›å»º <code>ASP.NET Web API</code>ï¼Œä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯æ¡†æ¶éœ€è¦é€‰æ‹© <code>.NET Framework 4.5+</code> ã€‚</p>
<p><img src="https://hd2y.oss-cn-beijing.aliyuncs.com/20191126182304_1574926124594.png" alt="20191126182304"></p>
<p>åˆ›å»ºæˆåŠŸä»¥åï¼Œå¯ä»¥ç›´æ¥æ‰¾åˆ°è§†å›¾ä¸­çš„ <code>Home/Index.cshtml</code> å°†é¡¹ç›®è¿è¡Œèµ·æ¥ï¼š</p>
<p><img src="https://hd2y.oss-cn-beijing.aliyuncs.com/20191126185906_1574926124550.png" alt="20191126185906"></p>
<p>å¯ä»¥æ³¨æ„åˆ° <code>Controllers</code> æ–‡ä»¶å¤¹ä¸­ï¼Œåˆ›å»ºäº†ä¸€ä¸ªé»˜è®¤çš„ <code>ValuesController</code>ï¼Œå…¶ç»§æ‰¿è‡ª <code>ApiController</code>ï¼š</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> System.Linq;</span><br><span class="line"><span class="keyword">using</span> System.Net;</span><br><span class="line"><span class="keyword">using</span> System.Net.Http;</span><br><span class="line"><span class="keyword">using</span> System.Web.Http;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">JohnSun.SOA.WebAPI.Server.Controllers</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ValuesController</span> : <span class="title">ApiController</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// GET api/values</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> IEnumerable&lt;<span class="built_in">string</span>&gt; <span class="title">Get</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">string</span>[] &#123; <span class="string">&quot;value1&quot;</span>, <span class="string">&quot;value2&quot;</span> &#125;;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// GET api/values/5</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="built_in">string</span> <span class="title">Get</span>(<span class="params"><span class="built_in">int</span> id</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;value&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// POST api/values</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Post</span>(<span class="params">[FromBody]<span class="built_in">string</span> <span class="keyword">value</span></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// PUT api/values/5</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Put</span>(<span class="params"><span class="built_in">int</span> id, [FromBody]<span class="built_in">string</span> <span class="keyword">value</span></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// DELETE api/values/5</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Delete</span>(<span class="params"><span class="built_in">int</span> id</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡æµè§ˆå™¨æ¥ç›´æ¥è®¿é—® <code>http://localhost:58683/api/values</code>ï¼š</p>
<p><img src="https://hd2y.oss-cn-beijing.aliyuncs.com/20191126190257_1574926124635.png" alt="20191126190257"></p>
<p>æµè§ˆå™¨æ˜¯ GET è¯·æ±‚ï¼Œæ‰€ä»¥è¿”å›çš„æ˜¯å¦‚ä¸Šå†…å®¹ï¼Œå¦‚æœéœ€è¦ä½¿ç”¨å…¶ä»–è¯·æ±‚ï¼Œå¯ä»¥ä½¿ç”¨ <code>postman</code> è¿›è¡Œè°ƒè¯•ã€‚</p>
<p><img src="https://hd2y.oss-cn-beijing.aliyuncs.com/20191126190633_1574926127834.png" alt="20191126190633"></p>
<h3 id="è·¯ç”±"><a href="#è·¯ç”±" class="headerlink" title="è·¯ç”±"></a>è·¯ç”±</h3><p>é¦–å…ˆæˆ‘ä»¬è‡ªå®šä¹‰ä¸€ä¸ªæ§åˆ¶å™¨ç”¨äºæµ‹è¯•ï¼š</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> System.Linq;</span><br><span class="line"><span class="keyword">using</span> System.Net;</span><br><span class="line"><span class="keyword">using</span> System.Net.Http;</span><br><span class="line"><span class="keyword">using</span> System.Web.Http;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">JohnSun.SOA.WebAPI.Server.Controllers</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">UsersController</span> : <span class="title">ApiController</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> List&lt;User&gt; Users = <span class="keyword">new</span> List&lt;User&gt;</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">new</span> User&#123; Id = <span class="number">1</span>, Type = UserType.Admin, Name = <span class="string">&quot;Admin&quot;</span> &#125;,</span><br><span class="line">            <span class="keyword">new</span> User&#123; Id = <span class="number">2</span>, Type = UserType.Admin, Name = <span class="string">&quot;John&quot;</span>, Sex = UserSex.Male &#125;,</span><br><span class="line">            <span class="keyword">new</span> User&#123; Id = <span class="number">3</span>, Name = <span class="string">&quot;Kangkang&quot;</span>, Sex = UserSex.Male &#125;,</span><br><span class="line">            <span class="keyword">new</span> User&#123; Id = <span class="number">4</span>, Name = <span class="string">&quot;Micheal&quot;</span>, Sex = UserSex.Male &#125;,</span><br><span class="line">            <span class="keyword">new</span> User&#123; Id = <span class="number">5</span>, Name = <span class="string">&quot;Jane&quot;</span>, Sex = UserSex.Female &#125;,</span><br><span class="line">            <span class="keyword">new</span> User&#123; Id = <span class="number">6</span>, Name = <span class="string">&quot;Meimei&quot;</span>, Sex = UserSex.Female &#125;,</span><br><span class="line">            <span class="keyword">new</span> User&#123; Id = <span class="number">7</span>, Name = <span class="string">&quot;Xiaoli&quot;</span>, Sex = UserSex.Female &#125;,</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">GetAll</span>(<span class="params"></span>) </span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">return</span> Users;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> User <span class="title">GetUser</span>(<span class="params"><span class="built_in">int</span> id</span>) </span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">return</span> Users.Find(u =&gt; u.Id == id);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">User</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">int</span> Id &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">        <span class="keyword">public</span> UserType Type &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">string</span> Name &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">        <span class="keyword">public</span> UserSex Sex &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">enum</span> UserType</span><br><span class="line">    &#123;</span><br><span class="line">        Normal,</span><br><span class="line">        Admin,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">enum</span> UserSex</span><br><span class="line">    &#123;</span><br><span class="line">        Unknown,</span><br><span class="line">        Male,</span><br><span class="line">        Female,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åŒé»˜è®¤åˆ›å»ºçš„æ§åˆ¶å™¨å•Šä¸€æ ·ï¼Œå¯ä»¥ç›´æ¥é€šè¿‡ <code>postman</code> æˆ–æµè§ˆå™¨è®¿é—®ï¼š</p>
<p><img src="https://hd2y.oss-cn-beijing.aliyuncs.com/20191127103549_1574926127837.png" alt="20191127103549"></p>
<h3 id="æ¨¡æ¿è·¯ç”±"><a href="#æ¨¡æ¿è·¯ç”±" class="headerlink" title="æ¨¡æ¿è·¯ç”±"></a>æ¨¡æ¿è·¯ç”±</h3><p>åŒ <code>MVC</code> é¡¹ç›®ä¸€æ ·ï¼Œå¦‚æœéœ€è¦äº†è§£é¡¹ç›®çš„é…ç½®ï¼Œå¯ä»¥æ‰¾åˆ°ç¨‹åºçš„å…¥å£è¿›è¡Œäº†è§£ï¼Œæ‰“å¼€ <code>Global.asax.cs</code> æ–‡ä»¶ï¼ŒæŸ¥çœ‹ <code>Application_Start()</code> æ–¹æ³•ï¼Œå…¶ä¸­æœ‰è¿™ä¹ˆä¸€æ®µï¼š</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GlobalConfiguration.Configure(WebApiConfig.Register);</span><br></pre></td></tr></table></figure>
<p>è½¬åˆ° <code>WebApiConfig.Register</code> æ–¹æ³•ï¼š</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Register</span>(<span class="params">HttpConfiguration config</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// Web API é…ç½®å’ŒæœåŠ¡</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Web API è·¯ç”±</span></span><br><span class="line">    config.MapHttpAttributeRoutes();</span><br><span class="line"></span><br><span class="line">    config.Routes.MapHttpRoute(</span><br><span class="line">        name: <span class="string">&quot;DefaultApi&quot;</span>,</span><br><span class="line">        routeTemplate: <span class="string">&quot;api/&#123;controller&#125;/&#123;id&#125;&quot;</span>,</span><br><span class="line">        defaults: <span class="keyword">new</span> &#123; id = RouteParameter.Optional &#125;</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç”±ä¸Šå¯ä»¥çœ‹åˆ°æ³¨å†Œäº†è·¯ç”±è§„åˆ™ï¼Œ<code>api</code> ä»£è¡¨åœ¨èµ„æºå‰é¢è¦å¸¦ä¸Š <code>api</code> ç›®å½•ï¼Œ<code>&#123;controller&#125;</code> ä¸ºè¯·æ±‚èµ„æºçš„æ§åˆ¶å™¨åç§°ï¼Œ<code>&#123;id&#125;</code> ä¸ºä»£è¡¨ä¸€ä¸ªèµ„æºçš„ <code>ID</code> ï¼Œè€Œä¸‹é¢æŒ‡å®šçš„ <code>RouteParameter.Optional</code> åˆ™è¡¨ç¤ºè¿™ä¸ªå‚æ•°æ˜¯å¯é€‰çš„ã€‚</p>
<p>é»˜è®¤çš„è·¯ç”±å°±æ˜¯æ¨¡æ¿è·¯ç”±ï¼Œè·¯ç”±è§„åˆ™æ˜¯éµå¾ª <code>REST</code> é£æ ¼çš„ï¼Œå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªæ§åˆ¶å™¨ä»£è¡¨ä¸€ç±»èµ„æºã€‚å¦‚æœæ²¡æœ‰ç‰¹æ®Šçš„éœ€æ±‚ï¼Œä¸å»ºè®®ä¿®æ”¹è¯¥è·¯ç”±è§„åˆ™ã€‚</p>
<p>ç‰¹æ®Šå ä½ç¬¦é™¤äº†é»˜è®¤çš„ <code>&#123;controller&#125;</code> ï¼Œè¿˜æ”¯æŒ <code>&#123;action&#125;</code> ï¼Œå¦‚æœæ¨¡æ¿ä¸­é…ç½®ï¼Œåˆ™è¯¥ä½ç½®æ ‡å¿—å¯¹åº”æ§åˆ¶å™¨ä¸­çš„æ–¹æ³•ã€‚</p>
<p>ä¾‹å¦‚æˆ‘ä»¬å°†æ¨¡æ¿è·¯ç”±ä¿®æ”¹ä¸º <code>routeTemplate: api/&#123;controller&#125;/&#123;action&#125;/&#123;id&#125;</code> ï¼Œå¦‚æœæˆ‘ä»¬ä»ç„¶éœ€è¦è°ƒç”¨ <code>UsersController</code> ä¸­çš„æ–¹æ³•å°±éœ€è¦æŒ‡å®šè°ƒç”¨çš„æ–¹æ³•åï¼Œå¦‚æœæˆ‘ä»¬ä¸è°ƒæ•´å°†å‡ºç°æŠ¥é”™ <code>http://localhost:58683/api/users</code> ï¼š</p>
<p><img src="https://hd2y.oss-cn-beijing.aliyuncs.com/20191127120341_1574926127840.png" alt="20191127120341"></p>
<p>è¿™æ—¶å°±éœ€è¦æˆ‘ä»¬æŒ‡å®šéœ€è¦è°ƒç”¨çš„æ§åˆ¶å™¨çš„æ–¹æ³• <code>http://localhost:58683/api/users/getall</code> ï¼š</p>
<p><img src="https://hd2y.oss-cn-beijing.aliyuncs.com/20191127120510_1574926131285.png" alt="20191127120510"></p>
<p>é»˜è®¤æ§åˆ¶å™¨ä¸­å ä½ç¬¦ <code>&#123;id&#125;</code> ä¸ºè‡ªå®šä¹‰å ä½ç¬¦ï¼Œ<code>defaults: new &#123; id = RouteParameter.Optional &#125;</code> æŒ‡å®šäº†å…¶é»˜è®¤å€¼ï¼Œè¡¨ç¤ºå…¶ä¸ºä¸€ä¸ªå¯é€‰å‚æ•°ã€‚</p>
<p>é™¤å¯ä»¥æŒ‡å®šé»˜è®¤å€¼ä»¥å¤–ï¼Œè¿˜å¯ä»¥é€šè¿‡æ­£åˆ™æŒ‡å®šå½•å…¥å€¼çš„è§„åˆ™ï¼Œå¯ä»¥é€šè¿‡å…¥å‚ <code>constraints</code> æŒ‡å®šï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">config.Routes.MapHttpRoute(</span><br><span class="line">    name: <span class="string">&quot;DefaultApi&quot;</span>,</span><br><span class="line">    routeTemplate: <span class="string">&quot;api/&#123;controller&#125;/&#123;id&#125;&quot;</span>,</span><br><span class="line">    defaults: <span class="keyword">new</span> &#123; id = RouteParameter.Optional &#125;,</span><br><span class="line">    constraints: <span class="keyword">new</span> &#123; id = <span class="string">@&quot;\d&#123;1,2&#125;&quot;</span> &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ <code>constraints</code> ä¼˜å…ˆçº§è¦æ¯” <code>RouteParameter.Optional</code> é«˜ï¼Œä¾‹å¦‚ä»¥ä¸Šè®¾å®šçš„è·¯ç”±æ¨¡æ¿ï¼Œå¦‚æœä¸ä¼ è¾“IDï¼Œå°†è¿”å› <code>404</code>ï¼š</p>
<p>ä½†æ˜¯å¦‚æœæŒ‡å®šæ˜¯é»˜è®¤å€¼ï¼Œä¾‹å¦‚ <code>defaults: new &#123; id = 1 &#125;</code>ï¼Œæœªå½•å…¥ä¹Ÿå¯ä»¥è®¿é—®åˆ°èµ„æºã€‚</p>
<h3 id="ç‰¹æ€§è·¯ç”±"><a href="#ç‰¹æ€§è·¯ç”±" class="headerlink" title="ç‰¹æ€§è·¯ç”±"></a>ç‰¹æ€§è·¯ç”±</h3><p>é™¤è·¯ç”±æ¨¡æ¿å¤–ï¼Œè¿˜å¯ä»¥åœ¨æ§åˆ¶å™¨ä¸æ§åˆ¶å™¨æ–¹æ³•ä¸Šæ ‡è®° <code>RouteAttribute</code> æ¥å®šä¹‰ç‰¹æ€§è·¯ç”±ï¼Œä¾‹å¦‚æˆ‘ä»¬åœ¨ <code>UsersController</code> å¢åŠ ä¸¤ä¸ªå¸¦æœ‰ç‰¹æ€§è·¯ç”±çš„æ–¹æ³•ï¼š</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">Route(<span class="meta-string">&quot;api/admins&quot;</span>)</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">GetAllAdmin</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> Users.FindAll(u =&gt; u.Type == UserType.Admin);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[<span class="meta">Route(<span class="meta-string">&quot;api/admins/&#123;id&#125;&quot;</span>)</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> User <span class="title">GetAdmin</span>(<span class="params"><span class="built_in">int</span> id</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> Users.Find(u =&gt; u.Type == UserType.Admin &amp;&amp; u.Id == id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ <code>http://localhost:58683/api/admins</code> æ¥è¯·æ±‚ç®¡ç†å‘˜èº«ä»½çš„ç”¨æˆ·ä¿¡æ¯ã€‚</p>
<p>ç‰¹æ€§è·¯ç”±é™¤äº†ä¸Šæ–‡ä¸­æ¼”ç¤ºçš„é‡è½½æˆ‘ä»¬çš„ <code>URI</code> å¤–ï¼Œè¿˜å¯ä»¥å®ç° <code>API</code> çš„ç‰ˆæœ¬æ§åˆ¶ï¼Œä¾‹å¦‚å®šä¹‰ä¸ºï¼š <code>api/v1/users</code> ã€ <code>api/v2/users</code> ã€‚</p>
<p>å¦å¤–è¿˜å¯ä»¥ç”¨äºä¼ è¾“å¤šä¸ªå‚æ•°ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">Route(<span class="meta-string">&quot;api/users/type/&#123;type&#125;/sex/&#123;sex&#125;&quot;</span>)</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> User <span class="title">GetUser</span>(<span class="params">UserType type, UserSex sex</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> Users.Find(u =&gt; u.Type == type &amp;&amp; u.Sex == sex);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>http://localhost:58683/api/users/type/admin/sex/male</code> æ¥è®¿é—®ï¼š</p>
<p><img src="https://hd2y.oss-cn-beijing.aliyuncs.com/20191127194713_1574926131276.png" alt="20191127194713"></p>
<h4 id="HTTP-æ–¹æ³•"><a href="#HTTP-æ–¹æ³•" class="headerlink" title="HTTP æ–¹æ³•"></a>HTTP æ–¹æ³•</h4><p><code>Web API</code> é™¤åŒ¹é…è·¯ç”±è§„åˆ™å¤–ï¼Œè¿˜å°†é€‰æ‹©æ“ä½œè¯·æ±‚ ï¼ˆ <code>GET</code> ã€  <code>POST</code> ç­‰ï¼‰ çš„ <code>HTTP</code> æ–¹æ³•ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>Web API</code> å°†æŸ¥æ‰¾ä¸æ§åˆ¶å™¨æ–¹æ³•åç§°çš„å¼€å¤´çš„ä¸åŒºåˆ†å¤§å°å†™åŒ¹é…ã€‚ ä¾‹å¦‚ï¼Œåä¸ºçš„æ§åˆ¶å™¨æ–¹æ³• <code>PutCustomers</code> åŒ¹é… <code>HTTP</code> <code>PUT</code> è¯·æ±‚ã€‚</p>
<p>ä»¥ä¸‹å±æ€§æ¥ä¿®é¥°çš„æ–¹æ³•ä¸ä»»ä½•æ›¿ä»£æ­¤çº¦å®šï¼š</p>
<ul>
<li><strong>[HttpDelete]</strong></li>
<li><strong>[HttpGet]</strong></li>
<li><strong>[HttpHead]</strong></li>
<li><strong>[HttpOptions]</strong></li>
<li><strong>[HttpPatch]</strong></li>
<li><strong>[HttpPost]</strong></li>
<li><strong>[HttpPut]</strong></li>
</ul>
<p>ä»¥ä¸‹ä»£ç æµ‹è¯•äº†æ ‡è®°äº† <code>HTTP</code> æ–¹æ³•ç‰¹æ€§çš„ <code>GetTest</code> æ–¹æ³•ï¼Œå¦‚æœæ²¡æœ‰æ ‡è®° <code>[HttpPost]</code> ï¼Œè¯¥æ–¹æ³•åªèƒ½ä½¿ç”¨ <code>GET</code> è¯·æ±‚ï¼Œä½†æ˜¯æ ‡è®°ä¹‹åå°†åªèƒ½ä½¿ç”¨ <code>POST</code> è¯·æ±‚ã€‚</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">HttpPost</span>]</span><br><span class="line">[<span class="meta">Route(<span class="meta-string">&quot;api/users/test&quot;</span>)</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="built_in">string</span> <span class="title">GetTest</span>(<span class="params"></span>) </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;test&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>GET</code> è¯·æ±‚ï¼š</p>
<p><img src="https://hd2y.oss-cn-beijing.aliyuncs.com/20191127195911_1574926134235.png" alt="20191127195911"></p>
<p><code>POST</code> è¯·æ±‚ï¼š</p>
<p><img src="https://hd2y.oss-cn-beijing.aliyuncs.com/20191127195922_1574926134237.png" alt="20191127195922"></p>
<p>å¦‚æœä¸¤ç§éƒ½éœ€è¦ï¼Œå¯ä»¥æ ‡è®°å¤šä¸ªï¼Œåœ¨æ·»åŠ ä¸€ä¸ª <code>[HttpGet]</code> ç‰¹æ€§å³å¯ã€‚</p>
<p>å¯¹äºå…¶ä»–çš„ <code>HTTP</code> æ–¹æ³•ï¼ŒåŒ…æ‹¬éæ ‡å‡†çš„æ–¹æ³•ï¼Œä½¿ç”¨ <code>AcceptVerbs</code> ç‰¹æ€§ï¼š</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">AcceptVerbs(<span class="meta-string">&quot;View&quot;</span>)</span>]</span><br><span class="line">[<span class="meta">Route(<span class="meta-string">&quot;api/users/test&quot;</span>)</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="built_in">string</span> <span class="title">GetTest</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;test&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://hd2y.oss-cn-beijing.aliyuncs.com/20191127200616_1574926134248.png" alt="20191127200616"></p>
<h4 id="è·¯ç”±å‰ç¼€"><a href="#è·¯ç”±å‰ç¼€" class="headerlink" title="è·¯ç”±å‰ç¼€"></a>è·¯ç”±å‰ç¼€</h4><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œæ‰€æœ‰ä»¥ç›¸åŒå‰ç¼€å¼€å¤´çš„æ§åˆ¶å™¨ä¸­çš„è·¯ç”±ï¼Œå¯ä»¥é€šè¿‡ä½¿ç”¨é’ˆå¯¹æ•´ä¸ªæ§åˆ¶å™¨è®¾ç½®å…¬å…±å‰ç¼€ <code>[RoutePrefix]</code> ç‰¹æ€§ï¼š</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">BooksController</span> : <span class="title">ApiController</span></span><br><span class="line">&#123;</span><br><span class="line">    [<span class="meta">Route(<span class="meta-string">&quot;api/books&quot;</span>)</span>]</span><br><span class="line">    <span class="function"><span class="keyword">public</span> IEnumerable&lt;Book&gt; <span class="title">GetBooks</span>(<span class="params"></span>)</span> &#123; ... &#125;</span><br><span class="line"></span><br><span class="line">    [<span class="meta">Route(<span class="meta-string">&quot;api/books/&#123;id:int&#125;&quot;</span>)</span>]</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Book <span class="title">GetBook</span>(<span class="params"><span class="built_in">int</span> id</span>)</span> &#123; ... &#125;</span><br><span class="line"></span><br><span class="line">    [<span class="meta">Route(<span class="meta-string">&quot;api/books&quot;</span>)</span>]</span><br><span class="line">    [<span class="meta">HttpPost</span>]</span><br><span class="line">    <span class="function"><span class="keyword">public</span> HttpResponseMessage <span class="title">CreateBook</span>(<span class="params">Book book</span>)</span> &#123; ... &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// èµ„æºè¯·æ±‚é“¾æ¥ä¸ä¸Šä¸€æ®µä»£ç ä¸€è‡´</span></span><br><span class="line">[<span class="meta">RoutePrefix(<span class="meta-string">&quot;api/books&quot;</span>)</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">BooksController</span> : <span class="title">ApiController</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// GET api/books</span></span><br><span class="line">    [<span class="meta">Route(<span class="meta-string">&quot;&quot;</span>)</span>]</span><br><span class="line">    <span class="function"><span class="keyword">public</span> IEnumerable&lt;Book&gt; <span class="title">Get</span>(<span class="params"></span>)</span> &#123; ... &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// GET api/books/5</span></span><br><span class="line">    [<span class="meta">Route(<span class="meta-string">&quot;&#123;id:int&#125;&quot;</span>)</span>]</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Book <span class="title">Get</span>(<span class="params"><span class="built_in">int</span> id</span>)</span> &#123; ... &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// POST api/books</span></span><br><span class="line">    [<span class="meta">Route(<span class="meta-string">&quot;&quot;</span>)</span>]</span><br><span class="line">    <span class="function"><span class="keyword">public</span> HttpResponseMessage <span class="title">Post</span>(<span class="params">Book book</span>)</span> &#123; ... &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¦‚æœä¸æƒ³ä½¿ç”¨è·¯ç”±å‰ç¼€ï¼Œå¯ä»¥ä½¿ç”¨ <code>~</code> ç¬¦å·ï¼š</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">RoutePrefix(<span class="meta-string">&quot;api/books&quot;</span>)</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">BooksController</span> : <span class="title">ApiController</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// GET /api/authors/1/books</span></span><br><span class="line">    [<span class="meta">Route(<span class="meta-string">&quot;~/api/authors/&#123;authorId:int&#125;/books&quot;</span>)</span>]</span><br><span class="line">    <span class="function"><span class="keyword">public</span> IEnumerable&lt;Book&gt; <span class="title">GetByAuthor</span>(<span class="params"><span class="built_in">int</span> authorId</span>)</span> &#123; ... &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è·¯ç”±å‰ç¼€å¯ä»¥åŒ…å«å‚æ•°ï¼š</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">RoutePrefix(<span class="meta-string">&quot;customers/&#123;customerId&#125;&quot;</span>)</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">OrdersController</span> : <span class="title">ApiController</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// GET customers/1/orders</span></span><br><span class="line">    [<span class="meta">Route(<span class="meta-string">&quot;orders&quot;</span>)</span>]</span><br><span class="line">    <span class="function"><span class="keyword">public</span> IEnumerable&lt;Order&gt; <span class="title">Get</span>(<span class="params"><span class="built_in">int</span> customerId</span>)</span> &#123; ... &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="è·¯ç”±çº¦æŸ"><a href="#è·¯ç”±çº¦æŸ" class="headerlink" title="è·¯ç”±çº¦æŸ"></a>è·¯ç”±çº¦æŸ</h4><p>è·¯ç”±çº¦æŸè®©ä½ é™åˆ¶å¦‚ä½•åŒ¹é…è·¯ç”±æ¨¡æ¿ä¸­çš„å‚æ•°ã€‚ å¸¸è§„è¯­æ³• <code>&#123;å‚æ•°å:çº¦æŸ&#125;</code> ã€‚ ä¾‹å¦‚ï¼š</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">Route(<span class="meta-string">&quot;api/users/&#123;id:int&#125;&quot;</span>)</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> User <span class="title">GetUserById</span>(<span class="params"><span class="built_in">int</span> id</span>)</span> &#123; ... &#125;</span><br><span class="line"></span><br><span class="line">[<span class="meta">Route(<span class="meta-string">&quot;api/users/&#123;name&#125;&quot;</span>)</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> User <span class="title">GetUserByName</span>(<span class="params"><span class="built_in">string</span> name</span>)</span> &#123; ... &#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨è¿™é‡Œï¼Œç¬¬ä¸€ä¸ªè·¯ç”±å°†ä»…é€‰æ‹© <code>URI</code> æ®µä¸­ <code>id</code> æ˜¯ä¸€ä¸ªæ•´æ•°ï¼Œä¾‹å¦‚ <code>http://localhost:58683/api/users/1001</code> ã€‚å¦åˆ™ï¼Œå°†é€‰æ‹©ç¬¬äºŒä¸ªè·¯ç”±ï¼Œä¾‹å¦‚ <code>http://localhost:58683/api/users/John</code> ã€‚</p>
<p>ä¸‹è¡¨åˆ—å‡ºäº†æ”¯æŒçš„çº¦æŸï¼š</p>
<table>
<thead>
<tr>
<th align="center">çº¦æŸ</th>
<th align="center">æè¿°</th>
<th align="center">ç¤ºä¾‹</th>
</tr>
</thead>
<tbody><tr>
<td align="center">alpha</td>
<td align="center">åŒ¹é…å¤§å†™æˆ–å°å†™å­—ç¬¦ <code>(a-zã€ A-Z)</code></td>
<td align="center"><code>&#123;x: alpha&#125;</code></td>
</tr>
<tr>
<td align="center">bool</td>
<td align="center">åŒ¹é…ä¸€ä¸ªå¸ƒå°”å€¼ã€‚</td>
<td align="center"><code>&#123;x: bool&#125; </code></td>
</tr>
<tr>
<td align="center">datetime</td>
<td align="center">åŒ¹é…é¡¹DateTimeå€¼ã€‚</td>
<td align="center"><code>&#123;x: datetime&#125;</code></td>
</tr>
<tr>
<td align="center">decimal</td>
<td align="center">åŒ¹é…åè¿›åˆ¶å€¼ã€‚</td>
<td align="center"><code>&#123;x:decimal&#125;</code></td>
</tr>
<tr>
<td align="center">double</td>
<td align="center">ä¸ <code>64</code> ä½æµ®ç‚¹å€¼åŒ¹é…ã€‚</td>
<td align="center"><code>&#123;x:double&#125;</code></td>
</tr>
<tr>
<td align="center">float</td>
<td align="center">ä¸ <code>32</code> ä½æµ®ç‚¹å€¼åŒ¹é…ã€‚</td>
<td align="center"><code>&#123;x: float&#125;</code></td>
</tr>
<tr>
<td align="center">guid</td>
<td align="center">åŒ¹é…çš„ <code>GUID</code> å€¼ã€‚</td>
<td align="center"><code>&#123;x: guid&#125;</code></td>
</tr>
<tr>
<td align="center">int</td>
<td align="center">ä¸ <code>32</code> ä½æ•´æ•°å€¼åŒ¹é…ã€‚</td>
<td align="center"><code>&#123;x: int&#125;</code></td>
</tr>
<tr>
<td align="center">length</td>
<td align="center">ä¸å…·æœ‰æŒ‡å®šé•¿åº¦æˆ–é•¿åº¦çš„æŒ‡å®šèŒƒå›´å†…çš„å­—ç¬¦ä¸²åŒ¹é…ã€‚</td>
<td align="center"><code>&#123;x:length(6)&#125; &#123;x:length(1,20)&#125;</code></td>
</tr>
<tr>
<td align="center">long</td>
<td align="center">ä¸ <code>64</code> ä½æ•´æ•°å€¼åŒ¹é…ã€‚</td>
<td align="center"><code>&#123;x: long&#125;</code></td>
</tr>
<tr>
<td align="center">max</td>
<td align="center">åŒ¹é…ä¸€ä¸ªæ•´æ•°ï¼Œå…¶æœ€å¤§å€¼ã€‚</td>
<td align="center"><code>&#123;x:max(10)&#125;</code></td>
</tr>
<tr>
<td align="center">maxlength</td>
<td align="center">ä¸æœ€å¤§é•¿åº¦çš„å­—ç¬¦ä¸²åŒ¹é…ã€‚</td>
<td align="center"><code>&#123;x:maxlength(10)&#125;</code></td>
</tr>
<tr>
<td align="center">min</td>
<td align="center">åŒ¹é…ä¸€ä¸ªæ•´æ•°ï¼Œå…¶æœ€å°å€¼ã€‚</td>
<td align="center"><code>&#123;x: min(10)&#125;</code></td>
</tr>
<tr>
<td align="center">minlength</td>
<td align="center">ä¸æœ€å°é•¿åº¦çš„å­—ç¬¦ä¸²ç›¸åŒ¹é…ã€‚</td>
<td align="center"><code>&#123;x: minlength(10)&#125;</code></td>
</tr>
<tr>
<td align="center">range</td>
<td align="center">ä¸€ä¸ªæ•´æ•°å€¼çš„èŒƒå›´å†…çš„åŒ¹é…é¡¹ã€‚</td>
<td align="center"><code>&#123;x: range(10,50)&#125;</code></td>
</tr>
<tr>
<td align="center">æ­£åˆ™è¡¨è¾¾å¼</td>
<td align="center">ä¸æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ã€‚</td>
<td align="center"><code>&#123;x:regex(^\d&#123;3&#125;-\d&#123;3&#125;-\d&#123;4&#125;$)&#125;</code></td>
</tr>
</tbody></table>
<blockquote>
<p>æ³¨æ„ï¼šæŸäº›çº¦æŸï¼Œå¦‚ <code>min</code> ï¼Œåœ¨æ‹¬å·ä¸­é‡‡ç”¨è‡ªå˜é‡ã€‚å¯ä»¥å°†å¤šä¸ªçº¦æŸåº”ç”¨äºå‚æ•°ï¼Œç”¨å†’å·åˆ†éš”ã€‚</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">Route(<span class="meta-string">&quot;api/users/&#123;id:int:min(1)&#125;&quot;</span>)</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> User <span class="title">GetUserById</span>(<span class="params"><span class="built_in">int</span> id</span>)</span> &#123; ... &#125;</span><br></pre></td></tr></table></figure>
<p>é™¤é€šè¿‡ä»¥ä¸Šçº¦æŸé™åˆ¶å…¥å‚å¤–ï¼Œè¿˜å¯ä»¥é€šè¿‡å®ç° <code>IHttpRouteConstraint</code> æ¥å£æ¥åˆ›å»ºè‡ªå®šä¹‰è·¯ç”±çº¦æŸã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹å°†é™åˆ¶å‚æ•°ä¸ºéé›¶çš„æ•´æ•°å€¼ï¼š</p>
</blockquote>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">NonZeroConstraint</span> : <span class="title">IHttpRouteConstraint</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">bool</span> <span class="title">Match</span>(<span class="params">HttpRequestMessage request, IHttpRoute route, <span class="built_in">string</span> parameterName, </span></span></span><br><span class="line"><span class="function"><span class="params">        IDictionary&lt;<span class="built_in">string</span>, <span class="built_in">object</span>&gt; values, HttpRouteDirection routeDirection</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="built_in">object</span> <span class="keyword">value</span>;</span><br><span class="line">        <span class="keyword">if</span> (values.TryGetValue(parameterName, <span class="keyword">out</span> <span class="keyword">value</span>) &amp;&amp; <span class="keyword">value</span> != <span class="literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">long</span> longValue;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">value</span> <span class="keyword">is</span> <span class="built_in">long</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                longValue = (<span class="built_in">long</span>)<span class="keyword">value</span>;</span><br><span class="line">                <span class="keyword">return</span> longValue != <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="built_in">string</span> valueString = Convert.ToString(<span class="keyword">value</span>, CultureInfo.InvariantCulture);</span><br><span class="line">            <span class="keyword">if</span> (Int64.TryParse(valueString, NumberStyles.Integer, </span><br><span class="line">                CultureInfo.InvariantCulture, <span class="keyword">out</span> longValue))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> longValue != <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸‹é¢çš„ä»£ç æ¼”ç¤ºå¦‚ä½•æ³¨å†Œè¯¥çº¦æŸï¼š</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title">WebApiConfig</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Register</span>(<span class="params">HttpConfiguration config</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">var</span> constraintResolver = <span class="keyword">new</span> DefaultInlineConstraintResolver();</span><br><span class="line">        constraintResolver.ConstraintMap.Add(<span class="string">&quot;nonzero&quot;</span>, <span class="keyword">typeof</span>(NonZeroConstraint));</span><br><span class="line"></span><br><span class="line">        config.MapHttpAttributeRoutes(constraintResolver);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç°åœ¨å¯ä»¥å°†çº¦æŸåº”ç”¨åœ¨è·¯ç”±ä¸­ï¼š</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">Route(<span class="meta-string">&quot;&#123;id:nonzero&#125;&quot;</span>)</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> HttpResponseMessage <span class="title">GetNonZero</span>(<span class="params"><span class="built_in">int</span> id</span>)</span> &#123; ... &#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>æ³¨ï¼šä¹Ÿå¯ä»¥æ›¿æ¢æ•´ä¸ª <code>DefaultInlineConstraintResolver</code> ç±»çš„å®ç° <code>IInlineConstraintResolver</code> æ¥å£ã€‚æ‰§è¡Œæ­¤æ“ä½œå°†æ›¿æ¢çš„æ‰€æœ‰å†…ç½®çš„çº¦æŸï¼Œé™¤éä½ å®ç° <code>IInlineConstraintResolver</code> æ¥å£å†å°†å®ƒä»¬æ·»åŠ ã€‚</p>
</blockquote>
<h4 id="è·¯ç”±é¡ºåº"><a href="#è·¯ç”±é¡ºåº" class="headerlink" title="è·¯ç”±é¡ºåº"></a>è·¯ç”±é¡ºåº</h4><p>å½“æ¡†æ¶å°è¯•åŒ¹é…è·¯ç”±çš„ <code>URI</code> æ—¶ï¼Œå®ƒä¼šæŒ‰ç‰¹å®šçš„é¡ºåºåŒ¹é…è·¯ç”±ã€‚è‹¥è¦æŒ‡å®šé¡ºåºï¼Œå¯ä»¥è®¾ç½® <code>Route</code> ç‰¹æ€§çš„ <code>RouteOrder</code> çš„å€¼ï¼Œé»˜è®¤é¡ºåºå€¼ä¸ºé›¶ã€‚</p>
<p>ä¸‹é¢æ˜¯ç¡®è®¤æœ€ç»ˆæ’åºçš„æ–¹å¼ï¼š</p>
<ul>
<li>æ¯”è¾ƒ <code>Route</code> ç‰¹æ€§çš„ <code>RouteOrder</code> å±æ€§ã€‚</li>
<li>æŸ¥çœ‹è·¯ç”±æ¨¡æ¿ä¸­çš„æ¯ä¸ª <code>URI</code> æ®µã€‚ä¸ºæ¯ä¸ªæ®µè¿›è¡Œæ’åºï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š<ol>
<li>æ–‡æœ¬å†…å®¹ã€‚</li>
<li>å—è·¯ç”±çº¦æŸé™åˆ¶çš„è·¯ç”±å‚æ•°ã€‚</li>
<li>ä¸å—é™åˆ¶çš„è·¯ç”±å‚æ•°ã€‚</li>
<li>å—è·¯ç”±çº¦æŸçš„é€šé…ç¬¦è·¯ç”±å‚æ•°ã€‚</li>
<li>ä¸å—é™åˆ¶çš„é€šé…ç¬¦è·¯ç”±å‚æ•°ã€‚</li>
</ol>
</li>
<li>ä¸€ä¸ªå¯¹è·¯ç”±æ’åºçš„è·¯ç”±æ¨¡æ¿ï¼Œä½¿ç”¨ä¸åŒºåˆ†å¤§å°å†™çš„å­—ç¬¦ä¸²åºåˆ—è¿›è¡Œæ¯”è¾ƒ (OrdinalIgnoreCase) ã€‚</li>
</ul>
<p>å‡è®¾å®šä¹‰ä»¥ä¸‹æ§åˆ¶å™¨ï¼š</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">RoutePrefix(<span class="meta-string">&quot;orders&quot;</span>)</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">OrdersController</span> : <span class="title">ApiController</span></span><br><span class="line">&#123;</span><br><span class="line">    [<span class="meta">Route(<span class="meta-string">&quot;&#123;id:int&#125;&quot;</span>)</span>] <span class="comment">// constrained parameter</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> HttpResponseMessage <span class="title">Get</span>(<span class="params"><span class="built_in">int</span> id</span>)</span> &#123; ... &#125;</span><br><span class="line"></span><br><span class="line">    [<span class="meta">Route(<span class="meta-string">&quot;details&quot;</span>)</span>]  <span class="comment">// literal</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> HttpResponseMessage <span class="title">GetDetails</span>(<span class="params"></span>)</span> &#123; ... &#125;</span><br><span class="line"></span><br><span class="line">    [<span class="meta">Route(<span class="meta-string">&quot;pending&quot;</span>, RouteOrder = 1)</span>]</span><br><span class="line">    <span class="function"><span class="keyword">public</span> HttpResponseMessage <span class="title">GetPending</span>(<span class="params"></span>)</span> &#123; ... &#125;</span><br><span class="line"></span><br><span class="line">    [<span class="meta">Route(<span class="meta-string">&quot;&#123;customerName&#125;&quot;</span>)</span>]  <span class="comment">// unconstrained parameter</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> HttpResponseMessage <span class="title">GetByCustomer</span>(<span class="params"><span class="built_in">string</span> customerName</span>)</span> &#123; ... &#125;</span><br><span class="line"></span><br><span class="line">    [<span class="meta">Route(<span class="meta-string">&quot;&#123;*date:datetime&#125;&quot;</span>)</span>]  <span class="comment">// wildcard</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> HttpResponseMessage <span class="title">Get</span>(<span class="params">DateTime date</span>)</span> &#123; ... &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™äº›è·¯ç”±åŒ¹é…é¡ºåºå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<ol>
<li><code>orders/details</code></li>
<li><code>orders/&#123;id&#125;</code></li>
<li><code>orders/&#123;customerName&#125;</code></li>
<li><code>orders/&#123;*date&#125;</code></li>
<li><code>orders/pending</code></li>
</ol>
<blockquote>
<p>æ³¨ï¼š<code>details</code> æ˜¯ä¸€ä¸ªæ–‡æœ¬æ®µæ‰€ä»¥ä¼šå‡ºç°åœ¨ <code>&#123;id&#125;</code> ä¹‹å‰ï¼Œä½† <code>pending</code> è®¾ç½®äº† <code>RouteOrder</code> ä¸º <code>1</code> ï¼Œæ‰€ä»¥ä¼šæ˜¾ç¤ºåœ¨å…¶ä»–æœªè®¾ç½®è¯¥å±æ€§ï¼Œé»˜è®¤ <code>RouteOrder</code> ä¸º <code>0</code> çš„è·¯ç”±ä¹‹åã€‚ ï¼ˆæœ¬ç¤ºä¾‹å‡å®šæ²¡æœ‰å®¢æˆ·åä¸º <code>details</code> æˆ– <code>pending</code> çš„å®¢æˆ·ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œåº”è¯¥é¿å…ä¸æ˜ç¡®çš„è·¯ç”±ã€‚åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œæ›´é€‚åˆ <code>GetByCustomer</code> çš„è·¯ç”±æ¨¡æ¿æ˜¯ <code>customers/&#123;customerName&#125;</code> ï¼‰</p>
</blockquote>
<blockquote>
<p>å‚è€ƒï¼š<br></p>
<ul>
<li>Wiki - <code>REST</code>ï¼š<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E8%A1%A8%E7%8E%B0%E5%B1%82%E7%8A%B6%E6%80%81%E8%BD%AC%E6%8D%A2">https://zh.wikipedia.org/wiki/è¡¨ç°å±‚çŠ¶æ€è½¬æ¢</a><br></li>
<li>MSDN - <code>ASP.NET Web API</code>ï¼š<a target="_blank" rel="noopener" href="https://docs.microsoft.com/zh-cn/aspnet/web-api/">https://docs.microsoft.com/zh-cn/aspnet/web-api/</a></li>
</ul>
</blockquote>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://hd2y.github.io/soa-asp-dot-net-web-api-knowledge-points/" data-id="cklsrxrx000en04pid4dkcgcp" data-title="SOA â€”â€” ASP.NET Web API çŸ¥è¯†ç‚¹å°ç»“" class="article-share-link">åˆ†äº«</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SOA/" rel="tag">SOA</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/WebApi/" rel="tag">WebApi</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-191125-soa-wcf-knowlege-points" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/soa-wcf-knowlege-points/" class="article-date">
  <time class="dt-published" datetime="2019-11-25T12:01:11.000Z" itemprop="datePublished">2019-11-25</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%BC%80%E5%8F%91/">å¼€å‘</a>â–º<a class="article-category-link" href="/categories/%E5%BC%80%E5%8F%91/C/">C#</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/soa-wcf-knowlege-points/">SOA â€”â€” WCF çŸ¥è¯†ç‚¹å°ç»“</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p><code>WCF</code> ç›¸è¾ƒäº <code>WebService</code> æ›´åŠ çµæ´»ï¼Œæ”¯æŒå¤šç§å®¿ä¸»ã€å¤šç§åè®®ï¼Œå¹¶ä¸”æ”¯æŒåŒå·¥ã€‚</p>
<p>å°è±¡ä¸­è¯»ä¹¦æ—¶ä¹Ÿå¼€è¿‡ <code>WCF</code> çš„è¯¾ç¨‹ï¼Œä½†æ˜¯é‚£æœ¬è®² <code>WCF</code> çš„ä¹¦å®åœ¨æ˜¯å¤ªåšäº†ï¼Œæ‰€ä»¥å…¶å®å¹¶æ²¡æœ‰å­¦è¿›å»ï¼Œæ··ä¸ªå­¦åˆ†åæ¥ä¸äº†äº†ä¹‹ã€‚</p>
<p>å·¥ä½œä¸­ï¼Œä½¿ç”¨æ›´å¤šçš„æ˜¯ <code>WebService</code> æˆ–è€… <code>Socket</code>ï¼Œæ‰€ä»¥ä»…å‡­å¶å°”æ¥è§¦çš„ä¸€äº›å°ä¾‹å­ï¼Œæ¥æ€»ç»“ä¸€äº›ç®€å•çš„ä½¿ç”¨åœºæ™¯ã€‚</p>
<h2 id="åˆ›å»ºæœåŠ¡ç«¯"><a href="#åˆ›å»ºæœåŠ¡ç«¯" class="headerlink" title="åˆ›å»ºæœåŠ¡ç«¯"></a>åˆ›å»ºæœåŠ¡ç«¯</h2><p>ä¸åŒäº <code>WebService</code> åªèƒ½æ‰˜ç®¡åœ¨ <code>IIS</code> ä¸Šï¼Œ<code>WCF</code> å¯ä»¥æ‰˜ç®¡åœ¨ä»»æ„çš„ç¨‹åºä¸Šï¼Œå¯ä»¥æ˜¯ç½‘ç«™ï¼Œä¹Ÿå¯ä»¥æ˜¯æ§åˆ¶å°ã€<code>WinForm</code>ã€<code>WPF</code>ã€<code>Windows Service</code> ç­‰ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼š<code>Visual Studio 2019</code> å®‰è£…æ—¶é»˜è®¤æ²¡æœ‰å‹¾é€‰ <code>WPF</code> çš„æ¨¡æ¿ï¼Œå¯ä»¥é€šè¿‡ <code>Visual Studio Installer</code> å®‰è£…ï¼Œç‚¹å‡» <code>ä¿®æ”¹</code> -&gt; <code>å•ä¸ªç»„ä»¶</code> -&gt; <code>å¼€å‘æ´»åŠ¨</code> -&gt; <code>Windows Communication Foundation</code>ã€‚<br><br><img src="https://hd2y.oss-cn-beijing.aliyuncs.com/20191121183654_1574682911278.png" alt="20191121183654"></p>
</blockquote>
<h3 id="å®šä¹‰å¹¶å®ç°æœåŠ¡åå®š"><a href="#å®šä¹‰å¹¶å®ç°æœåŠ¡åå®š" class="headerlink" title="å®šä¹‰å¹¶å®ç°æœåŠ¡åå®š"></a>å®šä¹‰å¹¶å®ç°æœåŠ¡åå®š</h3><p><code>WCF</code> åˆ›å»ºæœåŠ¡ç«¯ç¬¬ä¸€æ­¥æ˜¯åˆ›å»ºä¸€ä¸ªæœåŠ¡åå®šï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å¾ˆæ–¹ä¾¿çš„å°†æœåŠ¡ä¸å®¿ä¸»åˆ†ç¦»ã€‚</p>
<p>åæœŸåˆ›å»ºæœåŠ¡ç«¯æ—¶ï¼Œå¯ä»¥æŒ‡å®šæœåŠ¡è¿è¡Œåœ¨ä¸åŒçš„å®¿ä¸»ä¸Šï¼Œè€Œä¸éœ€è¦è°ƒæ•´æœåŠ¡æœ¬èº«çš„ä»£ç ï¼Œè¿™é‡Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ª <code>WCF æœåŠ¡åº“</code>ã€‚</p>
<p><img src="https://hd2y.oss-cn-beijing.aliyuncs.com/20191121184555_1574682911275.png" alt="20191121184555"></p>
<p>åˆ›å»ºå®Œæˆä»¥åå®Œå–„ä¸€ä¸‹æœåŠ¡åå®šä¸­çš„ä»£ç ï¼Œéœ€è¦åœ¨æ¥å£ä¸­æŒ‡å®šæ–¹æ³•ï¼Œç„¶åå†å®ç°ã€‚</p>
<p><code>IMyService.cs</code> æ–‡ä»¶ï¼š</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> System.Linq;</span><br><span class="line"><span class="keyword">using</span> System.Runtime.Serialization;</span><br><span class="line"><span class="keyword">using</span> System.ServiceModel;</span><br><span class="line"><span class="keyword">using</span> System.Text;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">JohnSun.SOA.WCF.Service</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// æ³¨æ„: ä½¿ç”¨â€œé‡æ„â€èœå•ä¸Šçš„â€œé‡å‘½åâ€å‘½ä»¤ï¼Œå¯ä»¥åŒæ—¶æ›´æ”¹ä»£ç å’Œé…ç½®æ–‡ä»¶ä¸­çš„æ¥å£åâ€œIService1â€ã€‚</span></span><br><span class="line">    [<span class="meta">ServiceContract</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">IMyService</span></span><br><span class="line">    &#123;</span><br><span class="line">        [<span class="meta">OperationContract</span>]</span><br><span class="line">        <span class="function"><span class="built_in">string</span> <span class="title">GetData</span>(<span class="params"><span class="built_in">int</span> <span class="keyword">value</span></span>)</span>;</span><br><span class="line"></span><br><span class="line">        [<span class="meta">OperationContract</span>]</span><br><span class="line">        <span class="function">CompositeType <span class="title">GetDataUsingDataContract</span>(<span class="params">CompositeType composite</span>)</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// <span class="doctag">TODO:</span> åœ¨æ­¤æ·»åŠ æ‚¨çš„æœåŠ¡æ“ä½œ</span></span><br><span class="line"></span><br><span class="line">        [<span class="meta">OperationContract</span>]</span><br><span class="line">        <span class="function"><span class="built_in">decimal</span> <span class="title">Sum</span>(<span class="params"><span class="built_in">decimal</span> x, <span class="built_in">decimal</span> y</span>)</span>;</span><br><span class="line"></span><br><span class="line">        [<span class="meta">OperationContract</span>]</span><br><span class="line">        <span class="function">UserInfo <span class="title">GetUser</span>(<span class="params"><span class="built_in">int</span> id</span>)</span>;</span><br><span class="line"></span><br><span class="line">        [<span class="meta">OperationContract</span>]</span><br><span class="line">        <span class="function">UserInfo[] <span class="title">GetUsers</span>(<span class="params"><span class="built_in">string</span> country</span>)</span>;</span><br><span class="line"></span><br><span class="line">        [<span class="meta">OperationContract</span>]</span><br><span class="line">        <span class="function">List&lt;UserInfo&gt; <span class="title">GetAllUsers</span>(<span class="params"></span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>MyService.cs</code> æ–‡ä»¶ï¼š</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> System.Linq;</span><br><span class="line"><span class="keyword">using</span> System.Runtime.Serialization;</span><br><span class="line"><span class="keyword">using</span> System.ServiceModel;</span><br><span class="line"><span class="keyword">using</span> System.Text;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">JohnSun.SOA.WCF.Service</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// æ³¨æ„: ä½¿ç”¨â€œé‡æ„â€èœå•ä¸Šçš„â€œé‡å‘½åâ€å‘½ä»¤ï¼Œå¯ä»¥åŒæ—¶æ›´æ”¹ä»£ç å’Œé…ç½®æ–‡ä»¶ä¸­çš„ç±»åâ€œService1â€ã€‚</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MyService</span> : <span class="title">IMyService</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="title">List</span>&lt;<span class="title">UserInfo</span>&gt; _users</span> = <span class="keyword">new</span> List&lt;UserInfo&gt;()</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">new</span> UserInfo()&#123; Id = <span class="number">1</span>, Name = <span class="string">&quot;Kangkang&quot;</span>, Country = <span class="string">&quot;China&quot;</span> &#125;,</span><br><span class="line">            <span class="keyword">new</span> UserInfo()&#123; Id = <span class="number">2</span>, Name = <span class="string">&quot;John&quot;</span>, Country = <span class="string">&quot;America&quot;</span> &#125;,</span><br><span class="line">            <span class="keyword">new</span> UserInfo()&#123; Id = <span class="number">3</span>, Name = <span class="string">&quot;Jane&quot;</span>, Country = <span class="string">&quot;France&quot;</span> &#125;,</span><br><span class="line">            <span class="keyword">new</span> UserInfo()&#123; Id = <span class="number">4</span>, Name = <span class="string">&quot;Han Meimei&quot;</span>, Country = <span class="string">&quot;China&quot;</span> &#125;,</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> List&lt;UserInfo&gt; <span class="title">GetAllUsers</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">return</span> _users;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="built_in">string</span> <span class="title">GetData</span>(<span class="params"><span class="built_in">int</span> <span class="keyword">value</span></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">string</span>.Format(<span class="string">&quot;You entered: &#123;0&#125;&quot;</span>, <span class="keyword">value</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> CompositeType <span class="title">GetDataUsingDataContract</span>(<span class="params">CompositeType composite</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">if</span> (composite == <span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> ArgumentNullException(<span class="string">&quot;composite&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (composite.BoolValue)</span><br><span class="line">            &#123;</span><br><span class="line">                composite.StringValue += <span class="string">&quot;Suffix&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> composite;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> UserInfo <span class="title">GetUser</span>(<span class="params"><span class="built_in">int</span> id</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">return</span> _users.Find(u =&gt; u.Id == id);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> UserInfo[] <span class="title">GetUsers</span>(<span class="params"><span class="built_in">string</span> country</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">return</span> _users.FindAll(u =&gt; u.Country == country).ToArray();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="built_in">decimal</span> <span class="title">Sum</span>(<span class="params"><span class="built_in">decimal</span> x, <span class="built_in">decimal</span> y</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">return</span> x + y;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="ä½¿ç”¨å®¿ä¸»è¿è¡ŒæœåŠ¡ç«¯"><a href="#ä½¿ç”¨å®¿ä¸»è¿è¡ŒæœåŠ¡ç«¯" class="headerlink" title="ä½¿ç”¨å®¿ä¸»è¿è¡ŒæœåŠ¡ç«¯"></a>ä½¿ç”¨å®¿ä¸»è¿è¡ŒæœåŠ¡ç«¯</h3><p><code>WCF</code> çš„æœåŠ¡åå®šåˆ›å»ºå¥½ä»¥åï¼Œå°±å¯ä»¥ä½¿ç”¨æ§åˆ¶å°æˆ–çª—ä½“ç¨‹åºç­‰å°†è¯¥æœåŠ¡æ‰˜ç®¡å¹¶è¿è¡Œèµ·æ¥ã€‚</p>
<p>è¿™é‡Œä»¥æ§åˆ¶å°ä¸ºä¾‹ï¼Œåˆ›å»ºä¸€ä¸ªæ§åˆ¶å°åº”ç”¨ç¨‹åºï¼Œå¹¶æ·»åŠ ä»¥ä¸‹ä»£ç ï¼š</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ServiceHost selfHost = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// å®šä¹‰æœåŠ¡è¿è¡Œçš„ URL å¹¶å®ä¾‹åŒ–æœåŠ¡ä¸»æœº</span></span><br><span class="line">        Uri baseAddress = <span class="keyword">new</span> Uri(<span class="string">&quot;http://localhost:7895/MyService/&quot;</span>);</span><br><span class="line">        selfHost = <span class="keyword">new</span> ServiceHost(<span class="keyword">typeof</span>(MyService), baseAddress);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æŒ‡å®šæœåŠ¡åå®š</span></span><br><span class="line">        selfHost.AddServiceEndpoint(<span class="keyword">typeof</span>(IMyService), <span class="keyword">new</span> WSHttpBinding(), <span class="string">&quot;MyService&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æŒ‡å®šæœåŠ¡å¯ä»¥ä½¿ç”¨ HTTP è®¿é—®</span></span><br><span class="line">        ServiceMetadataBehavior smb = <span class="keyword">new</span> ServiceMetadataBehavior</span><br><span class="line">        &#123;</span><br><span class="line">            HttpGetEnabled = <span class="literal">true</span>,</span><br><span class="line">        &#125;;</span><br><span class="line">        selfHost.Description.Behaviors.Add(smb);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¼€å¯æœåŠ¡</span></span><br><span class="line">        selfHost.Open();</span><br><span class="line">        Log(LogLevel.Info, <span class="string">&quot;æœåŠ¡å¼€å¯æˆåŠŸï¼Œä½ å¯ä»¥ç‚¹å‡» &lt;Enter&gt; ç»ˆæ­¢æœåŠ¡ã€‚&quot;</span>);</span><br><span class="line"></span><br><span class="line">        Console.ReadLine();</span><br><span class="line">        selfHost.Close();</span><br><span class="line">    &#125;</span><br><span class="line">    catch (CommunicationException ce)</span><br><span class="line">    &#123;</span><br><span class="line">        Log(LogLevel.Error, <span class="string">$&quot;å¼€å¯æœåŠ¡å¤±è´¥ <span class="subst">&#123;ce.Message&#125;</span>&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (selfHost != <span class="literal">null</span>)</span><br><span class="line">            selfHost.Abort();</span><br><span class="line">        Console.ReadKey();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>æ³¨æ„ï¼šæœåŠ¡ç«¯å¦‚æœéœ€è¦è¿è¡Œï¼Œéœ€è¦ä½¿ç”¨ç®¡ç†å‘˜èº«ä»½ï¼Œå¦åˆ™å¯èƒ½å‡ºç°ä¸‹å›¾é”™è¯¯ï¼Œå¯ä»¥ä½¿ç”¨ç®¡ç†å‘˜èº«ä»½è¿è¡Œ <code>Visual Studio</code>ï¼Œæˆ–è€…åˆ° <code>bin</code> ç›®å½•ä¸‹å³é”®å¯æ‰§è¡Œç¨‹åºï¼Œä½¿ç”¨å³é”®èœå•ä¸­çš„ <code>ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œ</code>ã€‚<br><br><img src="https://hd2y.oss-cn-beijing.aliyuncs.com/20191121200816_1574682911257.png" alt="20191121200816"></p>
</blockquote>
<p>æˆåŠŸè¿è¡Œï¼Œæ§åˆ¶å°è¾“å‡ºå¦‚ä¸‹ï¼š</p>
<p><img src="https://hd2y.oss-cn-beijing.aliyuncs.com/20191121200840_1574682914394.png" alt="20191121200840"></p>
<p>æˆ‘ä»¬å¯ä»¥åœ¨æµè§ˆå™¨ä¸­è®¿é—®è®¾ç½®çš„é“¾æ¥ï¼š</p>
<p><img src="https://hd2y.oss-cn-beijing.aliyuncs.com/20191122143734_1574682914400.png" alt="20191122143734"></p>
<h2 id="æ–°å»ºå®¢æˆ·ç«¯è°ƒç”¨æœåŠ¡"><a href="#æ–°å»ºå®¢æˆ·ç«¯è°ƒç”¨æœåŠ¡" class="headerlink" title="æ–°å»ºå®¢æˆ·ç«¯è°ƒç”¨æœåŠ¡"></a>æ–°å»ºå®¢æˆ·ç«¯è°ƒç”¨æœåŠ¡</h2><p>æœåŠ¡ç«¯åˆ›å»ºå®Œæˆä»¥åï¼Œå°±å¯ä»¥åˆ›å»ºä¸€ä¸ªå®¢æˆ·ç«¯è¿æ¥æœåŠ¡ï¼Œæ‰§è¡Œç®€å•çš„è°ƒç”¨ã€‚</p>
<p>é¦–å…ˆåˆ›å»ºä¸€ä¸ªæ§åˆ¶å°åº”ç”¨ç¨‹åºç”¨äºæ¼”ç¤ºï¼Œå’Œ <code>WebService</code> ä¸€æ ·ï¼Œç›´æ¥åœ¨ <code>å¼•ç”¨</code> ä¸Šå³é”®æ·»åŠ  <code>æœåŠ¡å¼•ç”¨</code> å³å¯ã€‚</p>
<p>å¼•ç”¨å®Œæˆä»¥åï¼Œä¼šç”Ÿæˆä¸€ä¸ªé…ç½®æ–‡ä»¶ <code>app.config</code> ï¼Œé‡Œé¢è®°å½•ç€è¿æ¥æœåŠ¡ç«¯çš„é…ç½®ä¿¡æ¯ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">system.serviceModel</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bindings</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">wsHttpBinding</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">binding</span> <span class="attr">name</span>=<span class="string">&quot;WSHttpBinding_IMyService&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">wsHttpBinding</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">bindings</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">client</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">endpoint</span> <span class="attr">address</span>=<span class="string">&quot;http://localhost:7895/MyService/&quot;</span> <span class="attr">binding</span>=<span class="string">&quot;wsHttpBinding&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">bindingConfiguration</span>=<span class="string">&quot;WSHttpBinding_IMyService&quot;</span> <span class="attr">contract</span>=<span class="string">&quot;MyWcfService.IMyService&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">name</span>=<span class="string">&quot;WSHttpBinding_IMyService&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">identity</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">userPrincipalName</span> <span class="attr">value</span>=<span class="string">&quot;DESKTOP-V2RPVP4\hd2y&quot;</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">identity</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">endpoint</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">client</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">system.serviceModel</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>ä¿®æ”¹æ§åˆ¶å°çš„ <code>Program.cs</code> æ–‡ä»¶è¿›è¡Œè°ƒç”¨ï¼š</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">MyServiceClient client = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">try</span></span><br><span class="line">&#123;</span><br><span class="line">    client = <span class="keyword">new</span> MyServiceClient();</span><br><span class="line">    <span class="built_in">decimal</span> x = <span class="number">1</span>m;</span><br><span class="line">    <span class="built_in">decimal</span> y = <span class="number">2</span>m;</span><br><span class="line">    <span class="built_in">decimal</span> d = client.Sum(x, y);</span><br><span class="line">    Log(LogLevel.Info, <span class="string">$&quot;è°ƒç”¨ Sum æ–¹æ³•æˆåŠŸï¼šSum(<span class="subst">&#123;x&#125;</span>, <span class="subst">&#123;y&#125;</span>) = <span class="subst">&#123;d&#125;</span>&quot;</span>);</span><br><span class="line">    <span class="built_in">int</span> id = <span class="number">1</span>;</span><br><span class="line">    UserInfo info = client.GetUser(id);</span><br><span class="line">    JavaScriptSerializer serializer = <span class="keyword">new</span> JavaScriptSerializer();</span><br><span class="line">    Log(LogLevel.Info, <span class="string">$&quot;è°ƒç”¨ GetUserInfo æ–¹æ³•æˆåŠŸï¼šGetUserInfo(<span class="subst">&#123;id&#125;</span>) = <span class="subst">&#123;serializer.Serialize(info)&#125;</span>&quot;</span>);</span><br><span class="line">    <span class="built_in">string</span> country = <span class="string">&quot;China&quot;</span>;</span><br><span class="line">    UserInfo[] users = client.GetUsers(country);</span><br><span class="line">    Log(LogLevel.Info, <span class="string">$&quot;è°ƒç”¨ GetUsers æ–¹æ³•æˆåŠŸï¼šGetUsers(<span class="subst">&#123;country&#125;</span>) è·å–åˆ°ç”¨æˆ·æ•°é‡ï¼š <span class="subst">&#123;users.Length&#125;</span>&quot;</span>);</span><br><span class="line">    UserInfo[] allUsers = client.GetAllUsers();</span><br><span class="line">    Log(LogLevel.Info, <span class="string">$&quot;è°ƒç”¨ GetAllUsers æ–¹æ³•æˆåŠŸï¼Œè·å–åˆ°ç”¨æˆ·æ•°é‡ï¼š <span class="subst">&#123;allUsers.Length&#125;</span>&quot;</span>);</span><br><span class="line">    client.Close();</span><br><span class="line">&#125;</span><br><span class="line">catch (Exception exc)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (client != <span class="literal">null</span>)</span><br><span class="line">        client.Abort();</span><br><span class="line">    Log(LogLevel.Error, <span class="string">&quot;æµ‹è¯•æœåŠ¡å¤±è´¥ï¼š&quot;</span> + exc.Message);</span><br><span class="line">&#125;</span><br><span class="line">Console.ReadKey();</span><br></pre></td></tr></table></figure>
<p>æ³¨æ„ï¼ŒåŒ <code>WebService</code> ä¸€æ ·ï¼Œè¿æ¥çš„é‡Šæ”¾ä¸èƒ½ä¾æ‰˜äº <code>using</code> å—ã€‚</p>
<h3 id="è‡ªå®šä¹‰è¿æ¥"><a href="#è‡ªå®šä¹‰è¿æ¥" class="headerlink" title="è‡ªå®šä¹‰è¿æ¥"></a>è‡ªå®šä¹‰è¿æ¥</h3><p>å¦‚æœä¸æƒ³é€šè¿‡è‡ªåŠ¨ç”Ÿæˆçš„æœåŠ¡é…ç½®è¿æ¥æœåŠ¡ï¼Œå¯ä»¥è°ƒæ•´å®¢æˆ·ç«¯åˆå§‹åŒ–ä¸ºä»¥ä¸‹ä»£ç ï¼š</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">client = <span class="keyword">new</span> MyServiceClient(<span class="keyword">new</span> WSHttpBinding(), <span class="keyword">new</span> EndpointAddress(<span class="string">&quot;http://localhost:7895/MyService/&quot;</span>));</span><br></pre></td></tr></table></figure>
<p>è¿è¡Œçš„ç»“æœå’Œé…ç½®æ–‡ä»¶å¼åˆå§‹åŒ–çš„æ‰§è¡Œç»“æœä¸€è‡´ï¼š</p>
<p><img src="https://hd2y.oss-cn-beijing.aliyuncs.com/20191125141355_1574682914395.png" alt="20191125141355"></p>
<h2 id="WCF-è¿›é˜¶"><a href="#WCF-è¿›é˜¶" class="headerlink" title="WCF è¿›é˜¶"></a>WCF è¿›é˜¶</h2><p>ä»¥ä¸Šåªæ˜¯ç±»ä¼¼ <code>WebService</code> æœåŠ¡çš„åˆ›å»ºä¸è°ƒç”¨ï¼Œè¿˜ä¸èƒ½ä½“ç° WCF çš„ä¼˜è¶Šæ€§ï¼Œä¸‹é¢ä¸€äº›ç®€å•çš„ä¾‹å­å°†å±•ç¤º WCF çš„é…ç½®ï¼Œå°† WCF æœåŠ¡æ‰¿è½½äº TCP ä¸Šã€‚å¹¶ä¸”æ¼”ç¤º WCF çš„åŒå·¥å¦‚ä½•ä½¿ç”¨ã€‚</p>
<h3 id="é€šè¿‡é…ç½®æ–‡ä»¶è®¾å®šæœåŠ¡"><a href="#é€šè¿‡é…ç½®æ–‡ä»¶è®¾å®šæœåŠ¡" class="headerlink" title="é€šè¿‡é…ç½®æ–‡ä»¶è®¾å®šæœåŠ¡"></a>é€šè¿‡é…ç½®æ–‡ä»¶è®¾å®šæœåŠ¡</h3><p>é™¤äº†ç›´æ¥åœ¨ä»£ç ä¸­é…ç½®æ‰˜ç®¡æœåŠ¡å¤–ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶æ¥è¿›è¡Œè®¾å®šï¼Œé…ç½®ä¿¡æ¯å¯ä»¥å‚è€ƒ <a target="_blank" rel="noopener" href="https://docs.microsoft.com/zh-cn/dotnet/framework/configure-apps/file-schema/wcf/media/index/windows-communication-foundation-configuration-schema.gif">WCF é…ç½®æ¶æ„</a>ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€ä¸ª <a target="_blank" rel="noopener" href="https://docs.microsoft.com/zh-cn/dotnet/framework/wcf/simplified-configuration">ç®€åŒ–é…ç½®</a> ï¼Œæ¥é…ç½®æˆ‘ä»¬çš„å®¢æˆ·ç«¯ï¼Œä»¥ä¸‹æ˜¯æœåŠ¡ç«¯æ§åˆ¶å° <code>App.config</code> çš„æ–‡ä»¶å†…å®¹ã€‚</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">system.serviceModel</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">behaviors</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">serviceBehaviors</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">behavior</span> <span class="attr">name</span>=<span class="string">&quot;MyWcfServiceBehavior&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">serviceMetadata</span> <span class="attr">httpGetEnabled</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">serviceDebug</span> <span class="attr">includeExceptionDetailInFaults</span>=<span class="string">&quot;false&quot;</span> <span class="attr">httpHelpPageEnabled</span>=<span class="string">&quot;false&quot;</span> /&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">serviceTimeouts</span> <span class="attr">transactionTimeout</span>=<span class="string">&quot;00:10:00&quot;</span> /&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">serviceThrottling</span> <span class="attr">maxConcurrentCalls</span>=<span class="string">&quot;1000&quot;</span> <span class="attr">maxConcurrentInstances</span>=<span class="string">&quot;1000&quot;</span> <span class="attr">maxConcurrentSessions</span>=<span class="string">&quot;1000&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">behavior</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">serviceBehaviors</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">behaviors</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">bindings</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">basicHttpBinding</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">binding</span> <span class="attr">name</span>=<span class="string">&quot;MyBindingConfig&quot;</span> <span class="attr">maxBufferSize</span>=<span class="string">&quot;1024&quot;</span> <span class="attr">maxReceivedMessageSize</span>=<span class="string">&quot;1024&quot;</span> <span class="attr">closeTimeout</span>=<span class="string">&quot;00:01:00&quot;</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- Default binding for basicHttpBinding --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">binding</span> <span class="attr">closeTimeout</span>=<span class="string">&quot;00:03:00&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">basicHttpBinding</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bindings</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">services</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">service</span> <span class="attr">behaviorConfiguration</span>=<span class="string">&quot;MyWcfServiceBehavior&quot;</span> <span class="attr">name</span>=<span class="string">&quot;JohnSun.SOA.WCF.Service.MyService&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">host</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">baseAddresses</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">add</span> <span class="attr">baseAddress</span>=<span class="string">&quot;http://localhost:7895/MyService/&quot;</span> /&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">baseAddresses</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">host</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">endpoint</span> <span class="attr">address</span>=<span class="string">&quot;&quot;</span> <span class="attr">binding</span>=<span class="string">&quot;basicHttpBinding&quot;</span> <span class="attr">contract</span>=<span class="string">&quot;JohnSun.SOA.WCF.Service.IMyService&quot;</span> <span class="attr">bindingConfiguration</span>=<span class="string">&quot;MyBindingConfig&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">service</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">services</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">system.serviceModel</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>é…ç½®å®Œæˆåå°±å¯ä»¥é€šè¿‡é‡æ–°ç”Ÿæˆå¹¶ç”±å®¢æˆ·ç«¯è°ƒç”¨ï¼Œæ³¨æ„ä¹‹å‰ç»‘å®šçš„åè®®ä¸º <code>wsHttpBinding</code>ï¼Œé…ç½®æ–‡ä»¶é…ç½®çš„ä¸º <code>basicHttpBinding</code>ï¼Œæ‰€ä»¥å®¢æˆ·ç«¯éœ€è¦ <code>æ›´æ–°æœåŠ¡å¼•ç”¨</code>ã€‚</p>
<blockquote>
<p>éœ€è¦è°ƒæ•´ä¸º <code>wsHttpBinding</code> ä¹Ÿå¾ˆç®€å•ï¼Œåªéœ€è¦ <code>bindings</code> èŠ‚ç‚¹ä¸‹çš„ <code>basicHttpBinding</code> èŠ‚ç‚¹ä»¥åŠ <code>endpoint</code> ä¸­çš„ <code>binding</code> å±æ€§ä¿®æ”¹ä¸º <code>wsHttpBinding</code> å³å¯ã€‚</p>
</blockquote>
<p>æ›´æ–°åæ‰§è¡Œæ•ˆæœå¦‚ä¸‹å›¾ï¼š</p>
<p><img src="https://hd2y.oss-cn-beijing.aliyuncs.com/20191125145927_1574682917957.png" alt="20191125145927"></p>
<h3 id="ä½¿ç”¨-TCP-åè®®"><a href="#ä½¿ç”¨-TCP-åè®®" class="headerlink" title="ä½¿ç”¨ TCP åè®®"></a>ä½¿ç”¨ TCP åè®®</h3><p>WCF é™¤æ”¯æŒ HTTP åè®®å¤–è¿˜æ”¯æŒå¤šç§åè®®ï¼Œä¾‹å¦‚ï¼šTCPã€MSMQã€å‘½åç®¡é“ç­‰ã€‚</p>
<p>è¿™é‡Œä»…æ¼”ç¤º TCP åè®®ï¼Œé¦–å…ˆéœ€è¦ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œè°ƒæ•´ <code>serviceBehaviors</code> ä¸­çš„ <code>serviceMetadata</code> æŒ‡å®š <code>httpGetEnabled</code> å¿…é¡»ä¸º <code>false</code>ã€‚</p>
<p>ç„¶åæˆ‘ä»¬ä¿®æ”¹é…ç½®æ–‡ä»¶ä¸­çš„ <code>bindings</code> èŠ‚ç‚¹ï¼Œå°†ä¹‹å‰çš„ <code>basicHttpBinding</code> æˆ– <code>wsHttpBinding</code> ä¿®æ”¹ä¸ºï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">netTcpBinding</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">binding</span> <span class="attr">name</span>=<span class="string">&quot;MyBindingConfig&quot;</span> <span class="attr">closeTimeout</span>=<span class="string">&quot;00:01:00&quot;</span> &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">security</span> <span class="attr">mode</span>=<span class="string">&quot;None&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">transport</span> <span class="attr">clientCredentialType</span>=<span class="string">&quot;None&quot;</span> <span class="attr">protectionLevel</span>=<span class="string">&quot;None&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">security</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">binding</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">netTcpBinding</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>è°ƒæ•´ <code>baseAddresses</code> èŠ‚ç‚¹ä¸‹ç»‘å®šçš„é“¾æ¥ï¼Œå°† <code>http</code> åè®®ä¿®æ”¹ä¸º <code>net.tcp</code> åè®®ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">add</span> <span class="attr">baseAddress</span>=<span class="string">&quot;net.tcp://localhost:7895/MyService/&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p>æœ€åè°ƒæ•´ <code>endpoint</code> ä¸­çš„ <code>binding</code> å±æ€§å³å¯ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">endpoint</span> <span class="attr">address</span>=<span class="string">&quot;&quot;</span> <span class="attr">binding</span>=<span class="string">&quot;netTcpBinding&quot;</span> <span class="attr">contract</span>=<span class="string">&quot;JohnSun.SOA.WCF.Service.IMyService&quot;</span> <span class="attr">bindingConfiguration</span>=<span class="string">&quot;MyBindingConfig&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p>è°ƒæ•´å®Œæˆåé‡æ–°ç”Ÿæˆå³å¯è¿è¡ŒæœåŠ¡ï¼Œæˆ‘ä»¬å¯ä»¥è°ƒæ•´ä»¥ä¸‹å®¢æˆ·ç«¯çš„æœåŠ¡å¼•ç”¨ï¼Œå¯ä»¥å³é”®å¯¹åº”çš„æœåŠ¡ï¼Œé€‰æ‹© <code>é…ç½®æœåŠ¡å¼•ç”¨</code>ï¼Œä¿®æ”¹æœåŠ¡åœ°å€ï¼Œä¿®æ”¹ä¸º <code>net.tcp</code> åè®®ã€‚</p>
<p>å½“ç„¶ä¹‹å‰æˆ‘ä»¬å·²ç»åˆ é™¤äº†é…ç½®æ–‡ä»¶ï¼Œæ‰€ä»¥è¿™é‡Œç›´æ¥ä¿®æ”¹æœåŠ¡ç«¯çš„åˆå§‹åŒ–ä»£ç ï¼š</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">client = <span class="keyword">new</span> MyServiceClient(<span class="keyword">new</span> NetTcpBinding(securityMode: SecurityMode.None), <span class="keyword">new</span> EndpointAddress(<span class="string">&quot;net.tcp://localhost:7895/MyService/&quot;</span>));</span><br></pre></td></tr></table></figure>
<p>å¦‚æœè°ƒç”¨æœåŠ¡æŠ¥é”™ï¼Œå¯ä»¥æ·»åŠ æœåŠ¡å¼•ç”¨ï¼Œè¿™æ—¶å¯èƒ½å‡ºç°å¦‚ä¸‹å›¾çš„é”™è¯¯ï¼š</p>
<p><img src="https://hd2y.oss-cn-beijing.aliyuncs.com/20191125154836_1574682920862.png" alt="20191125154836"></p>
<p>æ— æ³•è¯†åˆ«è¯¥ URI å‰ç¼€ã€‚</p>
<p>ç½‘ä¸Šæœç´¢äº†å¾ˆå¤šè§£å†³æ–¹æ¡ˆï¼ŒåŒ…æ‹¬ <code>å¯ç”¨æˆ–å…³é—­ Windows åŠŸèƒ½</code> ä¸­æœ‰å…³ <code>WCF</code> çš„é€‰é¡¹ï¼Œä»¥åŠ <code>æœåŠ¡</code> ä¸­ <code>Net.Tcp Listener Adapter</code> æ˜¯å¦å¯åŠ¨ï¼Œå‡æ­£å¸¸ã€‚</p>
<p><img src="https://hd2y.oss-cn-beijing.aliyuncs.com/20191125154522_1574682917957.png" alt="20191125154522"></p>
<p>ç„¶åè°ƒæ•´å¢åŠ  <code>mexTcpBinding</code> èŠ‚ç‚¹ï¼Œä»ç„¶æ— æ³•è°ƒç”¨ï¼ˆæ­¤å¤„å¿…é¡»é…ç½®ï¼‰ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">endpoint</span> <span class="attr">address</span>=<span class="string">&quot;mex&quot;</span> <span class="attr">binding</span>=<span class="string">&quot;mexTcpBinding&quot;</span> <span class="attr">bindingConfiguration</span>=<span class="string">&quot;&quot;</span> <span class="attr">contract</span>=<span class="string">&quot;IMetadataExchange&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p>åçœ‹åˆ°ä¸€ç¯‡æ–‡ç« å‘ç°å¯èƒ½æ˜¯åºåˆ—åŒ–é—®é¢˜ï¼Œä¹‹å‰æˆ‘ä»¬å¢åŠ çš„ç±»å‹ <code>UserInfo</code> ï¼Œå‡æœªé…ç½® <code>DataContract</code> å’Œ <code>DataMember</code> ç‰¹æ€§ï¼Œå¢åŠ å¯¹åº”ç‰¹æ€§åï¼Œé‡æ–°ç”Ÿæˆå¹¶è¿è¡ŒæœåŠ¡ç«¯ï¼Œå®¢æˆ·ç«¯å¯ä»¥æ­£å¸¸æ·»åŠ æœåŠ¡å¼•ç”¨ã€‚</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">DataContract</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">UserInfo</span></span><br><span class="line">&#123;</span><br><span class="line">    [<span class="meta">DataMember</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> Id &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    [<span class="meta">DataMember</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> Name &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    [<span class="meta">DataMember</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> Country &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä½†æ˜¯ï¼Œåœ¨å¯ä»¥æ­£å¸¸æ·»åŠ ä»¥åï¼Œç§»é™¤å¯¹åº”ç‰¹æ€§ï¼Œé‡æ–°ç¼–è¯‘ï¼Œæ— æ³•å†é‡ç°è¿™ä¸ªé—®é¢˜ï¼Œæ‰€ä»¥å»ºè®®æ˜¯æ·»åŠ è¯¥ç‰¹æ€§ï¼Œå¹¶æŒ‰ç…§ä»¥ä¸Šå†…å®¹æ£€æŸ¥æ‰€æœ‰ä¿¡æ¯ï¼Œé¿å…å‡ºç°è¿™ä¸ªé—®é¢˜ã€‚</p>
<p><img src="https://hd2y.oss-cn-beijing.aliyuncs.com/20191125165644_1574682920861.png" alt="20191125165644"></p>
<h3 id="ä½¿ç”¨åŒå·¥"><a href="#ä½¿ç”¨åŒå·¥" class="headerlink" title="ä½¿ç”¨åŒå·¥"></a>ä½¿ç”¨åŒå·¥</h3><p>å› ä¸º <code>WebService</code> æ˜¯åŸºäº <code>HTTPåè®®</code>ï¼Œå…¶æ˜¯æ— çŠ¶æ€çš„ï¼Œæ‰€ä»¥æ— æ³•ä½¿ç”¨åŒå·¥ï¼Œä½†æ˜¯ <code>WCF</code> è¿˜æ”¯æŒæœ‰çŠ¶æ€çš„ <code>TCP</code> åè®®ï¼Œæ‰€ä»¥å¯ä»¥å®ç°åŒå·¥é€šè®¯ã€‚</p>
<p>WCF ä¸­åŒå·¥çš„è®¾è®¡æ˜¯é€šè¿‡å›è°ƒæ¥å®ç°ï¼š</p>
<ul>
<li>å®šä¹‰ä¸€ä¸ªç”¨äºå›è°ƒçš„æ¥å£ <code>ICallback</code>ï¼Œä¾›å®¢æˆ·ç«¯å®ç°ï¼›</li>
<li>æ·»åŠ æœåŠ¡åå®š <code>ICallbackService</code> ï¼ŒæŒ‡å®šç”¨äºå›è°ƒçš„åå®š <code>ICallback</code>ï¼›</li>
<li>å®ç°æœåŠ¡åå®šï¼Œå¯ä»¥é€šè¿‡æœåŠ¡ä¸Šä¸‹æ–‡è·å–å›è°ƒçš„é€šé“å¹¶è°ƒç”¨ï¼›</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> System.Linq;</span><br><span class="line"><span class="keyword">using</span> System.ServiceModel;</span><br><span class="line"><span class="keyword">using</span> System.Text;</span><br><span class="line"><span class="keyword">using</span> System.Threading;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">JohnSun.SOA.WCF.Service</span></span><br><span class="line">&#123;</span><br><span class="line">    [<span class="meta">ServiceContract(CallbackContract = typeof(ICallback))</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">ICallbackService</span></span><br><span class="line">    &#123;</span><br><span class="line">        [<span class="meta">OperationContract(IsOneWay = true)</span>]</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">TestConnect</span>(<span class="params"><span class="built_in">string</span> message</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> ä¸éœ€è¦åè®®ï¼Œæ˜¯ä¸€ä¸ªçº¦æŸç”±å®¢æˆ·ç«¯å®ç°</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">ICallback</span></span><br><span class="line">    &#123;</span><br><span class="line">        [<span class="meta">OperationContract(IsOneWay = true)</span>]</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">Reply</span>(<span class="params"><span class="built_in">string</span> message</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">CallbackService</span> : <span class="title">ICallbackService</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">TestConnect</span>(<span class="params"><span class="built_in">string</span> message</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            Logger.Log(LogLevel.Info, message);</span><br><span class="line">            Thread.Sleep(<span class="number">2000</span>);</span><br><span class="line">            ICallback callback = OperationContext.Current.GetCallbackChannel&lt;ICallback&gt;();</span><br><span class="line">            callback.Reply(message);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Logger</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Log</span>(<span class="params">LogLevel level, <span class="built_in">string</span> message</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            Console.ForegroundColor = ConsoleColor.Yellow;</span><br><span class="line">            Console.Write(<span class="string">$&quot;<span class="subst">&#123;DateTime.Now:HH:mm:ss&#125;</span> &quot;</span>);</span><br><span class="line">            Console.ForegroundColor = level == LogLevel.Info ? ConsoleColor.White : ConsoleColor.Red;</span><br><span class="line">            Console.Write(<span class="string">$&quot;<span class="subst">&#123;level,<span class="number">5</span>&#125;</span>: &quot;</span>);</span><br><span class="line">            Console.ForegroundColor = ConsoleColor.Gray;</span><br><span class="line">            Console.Write(<span class="string">$&quot;<span class="subst">&#123;message&#125;</span>\r\n&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    [<span class="meta">Flags</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">enum</span> LogLevel</span><br><span class="line">    &#123;</span><br><span class="line">        Info = <span class="number">1</span>,</span><br><span class="line">        Error = <span class="number">2</span>,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·æœåŠ¡åå®šæˆ‘ä»¬å°±åˆ›å»ºå¥½äº†ï¼Œç„¶åå°±æ˜¯ä¿®æ”¹æœåŠ¡æ‰˜ç®¡çš„ä»£ç ï¼š</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">ServiceHost host = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">try</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// å®šä¹‰æœåŠ¡è¿è¡Œçš„ URL å¹¶å®ä¾‹åŒ–æœåŠ¡ä¸»æœº</span></span><br><span class="line">    Uri baseAddress = <span class="keyword">new</span> Uri(<span class="string">&quot;net.tcp://localhost:7895/MyDuplexService/&quot;</span>);</span><br><span class="line">    host = <span class="keyword">new</span> ServiceHost(<span class="keyword">typeof</span>(CallbackService), baseAddress);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æŒ‡å®šæœåŠ¡åå®š</span></span><br><span class="line">    host.AddServiceEndpoint(<span class="keyword">typeof</span>(ICallbackService), <span class="keyword">new</span> NetTcpBinding(securityMode: SecurityMode.None), <span class="string">&quot;CallbackService&quot;</span>);</span><br><span class="line">    <span class="comment">// ä¸æŒ‡å®šå®¢æˆ·ç«¯å°†æ— æ³•æ·»åŠ æœåŠ¡å¼•ç”¨</span></span><br><span class="line">    host.Description.Behaviors.Add(<span class="keyword">new</span> ServiceMetadataBehavior());</span><br><span class="line">    host.AddServiceEndpoint(<span class="keyword">typeof</span>(IMetadataExchange), MetadataExchangeBindings.CreateMexTcpBinding(), <span class="string">&quot;mex&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¼€å¯æœåŠ¡</span></span><br><span class="line">    host.Open();</span><br><span class="line">    Log(LogLevel.Info, <span class="string">&quot;æœåŠ¡å¼€å¯æˆåŠŸï¼Œä½ å¯ä»¥ç‚¹å‡» &lt;Enter&gt; ç»ˆæ­¢æœåŠ¡ã€‚&quot;</span>);</span><br><span class="line"></span><br><span class="line">    Console.ReadLine();</span><br><span class="line">    host.Close();</span><br><span class="line">&#125;</span><br><span class="line">catch (Exception exc)</span><br><span class="line">&#123;</span><br><span class="line">    Log(LogLevel.Error, <span class="string">$&quot;å¼€å¯æœåŠ¡å¤±è´¥ <span class="subst">&#123;exc.Message&#125;</span> <span class="subst">&#123;exc.StackTrace&#125;</span>&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (host != <span class="literal">null</span>)</span><br><span class="line">        host.Abort();</span><br><span class="line">    Console.ReadKey();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¹‹åæˆ‘ä»¬å°±å¯ä»¥åœ¨å®¢æˆ·ç«¯æ·»åŠ ä¸€ä¸ªæ–°çš„æœåŠ¡å¼•ç”¨ <code>MyDuplexWcfService</code>ï¼Œåˆå§‹åŒ–æœåŠ¡è¿æ¥å¹¶è°ƒç”¨æœåŠ¡ä¸­å®šä¹‰çš„æ–¹æ³•ï¼š</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">CallbackServiceClient client = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">try</span></span><br><span class="line">&#123;</span><br><span class="line">    InstanceContext callbackInstance = <span class="keyword">new</span> InstanceContext(<span class="keyword">new</span> Callback());</span><br><span class="line">    client = <span class="keyword">new</span> CallbackServiceClient(callbackInstance);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">string</span> message = <span class="string">$&quot;<span class="subst">&#123;i:<span class="number">00</span>&#125;</span> <span class="subst">&#123;DateTime.Now:HH:mm:ss.fff&#125;</span>&quot;</span>;</span><br><span class="line">        client.TestConnect(message);</span><br><span class="line">        Log(LogLevel.Info, <span class="string">$&quot;è°ƒç”¨ TestConnect æ–¹æ³•æˆåŠŸï¼š<span class="subst">&#123;message&#125;</span>&quot;</span>);</span><br><span class="line">        Thread.Sleep(<span class="number">50</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    Console.WriteLine(<span class="string">&quot;æœåŠ¡è°ƒç”¨æˆåŠŸï¼Œä½ å¯ä»¥ç‚¹å‡» &lt;Enter&gt; å…³é—­å®¢æˆ·ç«¯ã€‚&quot;</span>);</span><br><span class="line">    Console.ReadLine();</span><br><span class="line">    client.Close();</span><br><span class="line">&#125;</span><br><span class="line">catch (Exception exc)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (client != <span class="literal">null</span>)</span><br><span class="line">        client.Abort();</span><br><span class="line">    Log(LogLevel.Error, <span class="string">&quot;æµ‹è¯•æœåŠ¡å¤±è´¥ï¼š&quot;</span> + exc.Message);</span><br><span class="line">    Console.ReadLine();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¸¦æœ‰å›è°ƒçš„æœåŠ¡ï¼Œéœ€è¦åˆå§‹åŒ–ä¸€ä¸ª<code>InstanceContext</code>ï¼Œæ„é€ å‡½æ•°ä¼ é€’çš„æ˜¯ä¸€ä¸ªå›è°ƒç±»å‹ <code>ICallback</code> çš„å®ç°ç±»å‹çš„å®ä¾‹åŒ–å¯¹è±¡ã€‚</p>
<p>æˆ‘ä»¬å¼•ç”¨çš„æœåŠ¡æœ‰ä¸€ä¸ª <code>ICallbackServiceCallback</code> ç±»å‹ï¼Œè¿™ä¸ªå…¶å®å°±æ˜¯ <code>ICallback</code>ï¼Œéœ€è¦æ·»åŠ å®ç°ï¼š</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Callback</span> : <span class="title">ICallbackServiceCallback</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Reply</span>(<span class="params"><span class="built_in">string</span> message</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        Program.Log(LogLevel.Info, <span class="string">$&quot;å›è°ƒï¼š<span class="subst">&#123;message&#125;</span>&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å®ç°ä»¥åçš„å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯æ‰§è¡Œæ•ˆæœå¦‚ä¸‹ï¼š</p>
<p><img src="https://hd2y.oss-cn-beijing.aliyuncs.com/20191125192728_1574682920861.png" alt="20191125192728"></p>
<p>åŒæ ·çš„é’ˆå¯¹æœåŠ¡ç«¯ä¸å®¢æˆ·ç«¯è°ƒæ•´å®ç°æ–¹å¼ï¼Œä»¥ä¸ŠæœåŠ¡ç«¯å±•ç¤ºçš„æ˜¯ä½¿ç”¨ä»£ç å®ç°çš„æ‰˜ç®¡ï¼Œä¸‹é¢å¢åŠ ä¸€ä¸ªä½¿ç”¨é…ç½®æ–‡ä»¶æ¥è¿›è¡Œæ‰˜ç®¡çš„æ–¹æ¡ˆï¼Œé¦–å…ˆåœ¨é…ç½®æ–‡ä»¶çš„ <code>services</code> èŠ‚ç‚¹å†…å¢åŠ ä»¥ä¸‹å†…å®¹ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">service</span> <span class="attr">behaviorConfiguration</span>=<span class="string">&quot;MyWcfServiceBehavior&quot;</span> <span class="attr">name</span>=<span class="string">&quot;JohnSun.SOA.WCF.Service.CallbackService&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">host</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">baseAddresses</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">add</span> <span class="attr">baseAddress</span>=<span class="string">&quot;net.tcp://localhost:7895/MyDuplexService/&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">baseAddresses</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">host</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">endpoint</span> <span class="attr">address</span>=<span class="string">&quot;&quot;</span> <span class="attr">binding</span>=<span class="string">&quot;netTcpBinding&quot;</span> <span class="attr">contract</span>=<span class="string">&quot;JohnSun.SOA.WCF.Service.ICallbackService&quot;</span> <span class="attr">bindingConfiguration</span>=<span class="string">&quot;MyBindingConfig&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">endpoint</span> <span class="attr">address</span>=<span class="string">&quot;mex&quot;</span> <span class="attr">binding</span>=<span class="string">&quot;mexTcpBinding&quot;</span> <span class="attr">bindingConfiguration</span>=<span class="string">&quot;&quot;</span> <span class="attr">contract</span>=<span class="string">&quot;IMetadataExchange&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">service</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>ç„¶åæœåŠ¡å¼€å¯çš„ä»£ç å¯ä»¥è°ƒæ•´ä¸ºä»¥ä¸‹å†…å®¹ï¼š</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">ServiceHost host = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">try</span></span><br><span class="line">&#123;</span><br><span class="line">    host = <span class="keyword">new</span> ServiceHost(<span class="keyword">typeof</span>(CallbackService));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¼€å¯æœåŠ¡</span></span><br><span class="line">    host.Open();</span><br><span class="line">    Log(LogLevel.Info, <span class="string">&quot;æœåŠ¡å¼€å¯æˆåŠŸï¼Œä½ å¯ä»¥ç‚¹å‡» &lt;Enter&gt; ç»ˆæ­¢æœåŠ¡ã€‚&quot;</span>);</span><br><span class="line"></span><br><span class="line">    Console.ReadLine();</span><br><span class="line">    host.Close();</span><br><span class="line">&#125;</span><br><span class="line">catch (Exception exc)</span><br><span class="line">&#123;</span><br><span class="line">    Log(LogLevel.Error, <span class="string">$&quot;å¼€å¯æœåŠ¡å¤±è´¥ <span class="subst">&#123;exc.Message&#125;</span> <span class="subst">&#123;exc.StackTrace&#125;</span>&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (host != <span class="literal">null</span>)</span><br><span class="line">        host.Abort();</span><br><span class="line">    Console.ReadKey();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æœåŠ¡è°ƒæ•´å¥½ä»¥åï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦æ›´æ–°ä¸€ä¸‹å®¢æˆ·ç«¯çš„æœåŠ¡å¼•ç”¨æ‰èƒ½ä½¿ç”¨ï¼Œå› ä¸ºä»¥ä¸Šé…ç½®æ–‡ä»¶æŒ‡å®šä¸ä»£ç å®ç°çš„å¹¶ä¸å®Œå…¨ä¸€è‡´ã€‚</p>
<p>å®¢æˆ·ç«¯ç›®å‰ä½¿ç”¨çš„æ˜¯é…ç½®æ–‡ä»¶åˆå§‹åŒ–ï¼ŒåŒæ ·çš„æˆ‘ä»¬å¯ä»¥åˆ é™¤å®¢æˆ·ç«¯ä¸‹çš„ <code>App.config</code> æ–‡ä»¶ï¼Œå®¢æˆ·ç«¯å®ä¾‹åŒ–ä¿®æ”¹ä¸ºä»¥ä¸‹ä»£ç ï¼š</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">client = <span class="keyword">new</span> CallbackServiceClient(callbackInstance, <span class="keyword">new</span> NetTcpBinding(securityMode: SecurityMode.None), <span class="keyword">new</span> EndpointAddress(<span class="string">&quot;net.tcp://localhost:7895/MyDuplexService/&quot;</span>));</span><br></pre></td></tr></table></figure>
<h2 id="åè®°"><a href="#åè®°" class="headerlink" title="åè®°"></a>åè®°</h2><p>WCF çš„çŸ¥è¯†ç‚¹æ¯”è¾ƒå¤šï¼Œè¿™é‡Œä»…ä»…æ˜¯ç®€å•çš„å®ç°ä¸ä½¿ç”¨ï¼Œæ›´å¤šçš„å†…å®¹å»ºè®®è¿˜æ˜¯æŸ¥çœ‹ MSDN æ–‡æ¡£ã€‚</p>
<p>åŸºæœ¬ä»¥ä¸Šå†…å®¹å­¦ä¹ ä»¥åï¼Œå·¥ä½œä¸­ä¸€äº›å¸¸è§çš„åœºæ™¯éƒ½å¯ä»¥å®ç°ï¼Œèº«ä»½è®¤è¯å»ºè®®ä½¿ç”¨ Token ä¼šç®€å•ä¸€äº›ï¼Œå¦‚æœæœ‰å…´è¶£å¯ä»¥ç ”ç©¶ä¸€ä¸‹ <code>x509è¯ä¹¦</code>ã€‚</p>
<blockquote>
<p>å‚è€ƒï¼š<br></p>
<ul>
<li>MSDN - <code>åˆ©ç”¨ WCF å¼€å‘é¢å‘æœåŠ¡çš„åº”ç”¨ç¨‹åº</code>ï¼š<a target="_blank" rel="noopener" href="https://docs.microsoft.com/zh-cn/dotnet/framework/wcf/">https://docs.microsoft.com/zh-cn/dotnet/framework/wcf/</a><br></li>
<li>MSDN - <code>WCF é…ç½®æ¶æ„</code>ï¼š<a target="_blank" rel="noopener" href="https://docs.microsoft.com/zh-cn/dotnet/framework/configure-apps/file-schema/wcf/">https://docs.microsoft.com/zh-cn/dotnet/framework/configure-apps/file-schema/wcf/</a><br></li>
<li>Wiki - <code>é›™å·¥</code>ï¼š<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/zh-hans/%E9%9B%99%E5%B7%A5">https://zh.wikipedia.org/zh-hans/%E9%9B%99%E5%B7%A5</a><br></li>
</ul>
</blockquote>
<blockquote>
<p>æºç ä¸‹è½½ï¼š<br></p>
<ul>
<li>Gitï¼š<a target="_blank" rel="noopener" href="https://git.hd2y.net/hd2y/JohnSun.SOA.WCF.git">https://git.hd2y.net/hd2y/JohnSun.SOA.WCF.git</a><br></li>
<li>ç™¾åº¦ç½‘ç›˜ï¼š<a target="_blank" rel="noopener" href="https://pan.baidu.com/s/1QXsDYxWehCGgVupgpmgvpQ">https://pan.baidu.com/s/1QXsDYxWehCGgVupgpmgvpQ</a> æå–ç ï¼š<code>crbu</code><br></li>
</ul>
</blockquote>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://hd2y.github.io/soa-wcf-knowlege-points/" data-id="cklsrxrwy00ek04pibjo68gnd" data-title="SOA â€”â€” WCF çŸ¥è¯†ç‚¹å°ç»“" class="article-share-link">åˆ†äº«</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SOA/" rel="tag">SOA</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/WCF/" rel="tag">WCF</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-191121-soa-web-service-knowledge-summary" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/soa-web-service-knowledge-summary/" class="article-date">
  <time class="dt-published" datetime="2019-11-21T09:28:29.000Z" itemprop="datePublished">2019-11-21</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%BC%80%E5%8F%91/">å¼€å‘</a>â–º<a class="article-category-link" href="/categories/%E5%BC%80%E5%8F%91/C/">C#</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/soa-web-service-knowledge-summary/">SOA â€”â€” WebService çŸ¥è¯†ç‚¹æ€»ç»“</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>è™½ç„¶ <code>WebService</code> å·²ç»å¾ˆ <code>Low</code> äº†ï¼Œä½†æ˜¯èƒœåœ¨ç®€å•ã€‚æ‰€ä»¥å¾ˆå¤šå°å…¬å¸æˆ–è€…å…¬å¸å†…éƒ¨ä»ç„¶ä¼šä½¿ç”¨è¿™ä¸ªåšä¸€äº›æ¥å£ã€‚</p>
<p>è¿™é‡Œæ€»ç»“ä¸€ä¸‹ <code>WebService</code> çš„ä¸€äº›ä½¿ç”¨æŠ€å·§ï¼Œä»¥åŠç»éªŒæ€»ç»“ã€‚</p>
<h2 id="åˆ›å»ºæœåŠ¡ç«¯"><a href="#åˆ›å»ºæœåŠ¡ç«¯" class="headerlink" title="åˆ›å»ºæœåŠ¡ç«¯"></a>åˆ›å»ºæœåŠ¡ç«¯</h2><p><code>WebService</code> å®¿ä¸»æ˜¯ <code>IIS</code>ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å…ˆåˆ›å»ºä¸€ä¸ª <code>ASP.Net Web</code> çš„ç©ºé¡¹ç›®ï¼Œå½“ç„¶å¦‚æœé€‰æ‹© <code>MVC</code> æˆ– <code>WebForm</code> ä¹Ÿæ²¡æœ‰å½±å“ã€‚</p>
<p><img src="https://hd2y.oss-cn-beijing.aliyuncs.com/20191120110944_1574327411385.png" alt="20191120110944"></p>
<p>åˆ›å»ºä»¥åæˆ‘ä»¬å°±å¯ä»¥æ·»åŠ å¯¹åº”çš„æœåŠ¡æ–‡ä»¶ï¼Œå¦‚ä¸‹å›¾ï¼š</p>
<p><img src="https://hd2y.oss-cn-beijing.aliyuncs.com/20191120111531_1574327411395.png" alt="20191120111531"></p>
<p>ä¼šç”Ÿæˆä¸€ä¸ª <code>*.asmx</code> æ–‡ä»¶ä¸ ä¸€ä¸ª <code>*.asmx.cs</code> æ–‡ä»¶ï¼Œç»“æ„ä¸ <code>WebForm</code> çš„çª—ä½“é¡µé¢æˆ–ä¸€èˆ¬å¤„ç†ç¨‹åºç­‰ä¸€è‡´ã€‚</p>
<p>å¦‚æœæˆ‘ä»¬æ²¡æœ‰å°†åå°ä»£ç  <code>cs</code> æ–‡ä»¶å¦å¤–å•ç‹¬å­˜æ”¾çš„éœ€æ±‚ï¼Œé‚£ä¹ˆå°±ä¸éœ€è¦è°ƒæ•´ï¼Œç›´æ¥ä¿®æ”¹å±•å¼€å¯¹ <code>cs</code> æ–‡ä»¶è¿›è¡Œä¿®æ”¹å³å¯ã€‚</p>
<p>è¿™é‡Œæˆ‘ä»¬æ·»åŠ ä¸€äº›æ–¹æ³•ç”¨äºæµ‹è¯•ï¼š</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> System.Linq;</span><br><span class="line"><span class="keyword">using</span> System.Web;</span><br><span class="line"><span class="keyword">using</span> System.Web.Services;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">JohnSun.SOA.WebService.Server</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> MyWebService çš„æ‘˜è¦è¯´æ˜</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    [<span class="meta">WebService(Namespace = <span class="meta-string">&quot;http://tempuri.org/&quot;</span>)</span>]</span><br><span class="line">    [<span class="meta">WebServiceBinding(ConformsTo = WsiProfiles.BasicProfile1_1)</span>]</span><br><span class="line">    [<span class="meta">System.ComponentModel.ToolboxItem(false)</span>]</span><br><span class="line">    <span class="comment">// è‹¥è¦å…è®¸ä½¿ç”¨ ASP.NET AJAX ä»è„šæœ¬ä¸­è°ƒç”¨æ­¤ Web æœåŠ¡ï¼Œè¯·å–æ¶ˆæ³¨é‡Šä»¥ä¸‹è¡Œã€‚ </span></span><br><span class="line">    <span class="comment">// [System.Web.Script.Services.ScriptService]</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MyWebService</span> : <span class="title">System.Web.Services.WebService</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="title">List</span>&lt;<span class="title">UserInfo</span>&gt; _users</span> = <span class="keyword">new</span> List&lt;UserInfo&gt;()</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">new</span> UserInfo()&#123; Id = <span class="number">1</span>, Name = <span class="string">&quot;Kangkang&quot;</span>, Country = <span class="string">&quot;China&quot;</span> &#125;,</span><br><span class="line">            <span class="keyword">new</span> UserInfo()&#123; Id = <span class="number">2</span>, Name = <span class="string">&quot;John&quot;</span>, Country = <span class="string">&quot;America&quot;</span> &#125;,</span><br><span class="line">            <span class="keyword">new</span> UserInfo()&#123; Id = <span class="number">3</span>, Name = <span class="string">&quot;Jane&quot;</span>, Country = <span class="string">&quot;France&quot;</span> &#125;,</span><br><span class="line">            <span class="keyword">new</span> UserInfo()&#123; Id = <span class="number">4</span>, Name = <span class="string">&quot;Han Meimei&quot;</span>, Country = <span class="string">&quot;China&quot;</span> &#125;,</span><br><span class="line">        &#125;;</span><br><span class="line">        [<span class="meta">WebMethod</span>]</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="built_in">string</span> <span class="title">HelloWorld</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Hello World&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        [<span class="meta">WebMethod</span>]</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="built_in">decimal</span> <span class="title">Sum</span>(<span class="params"><span class="built_in">decimal</span> x, <span class="built_in">decimal</span> y</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">return</span> x + y;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        [<span class="meta">WebMethod</span>]</span><br><span class="line">        <span class="function"><span class="keyword">public</span> UserInfo <span class="title">GetUserInfo</span>(<span class="params"><span class="built_in">int</span> id</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">return</span> _users.Find(u =&gt; u.Id == id);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        [<span class="meta">WebMethod</span>]</span><br><span class="line">        <span class="function"><span class="keyword">public</span> List&lt;UserInfo&gt; <span class="title">GetUsers</span>(<span class="params"><span class="built_in">string</span> country</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">return</span> _users.FindAll(u =&gt; u.Country == country);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        [<span class="meta">WebMethod</span>]</span><br><span class="line">        <span class="function"><span class="keyword">public</span> UserInfo[] <span class="title">GetAllUsers</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">return</span> _users.ToArray();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">UserInfo</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">int</span> Id &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">string</span> Name &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">string</span> Country &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼š</p>
<ul>
<li>å¦‚æœæˆ‘ä»¬éœ€è¦è°ƒç”¨ä¸€ä¸ªæ–¹æ³•ï¼Œåˆ™éœ€è¦å°†æ–¹æ³•æ ‡è®°ä¸º <code>WebMethod</code> ç‰¹æ€§ï¼Œæ‰èƒ½è°ƒç”¨ã€‚</li>
<li>è¿™é‡Œä¸éµå¾ªé‡è½½ï¼Œæ‰€ä»¥æ–¹æ³•åä¸èƒ½é‡å¤ï¼Œå³ä¾¿å…¥å‚ä¸åŒä¹Ÿä¸è¡Œã€‚</li>
<li>å…¥å‚å’Œè¿”å›å€¼éƒ½å¯ä»¥æ˜¯æ•°ç»„æˆ–é›†åˆï¼Œä½†æ˜¯è°ƒç”¨æœåŠ¡æ—¶ï¼Œå¯ä»¥é…ç½®ï¼Œè¿™é‡Œå†è°ƒç”¨æ—¶ä¼šè¯´æ˜ã€‚</li>
</ul>
<p>å®Œæˆåï¼Œæˆ‘ä»¬å°±å¯ä»¥å³é”®è¯¥æ–‡ä»¶ï¼Œåœ¨æµè§ˆå™¨æ‰“å¼€è®¿é—®è¯¥æœåŠ¡ã€‚</p>
<p><img src="https://hd2y.oss-cn-beijing.aliyuncs.com/20191120114307_1574327414494.png" alt="20191120114307"></p>
<p>å¦å¤–ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨æµè§ˆå™¨é‡Œç›´æ¥è°ƒç”¨æœåŠ¡ã€‚</p>
<p><img src="https://hd2y.oss-cn-beijing.aliyuncs.com/20191120114405_1574327414490.png" alt="20191120114405"></p>
<h2 id="è¿æ¥æœåŠ¡ç«¯"><a href="#è¿æ¥æœåŠ¡ç«¯" class="headerlink" title="è¿æ¥æœåŠ¡ç«¯"></a>è¿æ¥æœåŠ¡ç«¯</h2><p>æœåŠ¡ç«¯æ‰˜ç®¡å®Œæˆä»¥åï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨å®¢æˆ·ç«¯å®Œæˆå¯¹æœåŠ¡ç«¯çš„è°ƒç”¨äº†ï¼Œå®¢æˆ·ç«¯çš„é¡¹ç›®æ²¡æœ‰ä»€ä¹ˆé™åˆ¶ï¼Œä½†æ˜¯å»ºè®®æ˜¯ä½¿ç”¨ <code>.NET Framework 4.0</code> æˆ–ä»¥ä¸Šç‰ˆæœ¬ï¼Œå¦åˆ™æ·»åŠ æœåŠ¡çš„ç•Œé¢å¯èƒ½ä¼šä¸æˆªå›¾æ¼”ç¤ºçš„æœ‰äº›è®¸åŒºåˆ«ã€‚</p>
<p>è¿™é‡Œä¸ºäº†æ–¹ä¾¿æ¼”ç¤ºï¼Œç›´æ¥æ·»åŠ ä¸€ä¸ª <code>WinForm</code> çš„é¡¹ç›®ï¼Œç„¶åå¯ä»¥åœ¨å¼•ç”¨ä¸­ï¼Œé€‰æ‹©æ·»åŠ æœåŠ¡å¼•ç”¨ï¼š</p>
<p><img src="https://hd2y.oss-cn-beijing.aliyuncs.com/20191120115420_1574327414496.png" alt="20191120115420"></p>
<p>åœ¨å¼¹å‡ºçš„æ·»åŠ é¡µé¢ï¼Œå½•å…¥æˆ‘ä»¬çš„æœåŠ¡åœ°å€ï¼Œç‚¹å‡»å‘ç°ï¼Œæ·»åŠ æˆ‘ä»¬éœ€è¦çš„æœåŠ¡ï¼Œå¦å¤–æˆ‘ä»¬éœ€è¦è°ƒæ•´è¿™ä¸ªæœåŠ¡çš„å‘½åæ§ä»¶ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ä¸è¦ä¸å…¶ä»–å‘½åæ§ä»¶æˆ–ç±»å‹é‡åï¼Œå¦åˆ™ä¼šæ¯”è¾ƒéº»çƒ¦ï¼š</p>
<p><img src="https://hd2y.oss-cn-beijing.aliyuncs.com/20191120115726_1574327417649.png" alt="20191120115726"></p>
<p>æœåŠ¡åˆ›å»ºåï¼Œåœ¨çª—ä½“ä¸­ç®€å•å†™ä¸€äº›è°ƒç”¨æœåŠ¡çš„ä»£ç è¿›è¡Œæµ‹è¯•ï¼š</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">button1_Click</span>(<span class="params"><span class="built_in">object</span> sender, EventArgs e</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    MyWebServiceSoapClient client = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">try</span></span><br><span class="line">    &#123;</span><br><span class="line">        client = <span class="keyword">new</span> MyWebServiceSoapClient();</span><br><span class="line">        client.Open();</span><br><span class="line">        <span class="built_in">string</span> h = client.HelloWorld();</span><br><span class="line">        Log(LogLevel.Info, <span class="string">$&quot;è°ƒç”¨ HelloWorld æ–¹æ³•æˆåŠŸï¼š<span class="subst">&#123;h&#125;</span>&quot;</span>);</span><br><span class="line">        <span class="built_in">decimal</span> x = <span class="number">1</span>m;</span><br><span class="line">        <span class="built_in">decimal</span> y = <span class="number">2</span>m;</span><br><span class="line">        <span class="built_in">decimal</span> d = client.Sum(x, y);</span><br><span class="line">        Log(LogLevel.Info, <span class="string">$&quot;è°ƒç”¨ Sum æ–¹æ³•æˆåŠŸï¼šSum(<span class="subst">&#123;x&#125;</span>, <span class="subst">&#123;y&#125;</span>) = <span class="subst">&#123;d&#125;</span>&quot;</span>);</span><br><span class="line">        <span class="built_in">int</span> id = <span class="number">1</span>;</span><br><span class="line">        UserInfo info = client.GetUserInfo(id);</span><br><span class="line">        JavaScriptSerializer serializer = <span class="keyword">new</span> JavaScriptSerializer();</span><br><span class="line">        Log(LogLevel.Info, <span class="string">$&quot;è°ƒç”¨ GetUserInfo æ–¹æ³•æˆåŠŸï¼šGetUserInfo(<span class="subst">&#123;id&#125;</span>) = <span class="subst">&#123;serializer.Serialize(info)&#125;</span>&quot;</span>);</span><br><span class="line">        <span class="built_in">string</span> country = <span class="string">&quot;China&quot;</span>;</span><br><span class="line">        UserInfo[] users = client.GetUsers(country);</span><br><span class="line">        Log(LogLevel.Info, <span class="string">$&quot;è°ƒç”¨ GetUsers æ–¹æ³•æˆåŠŸï¼šGetUsers(<span class="subst">&#123;country&#125;</span>) è·å–åˆ°ç”¨æˆ·æ•°é‡ï¼š <span class="subst">&#123;users.Length&#125;</span>&quot;</span>);</span><br><span class="line">        UserInfo[] allUsers = client.GetAllUsers();</span><br><span class="line">        Log(LogLevel.Info, <span class="string">$&quot;è°ƒç”¨ GetAllUsers æ–¹æ³•æˆåŠŸï¼Œè·å–åˆ°ç”¨æˆ·æ•°é‡ï¼š <span class="subst">&#123;allUsers.Length&#125;</span>&quot;</span>);</span><br><span class="line">        client.Close();</span><br><span class="line">    &#125;</span><br><span class="line">    catch (Exception exc)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (client != <span class="literal">null</span>)</span><br><span class="line">            client.Abort();</span><br><span class="line">        Log(LogLevel.Error, <span class="string">&quot;æµ‹è¯•æœåŠ¡å¤±è´¥ï¼š&quot;</span> + exc.Message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æµ‹è¯•ä¸€ä¸‹è°ƒç”¨ï¼š</p>
<p><img src="https://hd2y.oss-cn-beijing.aliyuncs.com/20191120162309_1574327417642.png" alt="20191120162309"></p>
<p>è¿™é‡Œä¸»è¦éœ€è¦æ³¨æ„ä¸¤ç‚¹ï¼š</p>
<ol>
<li><code>MyWebServiceSoapClient</code> å¹¶æœªç»§æ‰¿ <code>IDisposable</code> æ¥å£ï¼Œæ‰€ä»¥ä¸èƒ½ä½¿ç”¨ <code>using</code> æ¥å…³é—­è¿æ¥ï¼Œä½¿ç”¨ä¸Šæ–‡çš„å†™æ³•å³å¯ï¼Œå¦åˆ™èµ„æºé‡Šæ”¾å­˜åœ¨é—®é¢˜ã€‚</li>
<li>æ— è®ºè¿”å›å€¼æ˜¯é›†åˆè¿˜æ˜¯æ•°ç»„ï¼Œæˆ‘ä»¬åªèƒ½ä½¿ç”¨ä¸€ç§ç±»å‹ï¼ŒæœåŠ¡åˆ›å»ºä»¥åæˆ‘ä»¬ä¹Ÿå¯ä»¥æŒ‡å®šï¼Œå¦‚ä¸Šè™½ç„¶æˆ‘ä»¬ <code>GetUsers</code> åœ¨æœåŠ¡ä¸­å®šä¹‰è¿”å›é›†åˆï¼Œä½†æ˜¯è°ƒç”¨æ—¶è¿”å›çš„ä»ç„¶æ˜¯æ•°ç»„ã€‚</li>
</ol>
<p>å¦‚æœæˆ‘ä»¬æƒ³è®©æœåŠ¡é»˜è®¤è¿”å›çš„æ•°æ®ç±»å‹è°ƒæ•´ä¸ºé›†åˆï¼Œå¯ä»¥åœ¨å¼•ç”¨çš„æœåŠ¡ä¸Šå³é”®ï¼Œé€‰æ‹©â€œé…ç½®æœåŠ¡å¼•ç”¨â€ï¼Œå°†é›†åˆç±»å‹è°ƒæ•´ä¸º <code>System.Collections.Generic.List</code>ï¼ŒåŒæ ·çš„å­—å…¸ç±»å‹ä¹Ÿå¯ä»¥è°ƒæ•´ã€‚</p>
<p><img src="https://hd2y.oss-cn-beijing.aliyuncs.com/20191120194502_1574327417655.png" alt="20191120194502"></p>
<h2 id="æ·»åŠ èº«ä»½è®¤è¯"><a href="#æ·»åŠ èº«ä»½è®¤è¯" class="headerlink" title="æ·»åŠ èº«ä»½è®¤è¯"></a>æ·»åŠ èº«ä»½è®¤è¯</h2><p>ä»¥ä¸ŠæœåŠ¡æ–¹æ³•éƒ½æ²¡æœ‰è¿›è¡Œèº«ä»½è®¤è¯ï¼Œå¦‚æœä¸€äº›ç§æœ‰çš„æ–¹æ³•ï¼Œå°±ä¼šæœ‰å®‰å…¨é—®é¢˜ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨æœåŠ¡ä¸­é…ç½®ç®€å•èº«ä»½è®¤è¯ã€‚</p>
<p>æ¯”è¾ƒå¸¸ç”¨çš„æ˜¯ä½¿ç”¨ <code>SoapHeader</code> ä¸ºæœåŠ¡æ–¹æ³•ï¼Œæ·»åŠ  <code>SOAP æ ‡å¤´</code>ï¼Œè¿™æ ·æˆ‘ä»¬åœ¨è°ƒç”¨æœåŠ¡æ—¶å°±éœ€è¦ä¼ å…¥ä¸€ä¸ªæ ‡å¤´ä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ä¸ªä¿¡æ¯æ¥ä¼ é€’ç”¨äºç”¨æˆ·éªŒè¯çš„ä¿¡æ¯ã€‚</p>
<p>é¦–å…ˆéœ€è¦è°ƒæ•´ <code>WebService</code> æœåŠ¡ç«¯çš„ä»£ç ï¼Œå®šä¹‰ä¸€ä¸ªç»§æ‰¿è‡ª <code>SoapHeader</code> çš„ç±»å‹ <code>AuthenticationHeader</code>ï¼š</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">AuthenticationHeader</span> : <span class="title">SoapHeader</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> UserName &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> Password &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> Token &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Validate</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">if</span> (UserName == <span class="string">&quot;admin&quot;</span> &amp;&amp; Password == <span class="string">&quot;admin&quot;</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            MD5 md5 = MD5.Create();</span><br><span class="line">            Token = Convert.ToBase64String(md5.ComputeHash(Encoding.UTF8.GetBytes(Password)));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> SoapException(<span class="string">&quot;Failed to verify user login information.&quot;</span>, SoapException.ServerFaultCode);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¿®æ”¹æœåŠ¡åå°ç±»ï¼Œå¢åŠ ä¸€ä¸ªç”¨äºæ¥æ”¶ <code>SoapHeader</code> çš„å­—æ®µï¼Œä¸ºéœ€è¦é™„åŠ æ ‡å¤´çš„æ–¹æ³•æ ‡è®° <code>SoapHeader</code> ç‰¹æ€§ï¼Œå¹¶æŒ‡å®š <code>SOAP æ ‡å¤´</code> çš„æ•°æ®èµ‹å€¼ç»™æœåŠ¡åå°ç±»çš„å“ªä¸ªå­—æ®µï¼š</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> AuthenticationHeader authenticationHeader;</span><br><span class="line"></span><br><span class="line">[<span class="meta">WebMethod</span>]</span><br><span class="line">[<span class="meta">SoapHeader(<span class="meta-string">&quot;authenticationHeader&quot;</span>)</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="built_in">string</span> <span class="title">Validate</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (authenticationHeader != <span class="literal">null</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        authenticationHeader.Validate();</span><br><span class="line">        <span class="keyword">return</span> authenticationHeader.Token;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[<span class="meta">WebMethod</span>]</span><br><span class="line">[<span class="meta">SoapHeader(<span class="meta-string">&quot;authenticationHeader&quot;</span>, Direction = SoapHeaderDirection.InOut)</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> UserInfo[] <span class="title">GetAllUsers</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (authenticationHeader != <span class="literal">null</span>)</span><br><span class="line">        authenticationHeader.Validate();</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">return</span> _users.ToArray();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¿®æ”¹å®Œæˆä»¥åéœ€è¦é‡æ–°ç¼–è¯‘è¿™ä¸ªæœåŠ¡ï¼Œå¹¶ä¸”åœ¨å®¢æˆ·ç«¯æ›´æ–°æœåŠ¡å¼•ç”¨ï¼Œæ›´æ–°å®Œæˆä»¥å <code>GetAllUsers</code> æ–¹æ³•åº”è¯¥ä¼šæŠ¥é”™ï¼Œå› ä¸ºéœ€è¦æˆ‘ä»¬ä¼ é€’ä¸€ä¸ª <code>AuthenticationHeader</code>ï¼Œå¯ä»¥å°†å®¢æˆ·ç«¯è°ƒç”¨æœåŠ¡æ–¹æ³•çš„ä»£ç ç•¥ä½œè°ƒæ•´ï¼š</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">AuthenticationHeader header = <span class="keyword">new</span> AuthenticationHeader() &#123; UserName = <span class="string">&quot;admin&quot;</span>, Password = <span class="string">&quot;admin&quot;</span> &#125;;</span><br><span class="line">UserInfo[] allUsers = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">try</span></span><br><span class="line">&#123;</span><br><span class="line">    allUsers = client.GetAllUsers(<span class="keyword">ref</span> header);</span><br><span class="line">    Log(LogLevel.Info, <span class="string">$&quot;è°ƒç”¨ GetAllUsers æ–¹æ³•æˆåŠŸï¼Œè·å–åˆ°ç”¨æˆ·æ•°é‡ï¼š <span class="subst">&#123;allUsers?.Length&#125;</span>ï¼ŒTokenï¼š<span class="subst">&#123;header.Token&#125;</span>&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">catch (Exception exc)</span><br><span class="line">&#123;</span><br><span class="line">    Log(LogLevel.Error, <span class="string">$&quot;è°ƒç”¨ GetAllUsers æ–¹æ³•å¤±è´¥ï¼š<span class="subst">&#123;exc.Message&#125;</span>&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span></span><br><span class="line">&#123;</span><br><span class="line">    header = <span class="keyword">new</span> AuthenticationHeader() &#123; UserName = <span class="string">&quot;test&quot;</span>, Password = <span class="string">&quot;test&quot;</span> &#125;;</span><br><span class="line">    <span class="built_in">string</span> token = client.Validate(header);</span><br><span class="line">    <span class="keyword">if</span> (token != <span class="literal">null</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        Log(LogLevel.Info, <span class="string">$&quot;è°ƒç”¨ Validate æ–¹æ³•æˆåŠŸï¼š<span class="subst">&#123;token&#125;</span>&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        Log(LogLevel.Error, <span class="string">$&quot;è°ƒç”¨ Validate æ–¹æ³•å¤±è´¥ï¼Œè¯·éªŒè¯ç”¨æˆ·åå’Œå¯†ç ã€‚&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">catch (Exception exc)</span><br><span class="line">&#123;</span><br><span class="line">    Log(LogLevel.Error, <span class="string">$&quot;è°ƒç”¨ Validate æ–¹æ³•å¤±è´¥ï¼š<span class="subst">&#123;exc.Message&#125;</span>&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¿®æ”¹ä»¥åå¯ä»¥æ‰§è¡Œæµ‹è¯•ï¼Œè¿è¡Œå®¢æˆ·ç«¯æŸ¥çœ‹ä¸€ä¸‹æ•ˆæœï¼š</p>
<p><img src="https://hd2y.oss-cn-beijing.aliyuncs.com/20191121151110_1574327420894.png" alt="20191121151110"></p>
<p>å½“ç„¶é™¤ä»¥ä¸Šæ–¹æ³•å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥æä¾›ä¸€ä¸ªç™»å½•çš„æœåŠ¡æ–¹æ³•ï¼Œå¦‚æœéªŒè¯æˆåŠŸè¿”å›ä¸€ä¸ª <code>token</code>ï¼Œç„¶åç§æœ‰çš„æ–¹æ³•å¢åŠ ä¸€ä¸ª <code>token</code> çš„å…¥å‚ï¼Œæ¯æ¬¡è°ƒç”¨æ–¹æ³•å‰è¿›è¡ŒéªŒè¯ï¼Œå› ä¸ºæ¯”è¾ƒç®€å•è¿™é‡Œä¸å†è¿‡å¤šæ¼”ç¤ºã€‚</p>
<h2 id="åŠ¨æ€è°ƒæ•´æœåŠ¡"><a href="#åŠ¨æ€è°ƒæ•´æœåŠ¡" class="headerlink" title="åŠ¨æ€è°ƒæ•´æœåŠ¡"></a>åŠ¨æ€è°ƒæ•´æœåŠ¡</h2><p>ç›®å‰æ¥è¯´æœåŠ¡æ˜¯å›ºå®šæŒ‡å‘äº†ä¸€ä¸ªæˆ‘ä»¬ç”ŸæˆæœåŠ¡æ—¶çš„åœ°å€ï¼Œå½“ç„¶å¦‚æœæˆ‘ä»¬æƒ³è¦ä¿®æ”¹æœåŠ¡åœ°å€ä¹Ÿæ˜¯å¾ˆç®€å•çš„ï¼Œåªéœ€è¦æ‰“å¼€ <code>app.config</code> æ–‡ä»¶ï¼Œä¿®æ”¹é»˜è®¤ç”Ÿæˆçš„é…ç½®ä¿¡æ¯ï¼š</p>
<p><img src="https://hd2y.oss-cn-beijing.aliyuncs.com/20191121155612_1574327420895.png" alt="20191121155612"></p>
<p>è¿™æ ·æˆ‘ä»¬è¦ä¸¥æ ¼çš„ä¾èµ–è¿™ä¸ªé…ç½®æ–‡ä»¶ï¼Œè€Œä¸”å¦‚æœæˆ‘ä»¬æƒ³è¦é…ç½®å¤šä¸ªæœåŠ¡åœ°å€ï¼Œåœ¨ä¸€ä¸ªåœ°å€æ— æ³•è¿æ¥æ—¶è‡ªåŠ¨åˆ‡æ¢åˆ°å…¶ä»–æœåŠ¡ï¼Œå¥½åƒæ˜¯ä¸å¯å®ç°çš„ï¼Œæ‰€ä»¥ç¬¬ä¸€æ­¥å°±æ˜¯ç§»é™¤æ‰å¯¹é…ç½®æ–‡ä»¶çš„ä¾èµ–ï¼Œæˆ‘ä»¬åˆ é™¤ <code>app.config</code> æ–‡ä»¶ï¼Œé‡æ–°ç”Ÿæˆé¡¹ç›®å¹¶è¿è¡Œï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">17:19:31 Error: æµ‹è¯•æœåŠ¡å¤±è´¥ï¼šåœ¨ ServiceModel å®¢æˆ·ç«¯é…ç½®éƒ¨åˆ†ä¸­ï¼Œæ‰¾ä¸åˆ°å¼•ç”¨åå®šâ€œMyServiceTest.MyWebServiceSoapâ€çš„é»˜è®¤ç»ˆç»“ç‚¹å…ƒç´ ã€‚è¿™å¯èƒ½æ˜¯å› ä¸ºæœªæ‰¾åˆ°åº”ç”¨ç¨‹åºçš„é…ç½®æ–‡ä»¶ï¼Œæˆ–è€…æ˜¯å› ä¸ºå®¢æˆ·ç«¯å…ƒç´ ä¸­æ‰¾ä¸åˆ°ä¸æ­¤åå®šåŒ¹é…çš„ç»ˆç»“ç‚¹å…ƒç´ ã€‚</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªå…¶å®å¾ˆç®€å•ï¼Œå› ä¸ºæ²¡æœ‰äº†é…ç½®æ–‡ä»¶è¯»å–ä¸åˆ°æœåŠ¡çš„é“¾æ¥åœ°å€ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨åˆå§‹åŒ–å®¢æˆ·ç«¯çš„æ—¶å€™ï¼ŒæŒ‡å®šæœåŠ¡ç«¯è¿æ¥ï¼š</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">client = <span class="keyword">new</span> MyWebServiceSoapClient(<span class="keyword">new</span> BasicHttpBinding(), <span class="keyword">new</span> EndpointAddress(<span class="string">&quot;http://localhost:15178/MyWebService.asmx&quot;</span>));</span><br></pre></td></tr></table></figure>
<p>å› ä¸ºå·²ç»ä¸å†ä¾èµ–é…ç½®æ–‡ä»¶ï¼Œè¿™æ ·æˆ‘ä»¬åˆå§‹åŒ–å®¢æˆ·ç«¯æ—¶å°±å¯ä»¥æ›´è‡ªç”±ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªå·¥å‚æ¥åˆå§‹åŒ–æœåŠ¡ï¼š</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> JohnSun.SOA.WebService.Client.MyServiceTest;</span><br><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> System.Linq;</span><br><span class="line"><span class="keyword">using</span> System.ServiceModel;</span><br><span class="line"><span class="keyword">using</span> System.Text;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">JohnSun.SOA.WebService.Client</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">SoapClientFactory</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">bool</span> <span class="title">TryGetSoapClient</span>(<span class="params"><span class="keyword">out</span> MyWebServiceSoapClient soapClient, <span class="keyword">params</span> <span class="built_in">string</span>[] urls</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            soapClient = <span class="literal">null</span>;</span><br><span class="line">            <span class="keyword">if</span> (urls == <span class="literal">null</span> || urls.Length == <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">foreach</span> (<span class="built_in">string</span> url <span class="keyword">in</span> urls)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">try</span></span><br><span class="line">                &#123;</span><br><span class="line">                    soapClient = <span class="keyword">new</span> MyWebServiceSoapClient(<span class="keyword">new</span> BasicHttpBinding(), <span class="keyword">new</span> EndpointAddress(url));</span><br><span class="line">                    soapClient.HelloWorld();</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                catch</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">if</span> (soapClient != <span class="literal">null</span>)</span><br><span class="line">                        soapClient.Abort();</span><br><span class="line">                    soapClient = <span class="literal">null</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> soapClient != <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç„¶ååˆå§‹åŒ–æœåŠ¡å¯ä»¥è°ƒæ•´ä¸ºä»¥ä¸‹ä»£ç ï¼š</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!SoapClientFactory.TryGetSoapClient(<span class="keyword">out</span> client</span><br><span class="line">    , <span class="string">&quot;http://localhost:80/MyWebService.asmx&quot;</span></span><br><span class="line">    , <span class="string">&quot;http://localhost:1008/MyWebService.asmx&quot;</span></span><br><span class="line">    , <span class="string">&quot;http://localhost:15178/MyWebService.asmx&quot;</span>))</span><br><span class="line">&#123;</span><br><span class="line">    Log(LogLevel.Error, <span class="string">&quot;åˆå§‹åŒ–æœåŠ¡å¤±è´¥ï¼&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">    Log(LogLevel.Info, <span class="string">$&quot;åˆå§‹åŒ–æœåŠ¡æˆåŠŸï¼š<span class="subst">&#123;client.Endpoint.ListenUri&#125;</span>&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æµ‹è¯•æ•ˆæœï¼š</p>
<p><img src="https://hd2y.oss-cn-beijing.aliyuncs.com/20191121162727_1574327420895.png" alt="20191121162727"></p>
<p>æˆ‘ä»¬å·²ç»è§£å†³äº†å¿…é¡»é€šè¿‡ <code>app.config</code> æ¥é…ç½®æœåŠ¡åœ°å€çš„é—®é¢˜ï¼Œä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬åªæœ‰ <code>wsdl</code> æ–‡ä»¶ï¼Œæ— æ³•è¿æ¥æœåŠ¡æ·»åŠ æœåŠ¡åº”è¯¥æ€ä¹ˆå¤„ç†å‘¢ï¼Ÿ</p>
<p>é¦–å…ˆæˆ‘ä»¬ä¸‹è½½æœåŠ¡çš„ <code>wsdl</code> æ–‡ä»¶ç”¨äºæ¼”ç¤ºï¼Œåœ¨æœåŠ¡åé¢æ·»åŠ  <code>wsdl</code> å‚æ•°å³å¯ä¸‹è½½ï¼š<code>http://localhost:15178/MyWebService.asmx?wsdl</code></p>
<p>ç„¶åå’Œé€šè¿‡é“¾æ¥æ·»åŠ æœåŠ¡ä¸€æ ·ï¼Œä¸è¿‡æˆ‘ä»¬è¾“å…¥çš„æ˜¯ä¸‹è½½ä¸‹æ¥çš„ <code>wsdl</code> æ–‡ä»¶çš„æ–‡ä»¶è·¯å¾„ï¼š</p>
<p><img src="https://hd2y.oss-cn-beijing.aliyuncs.com/20191121163348_1574327424355.png" alt="20191121163348"></p>
<p>å…¶å®å¦‚æœæˆ‘ä»¬åšå‡ºæ¥çš„æœåŠ¡è¦æä¾›ç»™ç¬¬ä¸‰æ–¹è°ƒç”¨ï¼Œä¹Ÿæ˜¯é€šè¿‡è¿™ç§æ–¹å¼ï¼Œå°† <code>wsdl</code> æ–‡ä»¶ä¸‹è½½ä¸‹æ¥ï¼Œå‘é€ç»™ç¬¬ä¸‰æ–¹å³å¯ã€‚</p>
<blockquote>
<p>å‚è€ƒï¼š<br></p>
<ul>
<li>MSDN - <code>SoapHeader</code> ç±»ï¼š<a target="_blank" rel="noopener" href="https://docs.microsoft.com/zh-cn/dotnet/api/system.web.services.protocols.soapheader?view=netframework-4.8">https://docs.microsoft.com/zh-cn/dotnet/api/system.web.services.protocols.soapheader?view=netframework-4.8</a><br></li>
<li>MSDN - <code>SoapException</code> ç±»ï¼š<a target="_blank" rel="noopener" href="https://docs.microsoft.com/zh-cn/dotnet/api/system.web.services.protocols.soapexception?view=netframework-4.8">https://docs.microsoft.com/zh-cn/dotnet/api/system.web.services.protocols.soapexception?view=netframework-4.8</a><br></li>
<li>MSDN - <code>ClientBase&lt;TChannel&gt;</code> ç±»ï¼š<a target="_blank" rel="noopener" href="https://docs.microsoft.com/zh-cn/dotnet/api/system.servicemodel.clientbase-1?view=netframework-4.8">https://docs.microsoft.com/zh-cn/dotnet/api/system.servicemodel.clientbase-1?view=netframework-4.8</a><br></li>
<li>ç»´åŸºç™¾ç§‘ - <code>WSDL</code>ï¼š<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/WSDL">https://zh.wikipedia.org/wiki/WSDL</a></li>
</ul>
</blockquote>
<blockquote>
<p>æºç ä¸‹è½½ï¼š<br></p>
<ul>
<li>Gitï¼š<a target="_blank" rel="noopener" href="https://git.hd2y.net/hd2y/JohnSun.SOA.WebService">https://git.hd2y.net/hd2y/JohnSun.SOA.WebService</a><br></li>
<li>ç™¾åº¦ç½‘ç›˜ï¼š<a target="_blank" rel="noopener" href="https://pan.baidu.com/s/1-KePcEeDDEbrclmSo3B6DQ">https://pan.baidu.com/s/1-KePcEeDDEbrclmSo3B6DQ</a> æå–ç ï¼š<code>kbvy</code></li>
</ul>
</blockquote>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://hd2y.github.io/soa-web-service-knowledge-summary/" data-id="cklsrxru2003k04pi25cp6mxd" data-title="SOA â€”â€” WebService çŸ¥è¯†ç‚¹æ€»ç»“" class="article-share-link">åˆ†äº«</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SOA/" rel="tag">SOA</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/WebService/" rel="tag">WebService</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-191118-sqlite-database-common-command" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/sqlite-database-common-command/" class="article-date">
  <time class="dt-published" datetime="2019-11-18T02:04:45.000Z" itemprop="datePublished">2019-11-18</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%BC%80%E5%8F%91/">å¼€å‘</a>â–º<a class="article-category-link" href="/categories/%E5%BC%80%E5%8F%91/%E6%95%B0%E6%8D%AE%E5%BA%93/">æ•°æ®åº“</a>â–º<a class="article-category-link" href="/categories/%E5%BC%80%E5%8F%91/%E6%95%B0%E6%8D%AE%E5%BA%93/SQLite/">SQLite</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/sqlite-database-common-command/">SQLite æ•°æ®åº“å¸¸ç”¨å‘½ä»¤</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="å‹ç¼©æ•°æ®åº“"><a href="#å‹ç¼©æ•°æ®åº“" class="headerlink" title="å‹ç¼©æ•°æ®åº“"></a>å‹ç¼©æ•°æ®åº“</h2><p>åˆ é™¤æ•°æ®æˆ–æ›´æ–°æ•°æ®åï¼Œæ•°æ®åº“ä¸æ–­å¢å¤§ï¼Œå¯ä»¥ä½¿ç”¨ä¸€ä¸‹å‘½ä»¤å¯¹æ•°æ®åº“è¿›è¡Œå‹ç¼©ã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">VACUUM;</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://hd2y.github.io/sqlite-database-common-command/" data-id="cklsrxru1003g04pi7m7g7qcm" data-title="SQLite æ•°æ®åº“å¸¸ç”¨å‘½ä»¤" class="article-share-link">åˆ†äº«</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-191112-warehouse-management-system-gitea-construction" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/warehouse-management-system-gitea-construction/" class="article-date">
  <time class="dt-published" datetime="2019-11-12T02:08:15.000Z" itemprop="datePublished">2019-11-12</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%BC%80%E5%8F%91/">å¼€å‘</a>â–º<a class="article-category-link" href="/categories/%E5%BC%80%E5%8F%91/%E5%B7%A5%E5%85%B7/">å·¥å…·</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/warehouse-management-system-gitea-construction/">ä»£ç ä»“ç®¡ç†ç³»ç»Ÿ Gitea æ­å»º</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>å¼€å§‹ç”¨äºŒè¿›åˆ¶æ–‡ä»¶æ­å»ºï¼Œç»“æœä¸€ç›´å¯åŠ¨ä¸èµ·æ¥ï¼Œåæ¥æ¢äº†ä¸€ä¸ªç‰ˆæœ¬å¯ä»¥å¯åŠ¨èµ·æ¥ï¼Œä½†æ˜¯è®¾ç½®è‡ªå¯åŠ¨æ€»æ˜¯æç¤ºæ‰¾ä¸åˆ° <code>[Unit]</code>ï¼Œä½†æ˜¯é…ç½®æ–‡ä»¶æ˜¯é…ç½®äº†çš„ã€‚</p>
<p>å¾ˆæ— å¥ˆï¼Œå¤ªèœäº†åªèƒ½ç”¨ Docker æ¥å®‰è£…äº†ï¼Œè¿˜ç®€å•ä¸€äº›ã€‚</p>
<h2 id="å‡çº§-Git"><a href="#å‡çº§-Git" class="headerlink" title="å‡çº§ Git"></a>å‡çº§ Git</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®‰è£…ä¾èµ–</span></span><br><span class="line">yum install curl-devel expat-devel gettext-devel openssl-devel zlib-devel asciidoc</span><br><span class="line">yum install  gcc perl-ExtUtils-MakeMaker</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¸è½½ git</span></span><br><span class="line">git --version</span><br><span class="line">yum remove git</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£… git</span></span><br><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/src/</span><br><span class="line">wget https://www.kernel.org/pub/software/scm/git/git-2.24.0.tar.xz</span><br><span class="line">tar -vxf git-2.24.0.tar.xz</span><br><span class="line"><span class="built_in">cd</span> git-2.24.0</span><br><span class="line">make prefix=/usr/<span class="built_in">local</span>/git all</span><br><span class="line">make prefix=/usr/<span class="built_in">local</span>/git install</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;export PATH=<span class="variable">$PATH</span>:/usr/local/git/bin&quot;</span> &gt;&gt; /etc/profile</span><br><span class="line"><span class="built_in">source</span> /etc/profile</span><br><span class="line">git --version</span><br></pre></td></tr></table></figure>
<h2 id="å®‰è£…-Docker"><a href="#å®‰è£…-Docker" class="headerlink" title="å®‰è£… Docker"></a>å®‰è£… Docker</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install -y yum-utils device-mapper-persistent-data lvm2</span><br><span class="line">sudo yum-config-manager --add-repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br><span class="line">sudo yum install docker-ce</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¼€æœºè‡ªå¯</span></span><br><span class="line">sudo systemctl <span class="built_in">enable</span> docker</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯åŠ¨æœåŠ¡</span></span><br><span class="line">sudo systemctl start docker</span><br></pre></td></tr></table></figure>
<h2 id="å®‰è£…-Gitea"><a href="#å®‰è£…-Gitea" class="headerlink" title="å®‰è£… Gitea"></a>å®‰è£… Gitea</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker pull gitea/gitea:latest</span><br><span class="line">sudo mkdir -p /var/lib/gitea</span><br><span class="line">docker run -d --name=gitea -p 10022:22 -p 10080:3000 -v /var/lib/gitea:/data gitea/gitea:latest</span><br></pre></td></tr></table></figure>
<p>åˆ°è¿™é‡Œå°±å¯ä»¥ä½¿ç”¨ç«¯å£ <code>10080</code> è®¿é—®äº†ï¼Œå¯ä»¥ç™»å½•è¿›ç½‘ç«™æ‰§è¡Œä¸€äº›åˆå§‹åŒ–çš„æ“ä½œï¼Œä¾‹å¦‚è®¾ç½®æ•°æ®åº“ä¿¡æ¯ï¼Œç½‘ç«™æ ¹ç›®å½•ç­‰ã€‚</p>
<h2 id="é…ç½®-Gitea"><a href="#é…ç½®-Gitea" class="headerlink" title="é…ç½® Gitea"></a>é…ç½® Gitea</h2><p>å®‰è£…æ—¶æˆ‘ä»¬å°† docker çš„æ•°æ®æŒä¹…åŒ–åˆ° <code>/var/lib/gitea</code> æ–‡ä»¶å¤¹ä¸‹ï¼Œæ‰€ä»¥å¯ä»¥åˆ°è¯¥æ–‡ä»¶å¤¹ä¸‹æ‰¾ <code>app.ini</code> æ–‡ä»¶ã€‚</p>
<p>æˆ‘è¿™é‡Œä½¿ç”¨çš„æ˜¯ mysql æ•°æ®åº“ï¼Œæ€§èƒ½ä¼šæ¯” SQLite3 å¥½å¾ˆå¤šï¼Œå¦‚æœéœ€è¦çš„è¯è‡ªè¡Œå®‰è£…ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /var/lib/gitea/gitea/conf/app.ini</span><br></pre></td></tr></table></figure>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">APP_NAME</span> = Gitea: Git with a cup of tea</span><br><span class="line"><span class="attr">RUN_MODE</span> = prod</span><br><span class="line"><span class="attr">RUN_USER</span> = git</span><br><span class="line"></span><br><span class="line"><span class="section">[repository]</span></span><br><span class="line"><span class="attr">ROOT</span> = /data/git/repositories</span><br><span class="line"></span><br><span class="line"><span class="section">[repository.local]</span></span><br><span class="line"><span class="attr">LOCAL_COPY_PATH</span> = /data/gitea/tmp/local-repo</span><br><span class="line"></span><br><span class="line"><span class="section">[repository.upload]</span></span><br><span class="line"><span class="attr">TEMP_PATH</span> = /data/gitea/uploads</span><br><span class="line"></span><br><span class="line"><span class="section">[server]</span></span><br><span class="line"><span class="attr">APP_DATA_PATH</span>    = /data/gitea</span><br><span class="line"><span class="attr">SSH_DOMAIN</span>       = git.hd2y.net</span><br><span class="line"><span class="attr">HTTP_PORT</span>        = <span class="number">3000</span></span><br><span class="line"><span class="attr">ROOT_URL</span>         = https://git.hd2y.net/</span><br><span class="line"><span class="attr">DISABLE_SSH</span>      = <span class="literal">true</span></span><br><span class="line"><span class="attr">SSH_PORT</span>         = <span class="number">10022</span></span><br><span class="line"><span class="attr">SSH_LISTEN_PORT</span>  = <span class="number">10022</span></span><br><span class="line"><span class="attr">LFS_START_SERVER</span> = <span class="literal">true</span></span><br><span class="line"><span class="attr">LFS_CONTENT_PATH</span> = /data/git/lfs</span><br><span class="line"><span class="attr">DOMAIN</span>           = git.hd2y.net</span><br><span class="line"><span class="attr">LFS_JWT_SECRET</span>   = ****</span><br><span class="line"><span class="attr">OFFLINE_MODE</span>     = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="section">[database]</span></span><br><span class="line"><span class="attr">PATH</span>     = /data/gitea/gitea.db</span><br><span class="line"><span class="attr">DB_TYPE</span>  = mysql</span><br><span class="line"><span class="attr">HOST</span>     = <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">3306</span></span><br><span class="line"><span class="attr">NAME</span>     = gitea</span><br><span class="line"><span class="attr">USER</span>     = root</span><br><span class="line"><span class="attr">PASSWD</span>   = ******</span><br><span class="line"><span class="attr">SSL_MODE</span> = disable</span><br><span class="line"><span class="attr">CHARSET</span>  = utf8</span><br></pre></td></tr></table></figure>
<h2 id="é…ç½®-Caddy"><a href="#é…ç½®-Caddy" class="headerlink" title="é…ç½® Caddy"></a>é…ç½® Caddy</h2><p>Caddy ç±»ä¼¼ Nginx çš„åå‘ä»£ç†è½¯ä»¶ï¼Œä½†æ˜¯é…ç½®ä¼šç®€å•å¾ˆå¤šï¼Œå¹¶ä¸”å¯ä»¥è‡ªåŠ¨å¸®æˆ‘ä»¬ç”³è¯· SSL è¯ä¹¦ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®‰è£… Caddy è½¯ä»¶åŒ…</span></span><br><span class="line">yum install caddy -y</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨ vim ç¼–è¾‘ Caddyfile</span></span><br><span class="line">vim /etc/caddy/conf.d/Caddyfile.conf</span><br></pre></td></tr></table></figure>
<p>å¯¹è¯¥é…ç½®æ–‡ä»¶è¿›è¡Œä¿®æ”¹ï¼š</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">https://git.hd2y.net &#123;</span><br><span class="line"> gzip</span><br><span class="line"> tls hd2y@outlook.com</span><br><span class="line"> proxy / localhost:10080 &#123;</span><br><span class="line">  transparent</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http://git.hd2y.net &#123;</span><br><span class="line"> redir https://git.hd2y.net&#123;url&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¿®æ”¹å®Œæˆä¹‹åå¯åŠ¨ Caddy æœåŠ¡å³å¯ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¼€å¯è‡ªå¯ Caddy æœåŠ¡</span></span><br><span class="line">systemctl <span class="built_in">enable</span> caddy</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯åŠ¨ Caddy</span></span><br><span class="line">service caddy start</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœæ­¢è¿è¡Œ Caddy</span></span><br><span class="line">service caddy stop</span><br><span class="line"></span><br><span class="line"><span class="comment"># é‡å¯ Caddy</span></span><br><span class="line">service caddy restart</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹ Caddy è¿è¡ŒçŠ¶æ€</span></span><br><span class="line">service caddy status</span><br></pre></td></tr></table></figure>
<h2 id="å‚è€ƒæ–‡æ¡£"><a href="#å‚è€ƒæ–‡æ¡£" class="headerlink" title="å‚è€ƒæ–‡æ¡£"></a>å‚è€ƒæ–‡æ¡£</h2><blockquote>
<p>Gitea å®˜æ–¹æ–‡æ¡£ï¼š<a target="_blank" rel="noopener" href="https://docs.gitea.io/zh-cn/">https://docs.gitea.io/zh-cn/</a></p>
<p>Caddy å®˜æ–¹æ–‡æ¡£ï¼š<a target="_blank" rel="noopener" href="https://github.com/caddyserver/caddy/wiki/v2:-Documentation">https://github.com/caddyserver/caddy/wiki/v2:-Documentation</a></p>
</blockquote>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://hd2y.github.io/warehouse-management-system-gitea-construction/" data-id="cklsrxru0003e04pih71ne55m" data-title="ä»£ç ä»“ç®¡ç†ç³»ç»Ÿ Gitea æ­å»º" class="article-share-link">åˆ†äº«</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Git/" rel="tag">Git</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Gitea/" rel="tag">Gitea</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-191112-use-finalshell-instead-of-xshell-under-mac" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/use-finalshell-instead-of-xshell-under-mac/" class="article-date">
  <time class="dt-published" datetime="2019-11-12T01:08:38.000Z" itemprop="datePublished">2019-11-12</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/">æ“ä½œç³»ç»Ÿ</a>â–º<a class="article-category-link" href="/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E8%BD%AF%E4%BB%B6/">è½¯ä»¶</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/use-finalshell-instead-of-xshell-under-mac/">Mac ä¸‹ä½¿ç”¨ FinalShell å–ä»£ XShell</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>Xshell ä¸ªäººæ„Ÿè§‰æ˜¯ Windows ä¸‹åŠŸèƒ½æœ€å¥½ç”¨çš„ ssh å®¢æˆ·ç«¯è½¯ä»¶äº†ï¼Œä½†æ˜¯ä¸èƒ½è·¨å¹³å°ï¼Œæ‰€ä»¥åœ¨ Mac ä¸‹å°±è¦æ‰¾ä¸€ä¸ªæ›¿ä»£å“ã€‚</p>
<p>ç®€å•æ£€ç´¢äº†ä¸€äº›ç½‘ä¸Šçš„èµ„æ–™ï¼Œæœ€ç»ˆè¢« FinalShell å¸å¼•ï¼Œæ„Ÿè§‰æ¯” Xshell è¿˜è¦å¥½ç”¨ä¸€äº›ï¼ˆå¯¹äºæˆ‘è¿™ç§å°ç™½æ¥è¯´ï¼‰ã€‚</p>
<p>ä¸‹è½½åœ°å€ï¼š<a target="_blank" rel="noopener" href="http://www.hostbuf.com/">http://www.hostbuf.com/</a></p>
<p>å…è´¹ç‰ˆå®Œå…¨å¤Ÿç”¨äº†ï¼Œå¦‚æœæƒ³èµåŠ©ä¸€ä¸‹ä½¿ç”¨é«˜çº§ç‰ˆè¿™é‡Œæ˜¯ä¼ é€é—¨ï¼š<a target="_blank" rel="noopener" href="http://www.hostbuf.com/manage/pay_advanced.jsp">35 è½¯å¦¹å¸èµåŠ©ä¼ é€é—¨</a></p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒèµåŠ©éœ€è¦æ³¨å†Œç™»å½•ï¼ŒåŒæ ·è½¯ä»¶é«˜çº§ç‰ˆå‡çº§ä¹Ÿæ˜¯é€šè¿‡ç™»å½•ç”¨æˆ·å®ç°çš„ã€‚</p>
<p>é¢„è§ˆï¼š</p>
<p><img src="https://hd2y.oss-cn-beijing.aliyuncs.com/E6BADE11-F0D2-46D7-95EB-A3D1D94631E0_1573521337005.png" alt="E6BADE11-F0D2-46D7-95EB-A3D1D94631E0"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://hd2y.github.io/use-finalshell-instead-of-xshell-under-mac/" data-id="cklsrxrty003904pi7dul9uhn" data-title="Mac ä¸‹ä½¿ç”¨ FinalShell å–ä»£ XShell" class="article-share-link">åˆ†äº«</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SSH/" rel="tag">SSH</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Shell/" rel="tag">Shell</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-191024-replacing-the-npp-of-the-windows-platform-with-sublime-text" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/replacing-the-npp-of-the-windows-platform-with-sublime-text/" class="article-date">
  <time class="dt-published" datetime="2019-10-24T01:15:43.000Z" itemprop="datePublished">2019-10-24</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/">æ“ä½œç³»ç»Ÿ</a>â–º<a class="article-category-link" href="/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/MacOS/">MacOS</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/replacing-the-npp-of-the-windows-platform-with-sublime-text/">ä½¿ç”¨ Sublime Text æ›¿ä»£ Windows å¹³å°çš„ Notepad++</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>åœ¨ Windows å¹³å°è¿›è¡Œ LIS æ¥å£å¼€å‘æ—¶ï¼Œç»å¸¸éœ€è¦ä½¿ç”¨ npp(Notepad++) æ¥è¿›è¡Œé€šè®¯æ–‡æœ¬çš„æŸ¥é˜…ä¸è§£æã€‚</p>
<p>å¥½å¤„ä¸»è¦ä¸€ä¸‹å‡ ç‚¹ï¼š</p>
<ul>
<li>å¯ä»¥æŸ¥çœ‹ ASCII å­—ç¬¦ï¼›</li>
<li>å¯ä»¥ä½¿ç”¨æ­£åˆ™å¯¹æ•°æ®è¿›è¡Œè°ƒæ•´ï¼›</li>
<li>å¯ä»¥æŸ¥çœ‹åˆ°å½“å‰ç¼–è¾‘ä½ç½®ä»¥åŠé€‰ä¸­æ–‡æœ¬é•¿åº¦ï¼›</li>
</ul>
<p>å› ä¸º npp æ˜¯ Windows ç³»ç»Ÿçš„è½¯ä»¶ï¼Œæ— æ³•è·¨å¹³å°ä½¿ç”¨ï¼Œæ‰€ä»¥ç°åœ¨ä½¿ç”¨ macOS å°±éœ€è¦æ‰¾åˆ°ä¸€ä¸ªæ›¿ä»£å“ã€‚</p>
<p>å¼€å§‹æ˜¯å°è¯•è¿‡ ue ç­‰ä¸€äº›ç½‘å‹æ¨èçš„è½¯ä»¶ï¼Œå‘ç°ä¸è¡Œï¼Œç»æœ›çš„ä»¥ä¸ºæ‰¾ä¸åˆ°æ›¿ä»£å“ã€‚ä½†æ˜¯åœ¨ CoolQ å¼€å‘è€…èŠå¤©ç¾¤èŠå¤©çš„æ—¶å€™ï¼Œæ— æ„ä¸­å¬åˆ° Coxxs è¯´ Sublime å…¶å®ä¹Ÿä¸é”™ï¼Œäºæ˜¯ä¸‹è½½ä¸‹æ¥è¯•äº†ä¸€ä¸‹ï¼Œå¯ä»¥è¯´æ˜¯çœŸé¦™äº†ã€‚</p>
<p>ä»¥ä¸‹æ•´ç†ä»¥ä¸‹å®‰è£…æ—¶é‡åˆ°çš„ä¸€äº›é—®é¢˜ã€‚</p>
<h2 id="ä¸‹è½½"><a href="#ä¸‹è½½" class="headerlink" title="ä¸‹è½½"></a>ä¸‹è½½</h2><p><a target="_blank" rel="noopener" href="https://pan.baidu.com/s/1_4twEeQGKXXddnsIrF1SrA">https://pan.baidu.com/s/1_4twEeQGKXXddnsIrF1SrA</a> æå–ç ï¼šk744</p>
<h2 id="å…³é—­æ›´æ–°"><a href="#å…³é—­æ›´æ–°" class="headerlink" title="å…³é—­æ›´æ–°"></a>å…³é—­æ›´æ–°</h2><p>èœå•æ  -&gt; Preferences -&gt; Settings -&gt; User Settings é…ç½®æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;update_check&quot;: false</span><br></pre></td></tr></table></figure>
<p>æ³¨æ„ä¿æŒjsonå†…å®¹çš„ç»“æœå®Œæ•´ï¼Œå¯èƒ½éœ€è¦è¡¥é€—å·ã€‚</p>
<h2 id="ä½¿ç”¨GBK"><a href="#ä½¿ç”¨GBK" class="headerlink" title="ä½¿ç”¨GBK"></a>ä½¿ç”¨GBK</h2><p>ä¸­æ–‡ä¹±ç çš„é—®é¢˜éœ€è¦å®‰è£…åŒ…ï¼ŒåŒ…æ‹¬ <code>ConvertToUTF8</code> ä»¥åŠ <code>Codecs33</code>ã€‚</p>
<p>å®‰è£…çš„æ—¶å€™å¦‚æœå¤±è´¥ï¼Œéœ€è¦é…ç½®ä¸€ä¸‹ä¸‹è½½è¿æ¥æ–¹å¼ï¼Œæ‰“å¼€ èœå•æ  -&gt; Preferences -&gt; Package Settings -&gt; Package Control -&gt; User Settings å°†ä»¥ä¸‹å†…å®¹è¿½åŠ åˆ°é…ç½®æ–‡ä»¶ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&quot;downloader_precedence&quot;:</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;linux&quot;</span>:</span><br><span class="line">    [</span><br><span class="line">        <span class="string">&quot;curl&quot;</span>,</span><br><span class="line">        <span class="string">&quot;urllib&quot;</span>,</span><br><span class="line">        <span class="string">&quot;wget&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">&quot;osx&quot;</span>:</span><br><span class="line">    [</span><br><span class="line">        <span class="string">&quot;curl&quot;</span>,</span><br><span class="line">        <span class="string">&quot;wget&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">&quot;windows&quot;</span>:</span><br><span class="line">    [</span><br><span class="line">        <span class="string">&quot;wininet&quot;</span></span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ³¨æ„ä¿æŒ json å†…å®¹çš„ç»“æœå®Œæ•´ï¼Œå¯èƒ½éœ€è¦è¡¥é€—å·ã€‚</p>
<p>ä»¥ä¸Šé…ç½®å®Œæˆä»¥åï¼Œéƒ½éœ€è¦é‡å¯ Sublime Text æ‰èƒ½ç”Ÿæ•ˆï¼Œç°åœ¨è¿˜æœ‰å®ä»¥åŠåŒæ—¶ç¼–è¾‘å¤šè¡Œçš„é—®é¢˜è¿˜éœ€è¦ç ”ç©¶ä¸€ä¸‹ï¼Œæ€»çš„æ¥è¯´æ›¿ä»£ npp åº”è¯¥æ˜¯æ²¡é—®é¢˜äº†ï¼Œæœ€å…³é”®æ˜¯è·¨å¹³å°å¾ˆæ–¹ä¾¿ã€‚</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://hd2y.github.io/replacing-the-npp-of-the-windows-platform-with-sublime-text/" data-id="cklsrxrty003704pi0xz73aq6" data-title="ä½¿ç”¨ Sublime Text æ›¿ä»£ Windows å¹³å°çš„ Notepad++" class="article-share-link">åˆ†äº«</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/IDE/" rel="tag">IDE</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-191024-delay-problem-of-using-bluetooth-connection-in-logit-mouse" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/delay-problem-of-using-bluetooth-connection-in-logit-mouse/" class="article-date">
  <time class="dt-published" datetime="2019-10-24T00:26:44.000Z" itemprop="datePublished">2019-10-24</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/">æ“ä½œç³»ç»Ÿ</a>â–º<a class="article-category-link" href="/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/MacOS/">MacOS</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/delay-problem-of-using-bluetooth-connection-in-logit-mouse/">ç½—æŠ€é¼ æ ‡ä½¿ç”¨è“ç‰™è¿æ¥çš„å»¶è¿Ÿé—®é¢˜</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>æœ€è¿‘è´­ç½®äº†ä¸€ä¸ªè¿·ä½ ä¸»æœºï¼Œä½“éªŒäº†ä¸€ä¸‹â€œé»‘è‹¹æœâ€ï¼Œä¸ºäº†è¿½æ±‚ç®€çº¦ï¼Œçœ‹ç€æ¡Œé¢ä¸Šçš„çº¿æä¹Ÿæ¯”è¾ƒçªå¿ƒï¼Œæ‰€ä»¥é‡æ–°è´­ç½®äº†ä¸€å¥—æ— çº¿é”®é¼ ã€‚</p>
<p><img src="https://hd2y.oss-cn-beijing.aliyuncs.com/Screenshot_2019-10-24-08-16-51-718_com.jingdong.a_1571876396154.png?x-oss-process=image/auto-orient,1/resize,p_50/quality,q_50" alt="Screenshot_20191024081651718_com.jingdong.a.png"></p>
<p>æœ€å¼€å§‹æ‰“ç®—ä½¿ç”¨è“ç‰™è¿æ¥ï¼Œé¿å…å ç”¨ USB æ¥å£ï¼Œä½†æ˜¯å®é™…ä½¿ç”¨å‘ç°ï¼Œå¯èƒ½ç”±äºæ— çº¿ç½‘å¡çš„é—®é¢˜ï¼Œè“ç‰™æ¨¡å—éå¸¸å¡é¡¿ï¼Œæ— è®ºæ˜¯æ¥è“ç‰™è€³æœºå¬æ­Œï¼Œè¿˜æ˜¯è¿æ¥ä½¿ç”¨é”®é¼ ã€‚é”®ç›˜è¿˜å¯ä»¥æ¥å—ï¼Œä½†æ˜¯è“ç‰™é¼ æ ‡å¡é¡¿éå¸¸æ˜æ˜¾ã€‚</p>
<h2 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h2><p>æ¢æ— çº¿æ¨¡å—å¤§æ¦‚æ˜¯ä¸å¯èƒ½äº†ï¼Œmini ä¸»æœºå¯ä»¥ç”¨çš„æ— çº¿æ¨¡å—ç°åœ¨ä»·æ ¼ç‚’å¾—å¾ˆé«˜ã€‚</p>
<p>ä½†æ˜¯ä¸¤ä¸ªéƒ½é€šè¿‡ USB è¿æ¥ï¼Œå ç”¨ä¸¤ä¸ªæ¥å£åˆä¸å¥½æ¥å—ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘æƒ³èµ·æ¥ä¹‹å‰é¼ æ ‡æ— çº¿æ¥æ”¶å™¨å’Œé¼ æ ‡ä¸¢å¤±è¿æ¥ï¼Œå¯ä»¥ä½¿ç”¨è¿‡ä¼˜è”é‡æ–°é…å¯¹ã€‚é‚£ä¹ˆä¼˜è”å¯ä¸å¯ä»¥å°†ä¸€ä¸ªæ— çº¿æ¥æ”¶å™¨é…å¯¹ä¸¤ä¸ªè®¾å¤‡å‘¢ï¼Ÿ</p>
<p>æŸ¥æ‰¾äº†ä¸€ä¸‹èµ„æ–™ï¼Œå¾—åˆ°çš„æ˜¯è‚¯å®šçš„ç­”æ¡ˆï¼Œä¸‹è½½é“¾æ¥ï¼š<a target="_blank" rel="noopener" href="https://support.logi.com/hc/zh-cn/articles/360025297913">Logitech Unifyingâ„¢ ä¼˜è”è½¯ä»¶</a></p>
<p>ç³»ç»Ÿä¿¡æ¯ï¼š</p>
<p><img src="https://hd2y.oss-cn-beijing.aliyuncs.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-10-24%20%E4%B8%8A%E5%8D%888.27.36_1571876886214.png?x-oss-process=image/auto-orient,1/resize,p_50/quality,q_50" alt="å±å¹•å¿«ç…§ 20191024 ä¸Šåˆ8.27.36.png"></p>
<p>æˆ‘çš„ MacOS ç‰ˆæœ¬æ˜¯ 10.14.6ï¼Œç½‘ä¸Šæ²¡æœ‰è¿™ä¸ªç‰ˆæœ¬ï¼Œä½†æ˜¯æˆ‘ä¸‹è½½çš„ 10.15 ç‰ˆæœ¬çš„è½¯ä»¶å¯ä»¥å®Œç¾å®‰è£…ä½¿ç”¨ã€‚</p>
<p><img src="https://hd2y.oss-cn-beijing.aliyuncs.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-10-24%20%E4%B8%8A%E5%8D%888.29.46_1571877004200.png?x-oss-process=image/auto-orient,1/resize,p_50/quality,q_50" alt="å±å¹•å¿«ç…§ 20191024 ä¸Šåˆ8.29.46.png"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://hd2y.github.io/delay-problem-of-using-bluetooth-connection-in-logit-mouse/" data-id="cklsrxrtw003304pi3qbrav7u" data-title="ç½—æŠ€é¼ æ ‡ä½¿ç”¨è“ç‰™è¿æ¥çš„å»¶è¿Ÿé—®é¢˜" class="article-share-link">åˆ†äº«</a>
      
      
      
    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/3/">&laquo; ä¸Šä¸€é¡µ</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><a class="page-number" href="/page/6/">6</a><span class="space">&hellip;</span><a class="page-number" href="/page/10/">10</a><a class="extend next" rel="next" href="/page/5/">ä¸‹ä¸€é¡µ &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">åˆ†ç±»</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%BC%80%E5%8F%91/">å¼€å‘</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%BC%80%E5%8F%91/C/">C#</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%BC%80%E5%8F%91/C/ASP-NET-Core/">ASP.NET Core</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%BC%80%E5%8F%91/C/WPF/">WPF</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%BC%80%E5%8F%91/%E4%B8%9A%E5%8A%A1/">ä¸šåŠ¡</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%BC%80%E5%8F%91/%E5%89%8D%E7%AB%AF/">å‰ç«¯</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%BC%80%E5%8F%91/%E5%9F%BA%E7%A1%80/">åŸºç¡€</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%BC%80%E5%8F%91/%E5%B7%A5%E5%85%B7/">å·¥å…·</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%BC%80%E5%8F%91/%E6%95%B0%E6%8D%AE%E5%BA%93/">æ•°æ®åº“</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%BC%80%E5%8F%91/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL/">MySQL</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%BC%80%E5%8F%91/%E6%95%B0%E6%8D%AE%E5%BA%93/Oracle/">Oracle</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%BC%80%E5%8F%91/%E6%95%B0%E6%8D%AE%E5%BA%93/PostgreSQL/">PostgreSQL</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%BC%80%E5%8F%91/%E6%95%B0%E6%8D%AE%E5%BA%93/SQL-Server/">SQL Server</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%BC%80%E5%8F%91/%E6%95%B0%E6%8D%AE%E5%BA%93/SQLite/">SQLite</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%BC%80%E5%8F%91/%E6%9D%82%E8%B0%88/">æ‚è°ˆ</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/">æ“ä½œç³»ç»Ÿ</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/MacOS/">MacOS</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E5%B7%A5%E5%85%B7/">å·¥å…·</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E8%BD%AF%E4%BB%B6/">è½¯ä»¶</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%97%A5%E5%BF%97/">æ—¥å¿—</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%97%A5%E5%BF%97/%E5%85%AC%E5%91%8A/">å…¬å‘Š</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%97%A5%E5%BF%97/%E5%BC%80%E7%AE%B1/">å¼€ç®±</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%97%A5%E5%BF%97/%E6%9D%82%E8%B0%88/">æ‚è°ˆ</a></li></ul></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">æ ‡ç­¾</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/NET-Standard/" rel="tag">.NET Standard</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/AOP/" rel="tag">AOP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ASCII/" rel="tag">ASCII</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ActiveX/" rel="tag">ActiveX</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Attribute/" rel="tag">Attribute</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Autofac/" rel="tag">Autofac</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/BFG/" rel="tag">BFG</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CCProxy/" rel="tag">CCProxy</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Chrome/" rel="tag">Chrome</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DBeaver/" rel="tag">DBeaver</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Expression/" rel="tag">Expression</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Fiddler/" rel="tag">Fiddler</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Fody/" rel="tag">Fody</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GDI/" rel="tag">GDI</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Git/" rel="tag">Git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GitHub/" rel="tag">GitHub</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Gitea/" rel="tag">Gitea</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HIS/" rel="tag">HIS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HongYang/" rel="tag">HongYang</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/IDE/" rel="tag">IDE</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/IE/" rel="tag">IE</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JavaScript/" rel="tag">JavaScript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Jint/" rel="tag">Jint</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Json/" rel="tag">Json</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Kindle/" rel="tag">Kindle</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/LIS/" rel="tag">LIS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/LODOP/" rel="tag">LODOP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MVC/" rel="tag">MVC</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MacOS/" rel="tag">MacOS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MahApps-Metro/" rel="tag">MahApps.Metro</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Math/" rel="tag">Math</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NHibernate/" rel="tag">NHibernate</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Nexus3/" rel="tag">Nexus3</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Note/" rel="tag">Note</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NuGet/" rel="tag">NuGet</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/OOP/" rel="tag">OOP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Oracle/" rel="tag">Oracle</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SOA/" rel="tag">SOA</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SSH/" rel="tag">SSH</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Shell/" rel="tag">Shell</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TCP/" rel="tag">TCP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Telegram/" rel="tag">Telegram</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TreeView/" rel="tag">TreeView</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Tuple/" rel="tag">Tuple</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/UI/" rel="tag">UI</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/UML/" rel="tag">UML</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Unity/" rel="tag">Unity</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/VS/" rel="tag">VS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/VSCode/" rel="tag">VSCode</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ValueTuple/" rel="tag">ValueTuple</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/WCF/" rel="tag">WCF</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/WPF/" rel="tag">WPF</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/WebApi/" rel="tag">WebApi</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/WebService/" rel="tag">WebService</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/WinForm/" rel="tag">WinForm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Windows/" rel="tag">Windows</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Windows-XP/" rel="tag">Windows XP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Xml/" rel="tag">Xml</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/decimal/" rel="tag">decimal</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/frp/" rel="tag">frp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jdbc/" rel="tag">jdbc</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mstsc/" rel="tag">mstsc</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%B8%B2%E5%8F%A3/" rel="tag">ä¸²å£</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BA%94%E7%AC%94/" rel="tag">äº”ç¬”</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BB%A3%E7%90%86/" rel="tag">ä»£ç†</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5/" rel="tag">ä¾èµ–æ³¨å…¥</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%85%83%E7%BB%84/" rel="tag">å…ƒç»„</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8A%A0%E5%AF%86/" rel="tag">åŠ å¯†</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8A%A8%E6%80%81%E9%93%BE%E6%8E%A5%E5%BA%93/" rel="tag">åŠ¨æ€é“¾æ¥åº“</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8F%8D%E5%B0%84/" rel="tag">åå°„</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%9B%BE%E7%89%87%E5%8E%8B%E7%BC%A9/" rel="tag">å›¾ç‰‡å‹ç¼©</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/" rel="tag">å¤šçº¿ç¨‹</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%A7%94%E6%89%98/" rel="tag">å§”æ‰˜</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B7%A5%E5%85%B7/" rel="tag">å·¥å…·</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B9%B4%E9%BE%84/" rel="tag">å¹´é¾„</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%BA%8F%E5%88%97%E5%8C%96/" rel="tag">åºåˆ—åŒ–</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%BC%83%E5%85%83/" rel="tag">å¼ƒå…ƒ</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%89%93%E5%8D%B0/" rel="tag">æ‰“å°</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%8B%BC%E9%9F%B3/" rel="tag">æ‹¼éŸ³</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%97%A5%E5%BF%97/" rel="tag">æ—¥å¿—</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0/" rel="tag">æ„é€ å‡½æ•°</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%9E%90%E6%9E%84%E5%87%BD%E6%95%B0/" rel="tag">ææ„å‡½æ•°</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%9E%9A%E4%B8%BE/" rel="tag">æšä¸¾</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%AD%A3%E5%88%99/" rel="tag">æ­£åˆ™</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%B1%89%E5%AD%97/" rel="tag">æ±‰å­—</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%B3%9B%E5%9E%8B/" rel="tag">æ³›å‹</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%88%AC%E8%99%AB/" rel="tag">çˆ¬è™«</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%91%9E%E7%BE%8E/" rel="tag">ç‘ç¾</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%99%9A%E6%8B%9F%E6%9C%BA/" rel="tag">è™šæ‹Ÿæœº</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%A1%80%E7%90%83%E4%BB%AA/" rel="tag">è¡€çƒä»ª</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%A7%A3%E6%9E%84%E5%87%BD%E6%95%B0/" rel="tag">è§£æ„å‡½æ•°</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" rel="tag">è®¾è®¡æ¨¡å¼</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%B0%83%E8%AF%95/" rel="tag">è°ƒè¯•</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%B4%9D%E5%85%8B%E6%9B%BC/" rel="tag">è´å…‹æ›¼</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%BA%AB%E4%BB%BD%E8%AF%81%E8%AF%BB%E5%8D%A1/" rel="tag">èº«ä»½è¯è¯»å¡</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%BD%AF%E4%BB%B6/" rel="tag">è½¯ä»¶</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%BF%9C%E7%A8%8B/" rel="tag">è¿œç¨‹</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%97%AA%E9%80%80/" rel="tag">é—ªé€€</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%A1%B9%E7%9B%AE/" rel="tag">é¡¹ç›®</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">æ ‡ç­¾äº‘</h3>
    <div class="widget tagcloud">
      <a href="/tags/NET-Standard/" style="font-size: 10px;">.NET Standard</a> <a href="/tags/AOP/" style="font-size: 10px;">AOP</a> <a href="/tags/ASCII/" style="font-size: 10px;">ASCII</a> <a href="/tags/ActiveX/" style="font-size: 10px;">ActiveX</a> <a href="/tags/Attribute/" style="font-size: 10px;">Attribute</a> <a href="/tags/Autofac/" style="font-size: 10px;">Autofac</a> <a href="/tags/BFG/" style="font-size: 10px;">BFG</a> <a href="/tags/CCProxy/" style="font-size: 10px;">CCProxy</a> <a href="/tags/Chrome/" style="font-size: 10px;">Chrome</a> <a href="/tags/DBeaver/" style="font-size: 12px;">DBeaver</a> <a href="/tags/Expression/" style="font-size: 10px;">Expression</a> <a href="/tags/Fiddler/" style="font-size: 10px;">Fiddler</a> <a href="/tags/Fody/" style="font-size: 10px;">Fody</a> <a href="/tags/GDI/" style="font-size: 12px;">GDI</a> <a href="/tags/Git/" style="font-size: 12px;">Git</a> <a href="/tags/GitHub/" style="font-size: 12px;">GitHub</a> <a href="/tags/Gitea/" style="font-size: 10px;">Gitea</a> <a href="/tags/HIS/" style="font-size: 12px;">HIS</a> <a href="/tags/HongYang/" style="font-size: 10px;">HongYang</a> <a href="/tags/IDE/" style="font-size: 10px;">IDE</a> <a href="/tags/IE/" style="font-size: 10px;">IE</a> <a href="/tags/JavaScript/" style="font-size: 12px;">JavaScript</a> <a href="/tags/Jint/" style="font-size: 12px;">Jint</a> <a href="/tags/Json/" style="font-size: 10px;">Json</a> <a href="/tags/Kindle/" style="font-size: 10px;">Kindle</a> <a href="/tags/LIS/" style="font-size: 20px;">LIS</a> <a href="/tags/LODOP/" style="font-size: 10px;">LODOP</a> <a href="/tags/MVC/" style="font-size: 10px;">MVC</a> <a href="/tags/MacOS/" style="font-size: 10px;">MacOS</a> <a href="/tags/MahApps-Metro/" style="font-size: 10px;">MahApps.Metro</a> <a href="/tags/Math/" style="font-size: 10px;">Math</a> <a href="/tags/NHibernate/" style="font-size: 10px;">NHibernate</a> <a href="/tags/Nexus3/" style="font-size: 10px;">Nexus3</a> <a href="/tags/Note/" style="font-size: 10px;">Note</a> <a href="/tags/NuGet/" style="font-size: 10px;">NuGet</a> <a href="/tags/OOP/" style="font-size: 10px;">OOP</a> <a href="/tags/Oracle/" style="font-size: 10px;">Oracle</a> <a href="/tags/SOA/" style="font-size: 16px;">SOA</a> <a href="/tags/SSH/" style="font-size: 10px;">SSH</a> <a href="/tags/Shell/" style="font-size: 10px;">Shell</a> <a href="/tags/TCP/" style="font-size: 10px;">TCP</a> <a href="/tags/Telegram/" style="font-size: 10px;">Telegram</a> <a href="/tags/TreeView/" style="font-size: 10px;">TreeView</a> <a href="/tags/Tuple/" style="font-size: 10px;">Tuple</a> <a href="/tags/UI/" style="font-size: 12px;">UI</a> <a href="/tags/UML/" style="font-size: 10px;">UML</a> <a href="/tags/Unity/" style="font-size: 10px;">Unity</a> <a href="/tags/VS/" style="font-size: 10px;">VS</a> <a href="/tags/VSCode/" style="font-size: 10px;">VSCode</a> <a href="/tags/ValueTuple/" style="font-size: 10px;">ValueTuple</a> <a href="/tags/WCF/" style="font-size: 12px;">WCF</a> <a href="/tags/WPF/" style="font-size: 10px;">WPF</a> <a href="/tags/WebApi/" style="font-size: 14px;">WebApi</a> <a href="/tags/WebService/" style="font-size: 16px;">WebService</a> <a href="/tags/WinForm/" style="font-size: 10px;">WinForm</a> <a href="/tags/Windows/" style="font-size: 10px;">Windows</a> <a href="/tags/Windows-XP/" style="font-size: 12px;">Windows XP</a> <a href="/tags/Xml/" style="font-size: 10px;">Xml</a> <a href="/tags/decimal/" style="font-size: 10px;">decimal</a> <a href="/tags/frp/" style="font-size: 10px;">frp</a> <a href="/tags/jdbc/" style="font-size: 10px;">jdbc</a> <a href="/tags/mstsc/" style="font-size: 10px;">mstsc</a> <a href="/tags/%E4%B8%B2%E5%8F%A3/" style="font-size: 12px;">ä¸²å£</a> <a href="/tags/%E4%BA%94%E7%AC%94/" style="font-size: 10px;">äº”ç¬”</a> <a href="/tags/%E4%BB%A3%E7%90%86/" style="font-size: 12px;">ä»£ç†</a> <a href="/tags/%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5/" style="font-size: 10px;">ä¾èµ–æ³¨å…¥</a> <a href="/tags/%E5%85%83%E7%BB%84/" style="font-size: 12px;">å…ƒç»„</a> <a href="/tags/%E5%8A%A0%E5%AF%86/" style="font-size: 10px;">åŠ å¯†</a> <a href="/tags/%E5%8A%A8%E6%80%81%E9%93%BE%E6%8E%A5%E5%BA%93/" style="font-size: 10px;">åŠ¨æ€é“¾æ¥åº“</a> <a href="/tags/%E5%8F%8D%E5%B0%84/" style="font-size: 10px;">åå°„</a> <a href="/tags/%E5%9B%BE%E7%89%87%E5%8E%8B%E7%BC%A9/" style="font-size: 10px;">å›¾ç‰‡å‹ç¼©</a> <a href="/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/" style="font-size: 18px;">å¤šçº¿ç¨‹</a> <a href="/tags/%E5%A7%94%E6%89%98/" style="font-size: 10px;">å§”æ‰˜</a> <a href="/tags/%E5%B7%A5%E5%85%B7/" style="font-size: 10px;">å·¥å…·</a> <a href="/tags/%E5%B9%B4%E9%BE%84/" style="font-size: 10px;">å¹´é¾„</a> <a href="/tags/%E5%BA%8F%E5%88%97%E5%8C%96/" style="font-size: 10px;">åºåˆ—åŒ–</a> <a href="/tags/%E5%BC%83%E5%85%83/" style="font-size: 10px;">å¼ƒå…ƒ</a> <a href="/tags/%E6%89%93%E5%8D%B0/" style="font-size: 10px;">æ‰“å°</a> <a href="/tags/%E6%8B%BC%E9%9F%B3/" style="font-size: 10px;">æ‹¼éŸ³</a> <a href="/tags/%E6%97%A5%E5%BF%97/" style="font-size: 10px;">æ—¥å¿—</a> <a href="/tags/%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0/" style="font-size: 10px;">æ„é€ å‡½æ•°</a> <a href="/tags/%E6%9E%90%E6%9E%84%E5%87%BD%E6%95%B0/" style="font-size: 10px;">ææ„å‡½æ•°</a> <a href="/tags/%E6%9E%9A%E4%B8%BE/" style="font-size: 10px;">æšä¸¾</a> <a href="/tags/%E6%AD%A3%E5%88%99/" style="font-size: 14px;">æ­£åˆ™</a> <a href="/tags/%E6%B1%89%E5%AD%97/" style="font-size: 10px;">æ±‰å­—</a> <a href="/tags/%E6%B3%9B%E5%9E%8B/" style="font-size: 12px;">æ³›å‹</a> <a href="/tags/%E7%88%AC%E8%99%AB/" style="font-size: 10px;">çˆ¬è™«</a> <a href="/tags/%E7%91%9E%E7%BE%8E/" style="font-size: 12px;">ç‘ç¾</a> <a href="/tags/%E8%99%9A%E6%8B%9F%E6%9C%BA/" style="font-size: 12px;">è™šæ‹Ÿæœº</a> <a href="/tags/%E8%A1%80%E7%90%83%E4%BB%AA/" style="font-size: 10px;">è¡€çƒä»ª</a> <a href="/tags/%E8%A7%A3%E6%9E%84%E5%87%BD%E6%95%B0/" style="font-size: 10px;">è§£æ„å‡½æ•°</a> <a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" style="font-size: 12px;">è®¾è®¡æ¨¡å¼</a> <a href="/tags/%E8%B0%83%E8%AF%95/" style="font-size: 10px;">è°ƒè¯•</a> <a href="/tags/%E8%B4%9D%E5%85%8B%E6%9B%BC/" style="font-size: 10px;">è´å…‹æ›¼</a> <a href="/tags/%E8%BA%AB%E4%BB%BD%E8%AF%81%E8%AF%BB%E5%8D%A1/" style="font-size: 10px;">èº«ä»½è¯è¯»å¡</a> <a href="/tags/%E8%BD%AF%E4%BB%B6/" style="font-size: 10px;">è½¯ä»¶</a> <a href="/tags/%E8%BF%9C%E7%A8%8B/" style="font-size: 10px;">è¿œç¨‹</a> <a href="/tags/%E9%97%AA%E9%80%80/" style="font-size: 10px;">é—ªé€€</a> <a href="/tags/%E9%A1%B9%E7%9B%AE/" style="font-size: 10px;">é¡¹ç›®</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">å½’æ¡£</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">ä¸‰æœˆ 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">äºŒæœˆ 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">åäºŒæœˆ 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">åä¸€æœˆ 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">ä¹æœˆ 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">äº”æœˆ 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">å››æœˆ 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">ä¸‰æœˆ 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">äºŒæœˆ 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">ä¸€æœˆ 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">åäºŒæœˆ 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">åä¸€æœˆ 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">åæœˆ 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">ä¹æœˆ 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">å…«æœˆ 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">ä¸ƒæœˆ 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">äº”æœˆ 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">å››æœˆ 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">ä¸‰æœˆ 2019</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">æœ€æ–°æ–‡ç« </h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/debugging-web-service-services-using-fiddler/">ä½¿ç”¨ Fiddler è°ƒè¯• WebService æœåŠ¡</a>
          </li>
        
          <li>
            <a href="/get-the-database-password-of-ruimei-system/">è·å–ç‘ç¾ç³»ç»Ÿæ•°æ®åº“å¯†ç </a>
          </li>
        
          <li>
            <a href="/chinese-helper/">æ±‰å­—å¸®åŠ©ç±»â€”â€”è·å–æ‹¼éŸ³ä¸äº”ç¬”ç®€ç </a>
          </li>
        
          <li>
            <a href="/how-to-process-images/">å¦‚ä½•å¤„ç†å›¾ç‰‡</a>
          </li>
        
          <li>
            <a href="/instrument-communication/">æ£€éªŒä»ªå™¨å¸¸è§é€šä¿¡æ–¹æ¡ˆ</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2021 hd2y<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>